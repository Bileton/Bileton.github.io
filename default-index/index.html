<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="路漫漫其修远夕！">
<meta property="og:type" content="website">
<meta property="og:title" content="白乐天">
<meta property="og:url" content="http://example.com/default-index/index.html">
<meta property="og:site_name" content="白乐天">
<meta property="og:description" content="路漫漫其修远夕！">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Bileton">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/default-index/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>白乐天</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">白乐天</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">道阻且长，行则将至。</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">52</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">26</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">55</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/love.js"></script>
</div>
    </header>

    
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/01/20/Ubuntu%E5%88%9D%E5%A7%8B%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android.svg">
      <meta itemprop="name" content="Bileton">
      <meta itemprop="description" content="路漫漫其修远夕！">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="白乐天">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/01/20/Ubuntu%E5%88%9D%E5%A7%8B%E5%8C%96/" class="post-title-link" itemprop="url">Ubuntu初始化</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-01-20 15:45:19 / 修改时间：16:37:59" itemprop="dateCreated datePublished" datetime="2025-01-20T15:45:19+08:00">2025-01-20</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%99%9A%E6%8B%9F%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">虚拟机</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>402</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="open-vm-tools-desktop"><a href="#open-vm-tools-desktop" class="headerlink" title="open-vm-tools-desktop"></a>open-vm-tools-desktop</h1><p>提供如下功能：</p>
<ul>
<li>自动调整屏幕分辨率</li>
<li>共享剪贴板</li>
<li>图形性能优化</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install open-vm-tools-desktop -y</span><br></pre></td></tr></table></figure>

<h1 id="调整桌面环境缩放比例"><a href="#调整桌面环境缩放比例" class="headerlink" title="调整桌面环境缩放比例"></a>调整桌面环境缩放比例</h1><p>调整 GNOME 桌面环境中所有界面文本（如菜单、窗口标题、工具提示等）的缩放比例，将文本按照比例 <strong>2 倍</strong>放大。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gsettings set org.gnome.desktop.interface text-scaling-factor 2</span><br></pre></td></tr></table></figure>

<h1 id="设置root密码"><a href="#设置root密码" class="headerlink" title="设置root密码"></a>设置root密码</h1><p>打开终端，输入<code>sudo -i</code>，会提示输入普通用户密码，输入后回车。<br>输入<code>passwd root</code>命令来修改root密码。<br>输入新的root密码，接着回车，注意的是输入的密码不会显示。<br>然后再重新输入新的root密码，然后回车root密码就修改成功。</p>
<h1 id="更新系统包管理器"><a href="#更新系统包管理器" class="headerlink" title="更新系统包管理器"></a>更新系统包管理器</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt upgrade -y</span><br></pre></td></tr></table></figure>

<h1 id="安装常用包"><a href="#安装常用包" class="headerlink" title="安装常用包"></a>安装常用包</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim</span><br><span class="line">git</span><br><span class="line">nodejs</span><br><span class="line">npm</span><br><span class="line">make</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/01/19/%E6%B7%98%E5%B0%8F%E8%AF%B4app%E5%8F%82%E6%95%B0sign%E5%80%BC%E9%80%86%E5%90%91%E5%8F%8Avip%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android.svg">
      <meta itemprop="name" content="Bileton">
      <meta itemprop="description" content="路漫漫其修远夕！">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="白乐天">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/01/19/%E6%B7%98%E5%B0%8F%E8%AF%B4app%E5%8F%82%E6%95%B0sign%E5%80%BC%E9%80%86%E5%90%91%E5%8F%8Avip%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">淘小说app参数sign值逆向及vip逻辑分析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-01-19 19:17:28 / 修改时间：19:51:39" itemprop="dateCreated datePublished" datetime="2025-01-19T19:17:28+08:00">2025-01-19</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%80%86%E5%90%91%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/" itemprop="url" rel="index"><span itemprop="name">逆向实战案例</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="App信息"><a href="#App信息" class="headerlink" title="App信息"></a>App信息</h1><p>包名：com.martian.ttbook</p>
<p><img src="/2025/01/19/%E6%B7%98%E5%B0%8F%E8%AF%B4app%E5%8F%82%E6%95%B0sign%E5%80%BC%E9%80%86%E5%90%91%E5%8F%8Avip%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90/1.jpg"></p>
<h1 id="抓包分析数据"><a href="#抓包分析数据" class="headerlink" title="抓包分析数据"></a>抓包分析数据</h1><p>发送登录请求，找到登录相关数据包，分析<code>sign</code>参数</p>
<p><img src="/2025/01/19/%E6%B7%98%E5%B0%8F%E8%AF%B4app%E5%8F%82%E6%95%B0sign%E5%80%BC%E9%80%86%E5%90%91%E5%8F%8Avip%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90/2.jpg"></p>
<h1 id="Jadx反编译apk"><a href="#Jadx反编译apk" class="headerlink" title="Jadx反编译apk"></a>Jadx反编译apk</h1><p>搜索<code>sign</code></p>
<p><img src="/2025/01/19/%E6%B7%98%E5%B0%8F%E8%AF%B4app%E5%8F%82%E6%95%B0sign%E5%80%BC%E9%80%86%E5%90%91%E5%8F%8Avip%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90/3.jpg"></p>
<h2 id="intercept"><a href="#intercept" class="headerlink" title="intercept"></a>intercept</h2><p>双击跳转到sign出现的位置</p>
<p><img src="/2025/01/19/%E6%B7%98%E5%B0%8F%E8%AF%B4app%E5%8F%82%E6%95%B0sign%E5%80%BC%E9%80%86%E5%90%91%E5%8F%8Avip%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90/4.jpg"></p>
<p>通过分析上下文可以确定这就是我们要的参数，接下来分析这个参数是怎么生成的</p>
<h2 id="d-d"><a href="#d-d" class="headerlink" title="d.d"></a>d.d</h2><p>它从<code>d.d(treeMap, ConfigSingleton.D().l().f26381b);</code>这个地方过来，我们进入到<code>d</code>方法里看看</p>
<p><img src="/2025/01/19/%E6%B7%98%E5%B0%8F%E8%AF%B4app%E5%8F%82%E6%95%B0sign%E5%80%BC%E9%80%86%E5%90%91%E5%8F%8Avip%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90/5.jpg"></p>
<p>利用frida hook d方法查看它的参数和返回值</p>
<h2 id="hook-d"><a href="#hook-d" class="headerlink" title="hook d"></a>hook d</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function <span class="title function_">hook_d</span><span class="params">()</span>&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        <span class="type">let</span> <span class="variable">d</span> <span class="operator">=</span> Java.use(<span class="string">&quot;ba.d&quot;</span>);</span><br><span class="line">        d[<span class="string">&quot;d&quot;</span>].implementation = function (treeMap, str) &#123;</span><br><span class="line">            console.log(`d.d is called: treeMap=$&#123;treeMap&#125;, str=$&#123;str&#125;`);</span><br><span class="line">            <span class="type">let</span> <span class="variable">result</span> <span class="operator">=</span> <span class="built_in">this</span>[<span class="string">&quot;d&quot;</span>](treeMap, str);</span><br><span class="line">            console.log(`d.d result=$&#123;result&#125;`);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>hook结果</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">d.d is called: </span><br><span class="line">treeMap=&#123;appid=mibook, brand=google, channel=Vivo, code=1111, device_id=b5ffdb56a1f546bc978c7237a06e55e4, model=Pixel 3, optype=0, ostype=0, osversion=9, package_name=com.martian.ttbook, phone=17550373741, t=1737260784077, token=dd1c0464-7a19-460f-b149-8ca0231380e2, uid=83742270, version_code=488, version_name=10.3.6&#125;, </span><br><span class="line">str=mibook_123456</span><br><span class="line">d.d result=24DFDE384CECB241FF0C667046DCD1CF</span><br></pre></td></tr></table></figure>

<h2 id="e"><a href="#e" class="headerlink" title="e"></a>e</h2><p>d方法的返回值调用了e方法，进入e方法查看一下</p>
<p><img src="/2025/01/19/%E6%B7%98%E5%B0%8F%E8%AF%B4app%E5%8F%82%E6%95%B0sign%E5%80%BC%E9%80%86%E5%90%91%E5%8F%8Avip%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90/6.jpg"></p>
<p>这里使用了md5算法，然后对结果又进行了变换，最终转换为字符串返回。</p>
<h2 id="hook-e"><a href="#hook-e" class="headerlink" title="hook e"></a>hook e</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_e</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> d = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;ba.d&quot;</span>);</span><br><span class="line">        d[<span class="string">&quot;e&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">bArr</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`d.e is called: bArr=<span class="subst">$&#123;Java.use(<span class="string">&quot;java.lang.String&quot;</span>).$new(bArr)&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;e&quot;</span>](bArr);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`d.e result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>hook 结果</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d.e is called: bArr=appid=mibook&amp;brand=google&amp;channel=Vivo&amp;code=1111&amp;device_id=b5ffdb56a1f546bc978c7237a06e55e4&amp;model=Pixel 3&amp;optype=0&amp;ostype=0&amp;osversion=9&amp;package_name=com.martian.ttbook&amp;phone=17550373739&amp;t=1737268010279&amp;token=dd1c0464-7a19-460f-b149-8ca0231380e2&amp;uid=83742270&amp;version_code=488&amp;version_name=10.3.6&amp;key=mibook_123456</span><br><span class="line">d.e result=1c6a4ca1d667b3f3878b7d25d59dfce8</span><br></pre></td></tr></table></figure>

<h1 id="Python还原"><a href="#Python还原" class="headerlink" title="Python还原"></a>Python还原</h1><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5_call</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="comment"># 创建md5对象</span></span><br><span class="line">    md5 = hashlib.md5()</span><br><span class="line">    <span class="comment"># 更新要加密的数据，参数要是字节类型</span></span><br><span class="line">    md5.update(data.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">	<span class="comment"># 获取加密后的数据，以字节码表示</span></span><br><span class="line">    md5_byte = md5.digest()</span><br><span class="line">    <span class="keyword">return</span> md5_byte</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义URL和请求头</span></span><br><span class="line">url = <span class="string">&quot;http://tybook.taoyuewenhua.net/phone_login.do&quot;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN-#Hans&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip&quot;</span>,</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;okhttp/4.11.0&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义查询参数</span></span><br><span class="line">params = &#123;</span><br><span class="line">    <span class="string">&quot;appid&quot;</span>: <span class="string">&quot;mibook&quot;</span>,</span><br><span class="line">    <span class="string">&quot;brand&quot;</span>: <span class="string">&quot;google&quot;</span>,</span><br><span class="line">    <span class="string">&quot;channel&quot;</span>: <span class="string">&quot;Vivo&quot;</span>,</span><br><span class="line">    <span class="string">&quot;code&quot;</span>: <span class="string">&quot;1111&quot;</span>,</span><br><span class="line">    <span class="string">&quot;device_id&quot;</span>: <span class="string">&quot;b5ffdb56a1f546bc978c7237a06e55e4&quot;</span>,</span><br><span class="line">    <span class="string">&quot;model&quot;</span>: <span class="string">&quot;Pixel 3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;optype&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ostype&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;osversion&quot;</span>: <span class="string">&quot;9&quot;</span>,</span><br><span class="line">    <span class="string">&quot;package_name&quot;</span>: <span class="string">&quot;com.martian.ttbook&quot;</span>,</span><br><span class="line">    <span class="string">&quot;phone&quot;</span>: <span class="string">&quot;17550373739&quot;</span>,</span><br><span class="line">    <span class="string">&quot;t&quot;</span>:  <span class="string">&quot;1737268010279&quot;</span>, <span class="comment"># str(int(time.time())),</span></span><br><span class="line">    <span class="string">&quot;token&quot;</span> : <span class="string">&quot;dd1c0464-7a19-460f-b149-8ca0231380e2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;uid&quot;</span>: <span class="string">&quot;83742270&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version_code&quot;</span>: <span class="string">&quot;488&quot;</span>,</span><br><span class="line">    <span class="string">&quot;version_name&quot;</span>: <span class="string">&quot;10.3.6&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成sign</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_dign</span>(<span class="params">params</span>):</span><br><span class="line">    treemap_str = <span class="string">&quot;&amp;&quot;</span>.join([key+<span class="string">&quot;=&quot;</span>+value <span class="keyword">for</span> key,value <span class="keyword">in</span> params.items()])</span><br><span class="line">    treemap_str+=<span class="string">&quot;&amp;key=mibook_123456&quot;</span></span><br><span class="line">    <span class="comment"># print(treemap_str)</span></span><br><span class="line">    md5_bytes = <span class="built_in">list</span>(md5_call(treemap_str))</span><br><span class="line">    cArr = [<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>]</span><br><span class="line">    sign_str = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> md5_bytes:</span><br><span class="line">        sign_str+=cArr[(b&gt;&gt;<span class="number">4</span>)&amp;<span class="number">15</span>]</span><br><span class="line">        sign_str+=cArr[b&amp;<span class="number">15</span>]</span><br><span class="line">    <span class="comment"># print(sign_str)</span></span><br><span class="line">    <span class="keyword">return</span> sign_str</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">generate_dign(params)</span><br><span class="line"></span><br><span class="line">params[<span class="string">&quot;sign&quot;</span>]=generate_dign(params)</span><br><span class="line"><span class="built_in">print</span>(params)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送GET请求</span></span><br><span class="line">response = requests.get(url, headers=headers, params=params)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查响应并输出结果</span></span><br><span class="line"><span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Response:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(response.text)  <span class="comment"># 打印响应内容</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Failed to fetch data. HTTP Status Code: <span class="subst">&#123;response.status_code&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Response:</span><br><span class="line">&#123;&quot;errcode&quot;:-1,&quot;errmsg&quot;:&quot;图形验证码，请填入弹框里&quot;&#125;</span><br></pre></td></tr></table></figure>

<h1 id="vip逻辑分析"><a href="#vip逻辑分析" class="headerlink" title="vip逻辑分析"></a>vip逻辑分析</h1><p>jadx里搜索<code>getIsVip</code></p>
<p><img src="/2025/01/19/%E6%B7%98%E5%B0%8F%E8%AF%B4app%E5%8F%82%E6%95%B0sign%E5%80%BC%E9%80%86%E5%90%91%E5%8F%8Avip%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90/7.jpg"></p>
<h2 id="getIsVip"><a href="#getIsVip" class="headerlink" title="getIsVip"></a>getIsVip</h2><p><img src="/2025/01/19/%E6%B7%98%E5%B0%8F%E8%AF%B4app%E5%8F%82%E6%95%B0sign%E5%80%BC%E9%80%86%E5%90%91%E5%8F%8Avip%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90/8.jpg"></p>
<h2 id="利用frida进行hook"><a href="#利用frida进行hook" class="headerlink" title="利用frida进行hook"></a>利用frida进行hook</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_vip</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&quot;com.martian.rpauth.response.MartianRPAccount&quot;</span>,&#123;</span><br><span class="line">            <span class="attr">onMatch</span>:<span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">isVip</span>.<span class="property">value</span>);</span><br><span class="line">                obj.<span class="property">isVip</span>.<span class="property">value</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.Boolean&quot;</span>).$new(<span class="literal">true</span>);</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;replaced isvip:&quot;</span>,obj.<span class="property">isVip</span>.<span class="property">value</span>);</span><br><span class="line">            &#125;,<span class="attr">onComplete</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onComplete!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="title class_">MartianRPAccount</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.martian.rpauth.response.MartianRPAccount&quot;</span>);</span><br><span class="line">        <span class="title class_">MartianRPAccount</span>[<span class="string">&quot;getIsVip&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`MartianRPAccount.getIsVip is called`</span>);</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;getIsVip&quot;</span>]();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`MartianRPAccount.getIsVip result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>hook 结果</p>
<p><img src="/2025/01/19/%E6%B7%98%E5%B0%8F%E8%AF%B4app%E5%8F%82%E6%95%B0sign%E5%80%BC%E9%80%86%E5%90%91%E5%8F%8Avip%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90/9.jpg"></p>
<p><img src="/2025/01/19/%E6%B7%98%E5%B0%8F%E8%AF%B4app%E5%8F%82%E6%95%B0sign%E5%80%BC%E9%80%86%E5%90%91%E5%8F%8Avip%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90/10.jpg"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/01/18/OkHttp%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android.svg">
      <meta itemprop="name" content="Bileton">
      <meta itemprop="description" content="路漫漫其修远夕！">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="白乐天">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/01/18/OkHttp%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/" class="post-title-link" itemprop="url">OkHttp网络通信</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-01-18 15:14:20" itemprop="dateCreated datePublished" datetime="2025-01-18T15:14:20+08:00">2025-01-18</time>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>0</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/01/17/Frida%E5%8F%8D%E8%B0%83%E8%AF%95%E7%AF%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android.svg">
      <meta itemprop="name" content="Bileton">
      <meta itemprop="description" content="路漫漫其修远夕！">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="白乐天">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/01/17/Frida%E5%8F%8D%E8%B0%83%E8%AF%95%E7%AF%87/" class="post-title-link" itemprop="url">Frida反调试篇</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-01-17 17:15:57 / 修改时间：17:41:35" itemprop="dateCreated datePublished" datetime="2025-01-17T17:15:57+08:00">2025-01-17</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Frida/" itemprop="url" rel="index"><span itemprop="name">Frida</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>9</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="魔改Frida特征"><a href="#魔改Frida特征" class="headerlink" title="魔改Frida特征"></a>魔改Frida特征</h1>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/01/16/ndk%E5%BC%80%E5%8F%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android.svg">
      <meta itemprop="name" content="Bileton">
      <meta itemprop="description" content="路漫漫其修远夕！">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="白乐天">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/01/16/ndk%E5%BC%80%E5%8F%91/" class="post-title-link" itemprop="url">ndk开发</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-01-16 00:47:49" itemprop="dateCreated datePublished" datetime="2025-01-16T00:47:49+08:00">2025-01-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-01-21 21:06:55" itemprop="dateModified" datetime="2025-01-21T21:06:55+08:00">2025-01-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">安卓开发</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><h2 id="NDK（Native-Development-Kit）"><a href="#NDK（Native-Development-Kit）" class="headerlink" title="NDK（Native Development Kit）"></a>NDK（Native Development Kit）</h2><p>Android NDK 是一个工具集，可以使用 C 和 C++ 等语言以原生代码实现应用的各个部分。<br>NDK提供了一系列的工具，帮助开发者快速开发C（或C++）的动态库，并能自动将so和java应用一起打包成apk。</p>
<h2 id="JNI（Java-Native-Interface）"><a href="#JNI（Java-Native-Interface）" class="headerlink" title="JNI（Java Native Interface）"></a>JNI（Java Native Interface）</h2><p>从Java1.1开始，jni标准成为Java平台的一部分，允许Java代码和其他语言写的代码进行交互。<br>NDK是开发套件，JNI才是调用的框架。JNI是Java调用Native 语言的一种特性。通过JNI可以使得Java与C&#x2F;C++机型交互。</p>
<h1 id="ndk中的Log输出"><a href="#ndk中的Log输出" class="headerlink" title="ndk中的Log输出"></a>ndk中的Log输出</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;android/log.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOG_TAG <span class="string">&quot;MyApp&quot;</span>  <span class="comment">// 设置日志标签</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> __android_log_print(<span class="type">int</span> priority, <span class="type">const</span> <span class="type">char</span> *tag,  <span class="type">const</span> <span class="type">char</span> *fmt, ...);</span><br><span class="line"></span><br><span class="line"><span class="comment">// priority: 日志的优先级（日志级别），决定日志的严重性。</span></span><br><span class="line"><span class="comment">// tag: 日志标签，用于标识日志来源。通常是应用的名称或功能模块。</span></span><br><span class="line"><span class="comment">// fmt: 格式化字符串，类似于 C 标准库中的 printf 格式。</span></span><br><span class="line"><span class="comment">// ...: 可选的附加参数，用于格式化字符串的内容。</span></span><br></pre></td></tr></table></figure>

<p><strong>示例</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;android/log.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOG_TAG <span class="string">&quot;MyNDKApp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">logExample</span><span class="params">()</span> &#123;</span><br><span class="line">    __android_log_print(ANDROID_LOG_VERBOSE, LOG_TAG, <span class="string">&quot;This is a VERBOSE log&quot;</span>);</span><br><span class="line">    __android_log_print(ANDROID_LOG_DEBUG, LOG_TAG, <span class="string">&quot;This is a DEBUG log&quot;</span>);</span><br><span class="line">    __android_log_print(ANDROID_LOG_INFO, LOG_TAG, <span class="string">&quot;This is an INFO log&quot;</span>);</span><br><span class="line">    __android_log_print(ANDROID_LOG_WARN, LOG_TAG, <span class="string">&quot;This is a WARN log&quot;</span>);</span><br><span class="line">    __android_log_print(ANDROID_LOG_ERROR, LOG_TAG, <span class="string">&quot;This is an ERROR log&quot;</span>);</span><br><span class="line">    __android_log_print(ANDROID_LOG_FATAL, LOG_TAG, <span class="string">&quot;This is a FATAL log&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="ndk初始化函数与构造函数"><a href="#ndk初始化函数与构造函数" class="headerlink" title="ndk初始化函数与构造函数"></a>ndk初始化函数与构造函数</h1><h2 id="init-函数"><a href="#init-函数" class="headerlink" title="_init 函数"></a>_init 函数</h2><p><code>_init</code> 函数与程序初始化有关。它会在动态库被加载时自动调用，通常用于执行一些初始化操作。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="type">void</span> _init() &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="attribute-constructor-构造函数"><a href="#attribute-constructor-构造函数" class="headerlink" title="attribute((constructor))构造函数"></a><strong>attribute</strong>((constructor))构造函数</h2><p>指定函数为构造函数，使得它们在程序或动态库加载时自动执行。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__attribute__ ((constructor)) <span class="type">void</span> <span class="title function_">init_function1</span><span class="params">()</span> &#123;</span><br><span class="line">    __android_log_print(ANDROID_LOG_DEBUG, <span class="string">&quot;initTest&quot;</span>, <span class="string">&quot;This is a init_function1 log&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>设置优先级</strong></p>
<p>当定义多个构造函数时，它们会按优先级顺序执行。如果没有显式指定优先级，则按声明顺序执行。优先级越低的构造函数会先执行，数字越高，执行顺序越靠后。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">__attribute__ ((constructor(<span class="number">300</span>))) <span class="type">void</span> <span class="title function_">init_function2</span><span class="params">()</span>&#123;</span><br><span class="line">    __android_log_print(ANDROID_LOG_DEBUG, <span class="string">&quot;initTest&quot;</span>, <span class="string">&quot;This is a init_function2 log&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__attribute__ ((constructor(<span class="number">200</span>))) <span class="type">void</span> <span class="title function_">init_function3</span><span class="params">()</span>&#123;</span><br><span class="line">    __android_log_print(ANDROID_LOG_DEBUG, <span class="string">&quot;initTest&quot;</span>, <span class="string">&quot;This is a init_function3 log&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>隐藏函数符号</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__attribute__ ((constructor, visibility(<span class="string">&quot;hidden&quot;</span>))) <span class="type">void</span> <span class="title function_">init_function4</span><span class="params">()</span> &#123;</span><br><span class="line">    __android_log_print(ANDROID_LOG_DEBUG, <span class="string">&quot;initTest&quot;</span>, <span class="string">&quot;This is a init_function4 log&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="demo测试"><a href="#demo测试" class="headerlink" title="demo测试"></a>demo测试</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="type">void</span> _init()&#123;</span><br><span class="line">    __android_log_print(ANDROID_LOG_DEBUG, <span class="string">&quot;initTest&quot;</span>, <span class="string">&quot;This is a _init log&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__attribute__ ((constructor)) <span class="type">void</span> <span class="title function_">init_function1</span><span class="params">()</span>&#123;</span><br><span class="line">    __android_log_print(ANDROID_LOG_DEBUG, <span class="string">&quot;initTest&quot;</span>, <span class="string">&quot;This is a init_function1 log&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__attribute__ ((constructor(<span class="number">300</span>))) <span class="type">void</span> <span class="title function_">init_function2</span><span class="params">()</span>&#123;</span><br><span class="line">    __android_log_print(ANDROID_LOG_DEBUG, <span class="string">&quot;initTest&quot;</span>, <span class="string">&quot;This is a init_function2 log&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__attribute__ ((constructor(<span class="number">200</span>))) <span class="type">void</span> <span class="title function_">init_function3</span><span class="params">()</span>&#123;</span><br><span class="line">    __android_log_print(ANDROID_LOG_DEBUG, <span class="string">&quot;initTest&quot;</span>, <span class="string">&quot;This is a init_function3 log&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__attribute__ ((constructor, visibility(<span class="string">&quot;hidden&quot;</span>))) <span class="type">void</span> <span class="title function_">init_function4</span><span class="params">()</span>&#123;</span><br><span class="line">    __android_log_print(ANDROID_LOG_DEBUG, <span class="string">&quot;initTest&quot;</span>, <span class="string">&quot;This is a init_function4 log&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>输出日志</strong></p>
<p><img src="/2025/01/16/ndk%E5%BC%80%E5%8F%91/1.jpg"></p>
<p><code>_init</code>函数是最先执行的函数，然后按照构造函数的优先级顺序执行。</p>
<h2 id="反汇编分析"><a href="#反汇编分析" class="headerlink" title="反汇编分析"></a>反汇编分析</h2><p><code>__init</code>函数经过反编译得到了<code>.init_proc</code>函数</p>
<p><img src="/2025/01/16/ndk%E5%BC%80%E5%8F%91/2.jpg"></p>
<p>构造函数出现在<code>.init_array</code>段里</p>
<p><img src="/2025/01/16/ndk%E5%BC%80%E5%8F%91/3.jpg"></p>
<h2 id="函数执行顺序"><a href="#函数执行顺序" class="headerlink" title="函数执行顺序"></a>函数执行顺序</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">_init</span><br><span class="line">constructor</span><br><span class="line">JNI_Onload</span><br><span class="line">其他函数</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/01/15/AndroidDemo-Hook%E6%A1%88%E4%BE%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android.svg">
      <meta itemprop="name" content="Bileton">
      <meta itemprop="description" content="路漫漫其修远夕！">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="白乐天">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/01/15/AndroidDemo-Hook%E6%A1%88%E4%BE%8B/" class="post-title-link" itemprop="url">AndroidDemo Hook案例</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-01-15 17:49:11" itemprop="dateCreated datePublished" datetime="2025-01-15T17:49:11+08:00">2025-01-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-01-22 20:58:03" itemprop="dateModified" datetime="2025-01-22T20:58:03+08:00">2025-01-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%80%86%E5%90%91%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/" itemprop="url" rel="index"><span itemprop="name">逆向实战案例</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>13k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>12 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="App信息"><a href="#App信息" class="headerlink" title="App信息"></a>App信息</h1><p>包名：com.example.androiddemo</p>
<h1 id="第一关"><a href="#第一关" class="headerlink" title="第一关"></a>第一关</h1><p>一个登录界面</p>
<p><img src="/2025/01/15/AndroidDemo-Hook%E6%A1%88%E4%BE%8B/1.jpg"></p>
<p>把apk丢进jadx进行分析</p>
<p>查看<code>AndroidManifest.xml</code>文件</p>
<p>程序启动的第一个<code>Activity</code>是<code>com.example.androiddemo.Activity.LoginActivity</code></p>
<p><img src="/2025/01/15/AndroidDemo-Hook%E6%A1%88%E4%BE%8B/2.jpg"></p>
<h2 id="LoginActivity"><a href="#LoginActivity" class="headerlink" title="LoginActivity"></a>LoginActivity</h2><p>如下，调用了一个<code>a</code>方法来对用户名和密码进行校验</p>
<p><img src="/2025/01/15/AndroidDemo-Hook%E6%A1%88%E4%BE%8B/3.jpg"></p>
<h3 id="a"><a href="#a" class="headerlink" title="a"></a>a</h3><p>如下，对<code>Username</code>进行了一次<code>HmacSHA256</code>签名</p>
<p><img src="/2025/01/15/AndroidDemo-Hook%E6%A1%88%E4%BE%8B/4.jpg"></p>
<p>当<code>Username</code>的<code>HmacSHA256</code>签名与<code>Password</code>相同时，可以登录成功。</p>
<h3 id="hook-a"><a href="#hook-a" class="headerlink" title="hook a"></a>hook a</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_a</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">LoginActivity</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.example.androiddemo.Activity.LoginActivity&quot;</span>)</span><br><span class="line">        <span class="title class_">LoginActivity</span>.<span class="property">a</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.lang.String&#x27;</span>, <span class="string">&#x27;java.lang.String&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">str1,str2</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;str1:&quot;</span>,str1);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;str2:&quot;</span>,str2);</span><br><span class="line">            <span class="keyword">var</span> result = <span class="variable language_">this</span>.<span class="title function_">a</span>(str1,str2);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;result:&quot;</span>,result);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">hook_a</span>()</span><br></pre></td></tr></table></figure>

<p><strong>hook 结果</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bileton</span><br><span class="line">77cd249b2fa536da37dcd3fc6993fe94aefb61a70328aa4cd12984a053f6a7c3</span><br></pre></td></tr></table></figure>

<p>输入用户名和密码</p>
<p>登录成功</p>
<p><img src="/2025/01/15/AndroidDemo-Hook%E6%A1%88%E4%BE%8B/5.jpg"></p>
<h2 id="进入下一关"><a href="#进入下一关" class="headerlink" title="进入下一关"></a>进入下一关</h2><p>点击进入下一关，会出现<code>Check Failed</code></p>
<p><img src="/2025/01/15/AndroidDemo-Hook%E6%A1%88%E4%BE%8B/6.jpg"></p>
<h2 id="FridaActivity1"><a href="#FridaActivity1" class="headerlink" title="FridaActivity1"></a>FridaActivity1</h2><p>查看源码，得知点击登录之后，会进入<code>FridaActivity1</code></p>
<p><img src="/2025/01/15/AndroidDemo-Hook%E6%A1%88%E4%BE%8B/7.jpg"></p>
<p>如下是<code>FridaActivity1</code>的内容</p>
<p><img src="/2025/01/15/AndroidDemo-Hook%E6%A1%88%E4%BE%8B/9.jpg"></p>
<p>绕过方式很简单，可以直接修改<code>a</code>方法的返回值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_a</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">FridaActivity1</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.example.androiddemo.Activity.FridaActivity1&quot;</span>);</span><br><span class="line">        <span class="title class_">FridaActivity1</span>.<span class="property">a</span>.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">data</span>)&#123;</span><br><span class="line">            <span class="keyword">var</span> result = <span class="variable language_">this</span>.<span class="title function_">a</span>(data);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;result:&quot;</span>,result)</span><br><span class="line">            result =  <span class="string">&quot;R4jSLLLLLLLLLLOrLE7/5B+Z6fsl65yj6BgC6YWz66gO6g2t65Pk6a+P65NK44NNROl0wNOLLLL=&quot;</span>;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;replaced result:&quot;</span>,result)</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">hook_a</span>()</span><br></pre></td></tr></table></figure>

<p><strong>hook 结果</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">result: R4jSLLLLLLLLLRknplkBpZDpis69kh7i+YAPTmMn2ABsOLLLLL==</span><br><span class="line">replaced result: R4jSLLLLLLLLLLOrLE7/5B+Z6fsl65yj6BgC6YWz66gO6g2t65Pk6a+P65NK44NNROl0wNOLLLL=</span><br></pre></td></tr></table></figure>

<p>还有另一种绕过方式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_a</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">FridaActivity1</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.example.androiddemo.Activity.FridaActivity1&quot;</span>);</span><br><span class="line">        <span class="title class_">FridaActivity1</span>.<span class="property">a</span>.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">original_data</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;original_data:&quot;</span>,original_data);</span><br><span class="line">            <span class="keyword">var</span> my_data = <span class="title class_">FridaActivity1</span>.<span class="title function_">b</span>(<span class="string">&quot;bileton&quot;</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;data:&quot;</span>,my_data);</span><br><span class="line">            <span class="keyword">var</span> result = <span class="variable language_">this</span>.<span class="title function_">a</span>(my_data);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;result:&quot;</span>,result);</span><br><span class="line">            result =  <span class="string">&quot;R4jSLLLLLLLLLLOrLE7/5B+Z6fsl65yj6BgC6YWz66gO6g2t65Pk6a+P65NK44NNROl0wNOLLLL=&quot;</span>;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;replaced result:&quot;</span>,result)</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">hook_a</span>()</span><br></pre></td></tr></table></figure>

<p><strong>hook 结果</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">original_data: 31,-117,8,0,0,0,0,0,0,0,123,-79,126,-5,-117,125,-109,-97,-74,46,125,-70,-66,-19,-7,-126,70,43,0,-15,-40,-110,-30,16,0,0,0</span><br><span class="line">data: 31,-117,8,0,0,0,0,0,0,0,75,-54,-52,73,45,-55,-49,3,0,-26,-70,19,-27,7,0,0,0</span><br><span class="line">result: R4jSLLLLLLLLLOlTzOuiyc8MLDa5O+URLLLL</span><br><span class="line">replaced result: R4jSLLLLLLLLLLOrLE7/5B+Z6fsl65yj6BgC6YWz66gO6g2t65Pk6a+P65NK44NNROl0wNOLLLL=</span><br></pre></td></tr></table></figure>

<p>进入到了第二关</p>
<p><img src="/2025/01/15/AndroidDemo-Hook%E6%A1%88%E4%BE%8B/8.jpg"></p>
<h1 id="第二关"><a href="#第二关" class="headerlink" title="第二关"></a>第二关</h1><p>第一关结束跳转到了<code>FridaActivity2</code></p>
<p><img src="/2025/01/15/AndroidDemo-Hook%E6%A1%88%E4%BE%8B/10.jpg"></p>
<p>需要把<code>static_bool_var</code>和<code>bool_var</code>的值都修改为<code>true</code>才能进入<code>FridaActivity3</code></p>
<p>这里可以主动调用<code>setStatic_bool_var</code>方法和<code>setBool_var</code>方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_activity2</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">FridaActivity2</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.example.androiddemo.Activity.FridaActivity2&quot;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;static_bool_var:&quot;</span>,<span class="title class_">FridaActivity2</span>.<span class="property">static_bool_var</span>.<span class="property">value</span>);</span><br><span class="line">        <span class="title class_">FridaActivity2</span>.<span class="title function_">setStatic_bool_var</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;replaced_static_bool_var:&quot;</span>,<span class="title class_">FridaActivity2</span>.<span class="property">static_bool_var</span>.<span class="property">value</span>);</span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&quot;com.example.androiddemo.Activity.FridaActivity2&quot;</span>,&#123;</span><br><span class="line">            <span class="attr">onMatch</span>:<span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;obj.bool_var:&quot;</span>,obj.<span class="property">bool_var</span>.<span class="property">value</span>);</span><br><span class="line">                obj.<span class="title function_">setBool_var</span>();</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;replaced_obj.bool_var:&quot;</span>,obj.<span class="property">bool_var</span>.<span class="property">value</span>);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onComplete</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>hook 结果</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">static_bool_var: false</span><br><span class="line">replaced_static_bool_var: true</span><br><span class="line">obj.bool_var: false</span><br><span class="line">replaced_obj.bool_var: true</span><br></pre></td></tr></table></figure>

<p>点击进入第三关</p>
<h1 id="第三关"><a href="#第三关" class="headerlink" title="第三关"></a>第三关</h1><p>第二关结束跳转到了<code>FridaActivity3</code></p>
<p><img src="/2025/01/15/AndroidDemo-Hook%E6%A1%88%E4%BE%8B/11.jpg"></p>
<p>需要把<code>static_bool_var</code>、<code>bool_var</code>、<code>same_name_bool_var</code>三个值都设置为<code>true</code>才能进入<code>FridaActivity4</code></p>
<p>这里存在一个坑点是存在一个与字段名<code>same_name_bool_var</code>相同的方法名<code>same_name_bool_var</code>，操作字段名的话需要在其名字前面加上一个<code>_</code>，即<code>_same_name_bool_var</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_activity3</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">FridaActivity3</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.example.androiddemo.Activity.FridaActivity3&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;static_bool_var:&quot;</span>,<span class="title class_">FridaActivity3</span>.<span class="property">static_bool_var</span>.<span class="property">value</span>);</span><br><span class="line">    <span class="title class_">FridaActivity3</span>.<span class="property">static_bool_var</span>.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;replaced_static_bool_var:&quot;</span>,<span class="title class_">FridaActivity3</span>.<span class="property">static_bool_var</span>.<span class="property">value</span>);</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&quot;com.example.androiddemo.Activity.FridaActivity3&quot;</span>,&#123;</span><br><span class="line">        <span class="attr">onMatch</span>:<span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;obj.bool_var:&quot;</span>,obj.<span class="property">bool_var</span>.<span class="property">value</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;obj._same_name_bool_var:&quot;</span>,obj.<span class="property">_same_name_bool_var</span>.<span class="property">value</span>);</span><br><span class="line">            obj.<span class="property">bool_var</span>.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">            obj.<span class="property">_same_name_bool_var</span>.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;replaced_obj.bool_var:&quot;</span>,obj.<span class="property">bool_var</span>.<span class="property">value</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;replaced_obj._same_name_bool_var:&quot;</span>,obj.<span class="property">_same_name_bool_var</span>.<span class="property">value</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onComplete</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>hook 结果</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">static_bool_var: false</span><br><span class="line">replaced_static_bool_var: true</span><br><span class="line">obj.bool_var: false</span><br><span class="line">obj._same_name_bool_var: false</span><br><span class="line">replaced_obj.bool_var: true</span><br><span class="line">replaced_obj._same_name_bool_var: true</span><br></pre></td></tr></table></figure>

<p>点击进入第四关</p>
<h1 id="第四关"><a href="#第四关" class="headerlink" title="第四关"></a>第四关</h1><p>第三关结束跳转到了<code>FridaActivity4</code></p>
<p>如下是第四关的源代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FridaActivity4</span> <span class="keyword">extends</span> <span class="title class_">BaseFridaActivity</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// com.example.androiddemo.Activity.BaseFridaActivity</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getNextCheckTitle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;当前第4关&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">InnerClasses</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">check1</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">check2</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">check3</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">check4</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">check5</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">check6</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">InnerClasses</span><span class="params">()</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// com.example.androiddemo.Activity.BaseFridaActivity</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCheck</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (InnerClasses.check1() &amp;&amp; InnerClasses.check2() &amp;&amp; InnerClasses.check3() &amp;&amp; InnerClasses.check4() &amp;&amp; InnerClasses.check5() &amp;&amp; InnerClasses.check6()) &#123;</span><br><span class="line">            CheckSuccess();</span><br><span class="line">            startActivity(<span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="built_in">this</span>, (Class&lt;?&gt;) FridaActivity5.class));</span><br><span class="line">            finishActivity(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">super</span>.CheckFailed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里出现了内部类，需要把内部类中的方法返回值都设置为<code>true</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_activity4</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">InnerClasses</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.example.androiddemo.Activity.FridaActivity4$InnerClasses&quot;</span>);</span><br><span class="line">    <span class="title class_">InnerClasses</span>.<span class="property">check1</span>.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">InnerClasses</span>.<span class="property">check2</span>.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">InnerClasses</span>.<span class="property">check3</span>.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">InnerClasses</span>.<span class="property">check4</span>.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">InnerClasses</span>.<span class="property">check5</span>.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">InnerClasses</span>.<span class="property">check6</span>.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>点击进入第五关</p>
<h1 id="第五关"><a href="#第五关" class="headerlink" title="第五关"></a>第五关</h1><p>第四关结束跳转到了<code>FridaActivity5</code></p>
<p><strong>查看<code>check</code>逻辑</strong></p>
<p><img src="/2025/01/15/AndroidDemo-Hook%E6%A1%88%E4%BE%8B/12.jpg"></p>
<p><strong>尝试hook <code>check</code>方法</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_activity5</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="title class_">CheckInterface</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.example.androiddemo.Dynamic.CheckInterface&quot;</span>);</span><br><span class="line">        <span class="title class_">CheckInterface</span>[<span class="string">&quot;check&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`CheckInterface.check is called`</span>);</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;check&quot;</span>]();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`CheckInterface.check result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>没有输出</p>
<p>查看<code>getDynamicDexCheck</code>方法</p>
<p><img src="/2025/01/15/AndroidDemo-Hook%E6%A1%88%E4%BE%8B/13.jpg"></p>
<p><strong>hook getDynamicDexCheck</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_activity5</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="title class_">FridaActivity5</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.example.androiddemo.Activity.FridaActivity5&quot;</span>);</span><br><span class="line">        <span class="title class_">FridaActivity5</span>[<span class="string">&quot;getDynamicDexCheck&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`FridaActivity5.getDynamicDexCheck is called`</span>);</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;getDynamicDexCheck&quot;</span>]();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`FridaActivity5.getDynamicDexCheck result=<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(result)&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>hook 结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FridaActivity5.getDynamicDexCheck is called</span><br><span class="line">FridaActivity5.getDynamicDexCheck result=&quot;&lt;instance: com.example.androiddemo.Dynamic.CheckInterface, $className: com.example.androiddemo.Dynamic.DynamicCheck&gt;&quot;</span><br></pre></td></tr></table></figure>

<p><strong>查看loaddex()方法</strong></p>
<p>源码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">loaddex</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">File</span> <span class="variable">cacheDir</span> <span class="operator">=</span> getCacheDir();</span><br><span class="line">    <span class="keyword">if</span> (!cacheDir.exists()) &#123;</span><br><span class="line">        cacheDir.mkdir();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> cacheDir.getAbsolutePath() + File.separator + <span class="string">&quot;DynamicPlugin.dex&quot;</span>;</span><br><span class="line">    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(str);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!file.exists()) &#123;</span><br><span class="line">            file.createNewFile();</span><br><span class="line">            copyFiles(<span class="built_in">this</span>, <span class="string">&quot;DynamicPlugin.dex&quot;</span>, file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.DynamicDexCheck = (CheckInterface) <span class="keyword">new</span> <span class="title class_">DexClassLoader</span>(str, cacheDir.getAbsolutePath(), <span class="literal">null</span>, getClassLoader()).loadClass(<span class="string">&quot;com.example.androiddemo.Dynamic.DynamicCheck&quot;</span>).newInstance();</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.DynamicDexCheck == <span class="literal">null</span>) &#123;</span><br><span class="line">            Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;loaddex Failed!&quot;</span>, <span class="number">1</span>).show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e2) &#123;</span><br><span class="line">        e2.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> CheckInterface <span class="title function_">getDynamicDexCheck</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.DynamicDexCheck == <span class="literal">null</span>) &#123;</span><br><span class="line">        loaddex();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.DynamicDexCheck;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过 <code>DexClassLoader</code>动态加载一个 <code>.dex</code> 文件（<code>DynamicPlugin.dex</code>），然后通过反射创建并实例化其中的一个类 <code>com.example.androiddemo.Dynamic.DynamicCheck</code>，并将其转换为 <code>CheckInterface</code> 接口的实例。</p>
<p><strong>enumerateClassLoader()</strong></p>
<p>枚举类加载器</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">enumclassLoader</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title class_">Java</span>.<span class="title function_">enumerateClassLoaders</span>(&#123;</span><br><span class="line">                <span class="attr">onMatch</span>: <span class="keyword">function</span> (<span class="params">loader</span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Found ClassLoader: &quot;</span> + loader);</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">onComplete</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ClassLoader enumeration complete&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>hook 结果</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Found</span> <span class="title class_">ClassLoader</span>: dalvik.<span class="property">system</span>.<span class="property">PathClassLoader</span>[<span class="title class_">DexPathList</span>[[directory <span class="string">&quot;.&quot;</span>],nativeLibraryDirectories=[<span class="regexp">/system/</span>lib64, <span class="regexp">/system/</span>lib64]]]</span><br><span class="line"><span class="title class_">Found</span> <span class="title class_">ClassLoader</span>: java.<span class="property">lang</span>.<span class="property">BootClassLoader</span>@1a74373</span><br><span class="line"><span class="title class_">Found</span> <span class="title class_">ClassLoader</span>: dalvik.<span class="property">system</span>.<span class="property">PathClassLoader</span>[<span class="title class_">DexPathList</span>[[zip file <span class="string">&quot;/data/app/com.example.androiddemo-gOT-dni2KR2j2MT4Q9cP5g==/base.apk&quot;</span>],nativeLibraryDirectories=[<span class="regexp">/data/</span>app/com.<span class="property">example</span>.<span class="property">androiddemo</span>-gOT-dni2KR2j2MT4Q9cP5g==<span class="regexp">/lib/</span>arm64, <span class="regexp">/data/</span>app/com.<span class="property">example</span>.<span class="property">androiddemo</span>-gOT-dni2KR2j2MT4Q9cP5g==<span class="regexp">/base.apk!/</span>lib/arm64-v8a, <span class="regexp">/system/</span>lib64]]]</span><br><span class="line"><span class="title class_">Found</span> <span class="title class_">ClassLoader</span>: dalvik.<span class="property">system</span>.<span class="property">DexClassLoader</span>[<span class="title class_">DexPathList</span>[[dex file <span class="string">&quot;/data/user/0/com.example.androiddemo/cache/DynamicPlugin.dex&quot;</span>],nativeLibraryDirectories=[<span class="regexp">/system/</span>lib64]]]</span><br><span class="line"><span class="title class_">ClassLoader</span> enumeration complete</span><br></pre></td></tr></table></figure>

<p><code>dalvik.system.DexClassLoader</code>就是要找的类加载器</p>
<p>修改<code>DexClassLoader</code>对<code>check</code>进行hook</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">enumclassLoader</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">enumerateClassLoaders</span>(&#123;</span><br><span class="line">            <span class="attr">onMatch</span>: <span class="keyword">function</span> (<span class="params">loader</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    <span class="keyword">if</span>(loader.<span class="title function_">findClass</span>(<span class="string">&quot;com.example.androiddemo.Dynamic.DynamicCheck&quot;</span>))&#123;</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;loader:&quot;</span>,loader)</span><br><span class="line">                        <span class="title class_">Java</span>.<span class="property">classFactory</span>.<span class="property">loader</span> = loader;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onComplete</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ClassLoader enumeration complete&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="title class_">DynamicCheck</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.example.androiddemo.Dynamic.DynamicCheck&quot;</span>);</span><br><span class="line">        <span class="title class_">DynamicCheck</span>[<span class="string">&quot;check&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`DynamicCheck.check is called`</span>);</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;check&quot;</span>]();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`DynamicCheck.check result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">            result = <span class="literal">true</span>;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`DynamicCheck.check replaced result=<span class="subst">$&#123;result&#125;</span>`</span>)</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>hook结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">enumclassLoader()</span><br><span class="line">loader: dalvik.system.DexClassLoader[DexPathList[[dex file &quot;/data/user/0/com.example.androiddemo/cache/DynamicPlugin.dex&quot;],nativeLibraryDirectories=[/system/lib64]]]</span><br><span class="line">ClassLoader enumeration complete</span><br><span class="line">DynamicCheck.check is called</span><br><span class="line">DynamicCheck.check result=false</span><br><span class="line">DynamicCheck.check replaced result=true</span><br></pre></td></tr></table></figure>

<p>点击进入第六关</p>
<h1 id="第六关"><a href="#第六关" class="headerlink" title="第六关"></a>第六关</h1><p>第五关结束跳转到了<code>FridaActivity6</code></p>
<p><img src="/2025/01/15/AndroidDemo-Hook%E6%A1%88%E4%BE%8B/14.jpg"></p>
<p>这里有三个check函数，他们的逻辑都是一样的，如下</p>
<p><img src="/2025/01/15/AndroidDemo-Hook%E6%A1%88%E4%BE%8B/15.jpg"></p>
<p><strong>hook check</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_activity6</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="title class_">Frida6Class0</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.example.androiddemo.Activity.Frida6.Frida6Class0&quot;</span>);</span><br><span class="line">        <span class="title class_">Frida6Class0</span>[<span class="string">&quot;check&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Frida6Class0.check is called`</span>);</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;check&quot;</span>]();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Frida6Class0.check result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">            result = <span class="literal">true</span>;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Frida6Class0.check replaced result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="title class_">Frida6Class1</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.example.androiddemo.Activity.Frida6.Frida6Class1&quot;</span>);</span><br><span class="line">        <span class="title class_">Frida6Class1</span>[<span class="string">&quot;check&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Frida6Class1.check is called`</span>);</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;check&quot;</span>]();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Frida6Class1.check result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">            result = <span class="literal">true</span>;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Frida6Class1.check replaced result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="title class_">Frida6Class2</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.example.androiddemo.Activity.Frida6.Frida6Class2&quot;</span>);</span><br><span class="line">        <span class="title class_">Frida6Class2</span>[<span class="string">&quot;check&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Frida6Class2.check is called`</span>);</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;check&quot;</span>]();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Frida6Class2.check result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">            result = <span class="literal">true</span>;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Frida6Class2.check replaced result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>hook 结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Frida6Class0.check is called</span><br><span class="line">Frida6Class0.check result=false</span><br><span class="line">Frida6Class0.check replaced result=true</span><br><span class="line">Frida6Class1.check is called</span><br><span class="line">Frida6Class1.check result=false</span><br><span class="line">Frida6Class1.check replaced result=true</span><br><span class="line">Frida6Class2.check is called</span><br><span class="line">Frida6Class2.check result=false</span><br><span class="line">Frida6Class2.check replaced result=true</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/01/14/English-Words-Study/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android.svg">
      <meta itemprop="name" content="Bileton">
      <meta itemprop="description" content="路漫漫其修远夕！">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="白乐天">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/01/14/English-Words-Study/" class="post-title-link" itemprop="url">English Words Study</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-01-14 22:56:18" itemprop="dateCreated datePublished" datetime="2025-01-14T22:56:18+08:00">2025-01-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-01-22 22:29:19" itemprop="dateModified" datetime="2025-01-22T22:29:19+08:00">2025-01-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%8B%B1%E8%AF%AD%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">英语学习</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>281</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="A"><a href="#A" class="headerlink" title="A"></a>A</h1><h2 id="b"><a href="#b" class="headerlink" title="b"></a>b</h2><h3 id="abandon"><a href="#abandon" class="headerlink" title="abandon"></a>abandon</h3><p>v.放弃，抛弃</p>
<h2 id="t"><a href="#t" class="headerlink" title="t"></a>t</h2><h3 id="attach"><a href="#attach" class="headerlink" title="attach"></a>attach</h3><p>附加；贴上</p>
<h1 id="C"><a href="#C" class="headerlink" title="C"></a>C</h1><h2 id="u"><a href="#u" class="headerlink" title="u"></a>u</h2><h3 id="custom"><a href="#custom" class="headerlink" title="custom"></a>custom</h3><p>n.风俗；习惯；传统</p>
<p>adj.定制的</p>
<h1 id="G"><a href="#G" class="headerlink" title="G"></a>G</h1><h2 id="e"><a href="#e" class="headerlink" title="e"></a>e</h2><h3 id="generate"><a href="#generate" class="headerlink" title="generate"></a>generate</h3><p>v.产生；引起；生成</p>
<h1 id="I"><a href="#I" class="headerlink" title="I"></a>I</h1><h2 id="n"><a href="#n" class="headerlink" title="n"></a>n</h2><h3 id="instrumentation"><a href="#instrumentation" class="headerlink" title="instrumentation"></a>instrumentation</h3><p>n.仪器；器乐谱写；测试设备</p>
<h3 id="intent"><a href="#intent" class="headerlink" title="intent"></a>intent</h3><p>adj.全神贯注的；专心致志的</p>
<p>n.意图；意向；目的</p>
<h1 id="L"><a href="#L" class="headerlink" title="L"></a>L</h1><h2 id="e-1"><a href="#e-1" class="headerlink" title="e"></a>e</h2><h3 id="leak"><a href="#leak" class="headerlink" title="leak"></a>leak</h3><p>v.泄露</p>
<h1 id="P"><a href="#P" class="headerlink" title="P"></a>P</h1><h2 id="e-2"><a href="#e-2" class="headerlink" title="e"></a>e</h2><h3 id="peek"><a href="#peek" class="headerlink" title="peek"></a>peek</h3><p>v.窥视，偷看</p>
<h1 id="S"><a href="#S" class="headerlink" title="S"></a>S</h1><h2 id="i"><a href="#i" class="headerlink" title="i"></a>i</h2><h3 id="sign"><a href="#sign" class="headerlink" title="sign"></a>sign</h3><p>v.签名；做手势</p>
<p>n.记号；符合；标志；手势；</p>
<h3 id="signal"><a href="#signal" class="headerlink" title="signal"></a>signal</h3><p>v.发信号；标志；</p>
<p>n.信号；标志；</p>
<h2 id="p"><a href="#p" class="headerlink" title="p"></a>p</h2><h3 id="spawn"><a href="#spawn" class="headerlink" title="spawn"></a>spawn</h3><p>n.卵；菌丝；产物</p>
<p>v.产卵；启动；</p>
<h2 id="t-1"><a href="#t-1" class="headerlink" title="t"></a>t</h2><h3 id="standard"><a href="#standard" class="headerlink" title="standard"></a>standard</h3><p>n.标准；规格，规范；</p>
<p>adj.标准的</p>
<h1 id="T"><a href="#T" class="headerlink" title="T"></a>T</h1><h2 id="r"><a href="#r" class="headerlink" title="r"></a>r</h2><h3 id="transformer"><a href="#transformer" class="headerlink" title="transformer"></a>transformer</h3><p>n.变压器，变换器</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/01/14/frida-rpc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android.svg">
      <meta itemprop="name" content="Bileton">
      <meta itemprop="description" content="路漫漫其修远夕！">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="白乐天">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/01/14/frida-rpc/" class="post-title-link" itemprop="url">frida_rpc</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-01-14 22:10:47 / 修改时间：23:53:12" itemprop="dateCreated datePublished" datetime="2025-01-14T22:10:47+08:00">2025-01-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Frida/" itemprop="url" rel="index"><span itemprop="name">Frida</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="枚举所有进程及其进程ID"><a href="#枚举所有进程及其进程ID" class="headerlink" title="枚举所有进程及其进程ID"></a>枚举所有进程及其进程ID</h1><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"></span><br><span class="line">device = frida.get_usb_device()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Connected to device&quot;</span>)</span><br><span class="line"></span><br><span class="line">processes = device.enumerate_processes()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Listing all processes:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> process <span class="keyword">in</span> processes:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;process.name&#125;</span> (PID: <span class="subst">&#123;process.pid&#125;</span>)&quot;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="注入进程"><a href="#注入进程" class="headerlink" title="注入进程"></a>注入进程</h1><h2 id="附加进程注入"><a href="#附加进程注入" class="headerlink" title="附加进程注入"></a>附加进程注入</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"></span><br><span class="line">process = frida.get_usb_device().attach(ProcessName/PID)</span><br><span class="line"></span><br><span class="line">jsCode = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    console.log(&quot;frida hooked!&quot;)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">script = process.create_script(jsCode)</span><br><span class="line">script.load()</span><br></pre></td></tr></table></figure>

<h2 id="spawn方式注入"><a href="#spawn方式注入" class="headerlink" title="spawn方式注入"></a>spawn方式注入</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"></span><br><span class="line">device = frida.get_usb_device()</span><br><span class="line">pid = device.spawn([PackageName])</span><br><span class="line">process = device.attach(pid)</span><br><span class="line"></span><br><span class="line">jsCode = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    console.log(&quot;frida hooked!&quot;);</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">script = process.create_script(jsCode)</span><br><span class="line">script.load()</span><br><span class="line"></span><br><span class="line">device.resume(pid) 	<span class="comment"># 恢复进程</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Script loaded&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="非标准端口注入"><a href="#非标准端口注入" class="headerlink" title="非标准端口注入"></a>非标准端口注入</h2><p>需要进行端口转发</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb forword tcp:27042 tcp:27042</span><br></pre></td></tr></table></figure>

<h3 id="attach"><a href="#attach" class="headerlink" title="attach"></a>attach</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"></span><br><span class="line">device = frida.get_device_manager().add_remote_device(<span class="string">&quot;127.0.0.1:7788&quot;</span>)	<span class="comment"># 指定IP地址</span></span><br><span class="line">process = device.attach(ProcessName/PID)</span><br><span class="line"></span><br><span class="line">jsCode = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    console.log(&quot;frida hooked!&quot;);</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">script = process.create_script(jsCode)</span><br><span class="line">script.load()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Script loaded&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="spawn"><a href="#spawn" class="headerlink" title="spawn"></a>spawn</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"></span><br><span class="line">device = frida.get_device_manager().add_remote_device(<span class="string">&quot;127.0.0.1:7788&quot;</span>)	<span class="comment"># 指定IP地址</span></span><br><span class="line">pid = device.spawn(PackageName)</span><br><span class="line">process = device.attach(pid)</span><br><span class="line"></span><br><span class="line">jsCode = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    console.log(&quot;frida hooked!&quot;);</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">script = process.create_script(jsCode)</span><br><span class="line">script.load()</span><br><span class="line"></span><br><span class="line">device.resume(pid)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Script loaded&quot;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="send"><a href="#send" class="headerlink" title="send"></a>send</h1><p><code>send</code> 是用于在 Frida 脚本和主机 Python 程序之间通信的函数。</p>
<h2 id="JS端"><a href="#JS端" class="headerlink" title="JS端"></a>JS端</h2><p><code>send</code> 是 Frida 的全局函数，用于向Python程序发送字符串、对象或其他序列化数据。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">send</span>(<span class="string">&quot;Hello from Frida!&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="Python端"><a href="#Python端" class="headerlink" title="Python端"></a>Python端</h2><p>通过 <code>script.on(&quot;message&quot;, callback)</code> 监听 JavaScript 脚本发送的消息。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">on_message</span>(<span class="params">message, data</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Received message: <span class="subst">&#123;message&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">script.on(<span class="string">&quot;message&quot;</span>, on_message)  <span class="comment"># 注册消息回调</span></span><br></pre></td></tr></table></figure>

<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"></span><br><span class="line">device = frida.get_device_manager().add_remote_device(<span class="string">&quot;127.0.0.1:7788&quot;</span>)</span><br><span class="line">pid = device.spawn(PackageName)</span><br><span class="line">process = device.attach(pid)</span><br><span class="line"></span><br><span class="line">jsCode = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    console.log(&quot;frida hooked!&quot;);</span></span><br><span class="line"><span class="string">    send(&quot;Hello from Frida!&quot;);</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">script = process.create_script(jsCode)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_message</span>(<span class="params">message,data</span>):</span><br><span class="line">    <span class="keyword">if</span> message[<span class="string">&quot;type&quot;</span>] == <span class="string">&quot;send&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Received from JavaScript: <span class="subst">&#123;message&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">script.on(<span class="string">&quot;message&quot;</span>,on_message)</span><br><span class="line"></span><br><span class="line">script.load()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Script loaded&quot;</span>)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">frida hooked!</span><br><span class="line">Received <span class="keyword">from</span> JavaScript: &#123;<span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;send&#x27;</span>, <span class="string">&#x27;payload&#x27;</span>: <span class="string">&#x27;Hello from Frida!&#x27;</span>&#125;</span><br><span class="line">Script loaded</span><br></pre></td></tr></table></figure>



<h2 id="双向通信"><a href="#双向通信" class="headerlink" title="双向通信"></a>双向通信</h2><h3 id="JS端-1"><a href="#JS端-1" class="headerlink" title="JS端"></a>JS端</h3><p>通过&#96;&#96;send<code>发送，</code>recv&#96;来接收。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">send</span>(<span class="string">&quot;Requesting data from Python&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收来自 Python 的消息</span></span><br><span class="line"><span class="title function_">recv</span>(<span class="keyword">function</span> (<span class="params">message</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Received from Python:&quot;</span>, message.<span class="property">payload</span>);</span><br><span class="line">&#125;).<span class="title function_">wait</span>();</span><br></pre></td></tr></table></figure>

<h3 id="Python端-1"><a href="#Python端-1" class="headerlink" title="Python端"></a>Python端</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">on_message</span>(<span class="params">message, data</span>):</span><br><span class="line">    <span class="keyword">if</span> message[<span class="string">&quot;type&quot;</span>] == <span class="string">&quot;send&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Received from JavaScript: <span class="subst">&#123;message[<span class="string">&#x27;payload&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="comment"># 回复消息给 JavaScript</span></span><br><span class="line">        script.post(&#123;<span class="string">&quot;response&quot;</span>: <span class="string">&quot;Data received!&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">script.on(<span class="string">&quot;message&quot;</span>, on_message)</span><br></pre></td></tr></table></figure>

<h2 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"></span><br><span class="line">device = frida.get_device_manager().add_remote_device(<span class="string">&quot;127.0.0.1:7788&quot;</span>)</span><br><span class="line">pid = device.spawn(PackageName)</span><br><span class="line">process = device.attach(pid)</span><br><span class="line"></span><br><span class="line">jsCode = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    console.log(&quot;frida hooked!&quot;);</span></span><br><span class="line"><span class="string">    send(&quot;Hello from Frida!&quot;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    recv(function (message)&#123;</span></span><br><span class="line"><span class="string">        console.log(&quot;Received from Python:&quot;, message)</span></span><br><span class="line"><span class="string">    &#125;).wait();</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">script = process.create_script(jsCode)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_message</span>(<span class="params">message,data</span>):</span><br><span class="line">    <span class="keyword">if</span> message[<span class="string">&quot;type&quot;</span>] == <span class="string">&quot;send&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Received from JavaScript: <span class="subst">&#123;message&#125;</span>&quot;</span>)</span><br><span class="line">    script.post(<span class="string">&quot;message from Python&quot;</span>)</span><br><span class="line"></span><br><span class="line">script.on(<span class="string">&quot;message&quot;</span>,on_message)</span><br><span class="line">script.load()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Script loaded&quot;</span>)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">frida hooked!</span><br><span class="line">Received <span class="keyword">from</span> JavaScript: &#123;<span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;send&#x27;</span>, <span class="string">&#x27;payload&#x27;</span>: <span class="string">&#x27;Hello from Frida!&#x27;</span>&#125;</span><br><span class="line">Received <span class="keyword">from</span> Python: message <span class="keyword">from</span> Python</span><br><span class="line">Script loaded</span><br></pre></td></tr></table></figure>

<h1 id="rpc"><a href="#rpc" class="headerlink" title="rpc"></a>rpc</h1><h2 id="JS端定义rpc函数"><a href="#JS端定义rpc函数" class="headerlink" title="JS端定义rpc函数"></a>JS端定义rpc函数</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rpc.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">hello</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello from Frida!&quot;</span>;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">add</span>: <span class="keyword">function</span> (<span class="params">a, b</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><code>rpc.exports</code> 是一个对象，暴露的函数作为其属性。</p>
<h2 id="Python端调用rpc方法"><a href="#Python端调用rpc方法" class="headerlink" title="Python端调用rpc方法"></a>Python端调用rpc方法</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接到目标设备和应用</span></span><br><span class="line">device = frida.get_usb_device()</span><br><span class="line">pid = device.spawn([<span class="string">&quot;com.example.app&quot;</span>])</span><br><span class="line">session = device.attach(pid)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载 JavaScript 脚本</span></span><br><span class="line">js_code = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">rpc.exports = &#123;</span></span><br><span class="line"><span class="string">    hello: function () &#123;</span></span><br><span class="line"><span class="string">        return &quot;Hello from Frida!&quot;;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    add: function (a, b) &#123;</span></span><br><span class="line"><span class="string">        return a + b;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">script = session.create_script(js_code)</span><br><span class="line">script.load()</span><br><span class="line">device.resume(pid)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用 RPC 方法</span></span><br><span class="line"><span class="built_in">print</span>(script.exports.hello())  <span class="comment"># 输出: Hello from Frida!</span></span><br><span class="line"><span class="built_in">print</span>(script.exports.add(<span class="number">3</span>, <span class="number">5</span>))  <span class="comment"># 输出: 8</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android.svg">
      <meta itemprop="name" content="Bileton">
      <meta itemprop="description" content="路漫漫其修远夕！">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="白乐天">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/" class="post-title-link" itemprop="url">爱库存app参数sign还原</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-01-13 22:43:32" itemprop="dateCreated datePublished" datetime="2025-01-13T22:43:32+08:00">2025-01-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-01-14 18:28:42" itemprop="dateModified" datetime="2025-01-14T18:28:42+08:00">2025-01-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%80%86%E5%90%91%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/" itemprop="url" rel="index"><span itemprop="name">逆向实战案例</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>22k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>20 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="App信息"><a href="#App信息" class="headerlink" title="App信息"></a>App信息</h1><p>包名：com.aikucun.akapp</p>
<p><img src="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/1.jpg"></p>
<h1 id="关于frida反调试"><a href="#关于frida反调试" class="headerlink" title="关于frida反调试"></a>关于frida反调试</h1><p>这个app的反调试我是通过杀线程绕过的，具体过程不再详写，其他文章里有相同的绕过思路。</p>
<h1 id="抓包分析数据"><a href="#抓包分析数据" class="headerlink" title="抓包分析数据"></a>抓包分析数据</h1><p>寻找<code>sign</code>参数</p>
<p><img src="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/2.jpg"></p>
<h1 id="jadx反编译apk"><a href="#jadx反编译apk" class="headerlink" title="jadx反编译apk"></a>jadx反编译apk</h1><p>搜索<code>&quot;sign&quot;</code>，经过一番搜索，并没有找到相关的代码实现位置，换一种思路搜素<code>&quot;svs&quot;</code>，定位到了参数的位置。</p>
<p><img src="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/3.jpg"></p>
<p>双击查看</p>
<h2 id="onAttachQueryParameters"><a href="#onAttachQueryParameters" class="headerlink" title="onAttachQueryParameters"></a>onAttachQueryParameters</h2><p><img src="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/4.jpg"></p>
<p>这里我们可以双击<code>b.u</code>，查看其内容即<code>svs</code>的值，发现它是一个定值<code>v3</code></p>
<p><img src="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/5.jpg"></p>
<p>接着向下浏览找到了<code>&quot;&amp;sign=&quot;</code>，结合上下文发现就是我们要找的<code>sign</code></p>
<p><img src="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/6.jpg"></p>
<p>很清晰的看出来了<code>sign</code>的值为<code>signV3</code>，是经过<code>signV3</code>函数签名得到的结果。</p>
<h2 id="signV3"><a href="#signV3" class="headerlink" title="signV3"></a>signV3</h2><p>查看signV3的内容，它是一个native函数</p>
<p><img src="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/7.jpg"></p>
<h3 id="hook-signV3"><a href="#hook-signV3" class="headerlink" title="hook signV3"></a>hook signV3</h3><p>我们可以hook signV3函数查看其参数和返回值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_signV3</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="title class_">MXSecurity</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.mengxiang.arch.security.MXSecurity&quot;</span>);</span><br><span class="line">        <span class="title class_">MXSecurity</span>[<span class="string">&quot;signV3&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">url, nonceStr, timestamp, body</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`MXSecurity.signV3 is called: url=<span class="subst">$&#123;url&#125;</span>, nonceStr=<span class="subst">$&#123;nonceStr&#125;</span>, timestamp=<span class="subst">$&#123;timestamp&#125;</span>, body=<span class="subst">$&#123;body&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;signV3&quot;</span>](url, nonceStr, timestamp, body);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`MXSecurity.signV3 result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">hook_signV3</span>()</span><br></pre></td></tr></table></figure>

<p><strong>hook结果</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MXSecurity.signV3 is called: url=https://zuul.aikucun.com/akucun-base-data-new/base/address/selectAddrVersion?appid=38741001&amp;did=d545ae984083237bae9a6358ca29910f&amp;noncestr=3f60cc&amp;svs=v3&amp;timestamp=1736605877, nonceStr=3f60cc, timestamp=1736605877, body=</span><br><span class="line">MXSecurity.signV3 is called: url=https://m.xiangdian.com/api/mshop/mshop-aggr-prod/outer/common/bwl/isHitByBatch?appid=38741001&amp;did=d545ae984083237bae9a6358ca29910f&amp;noncestr=bf6c60&amp;svs=v3&amp;timestamp=1736605877, nonceStr=bf6c60, timestamp=1736605877, body=398a40be5a2a6a5a742f35b1b606277a</span><br><span class="line">MXSecurity.signV3 result=508858db8f332eb10fcf604c617229e5ef180f8698e10bd8626d3b9ec67416a4</span><br><span class="line">MXSecurity.signV3 result=a89e326bb0d2fcb6029e3991366ba812ee1deafd6bd0ba81f00850b794fd4a49</span><br><span class="line">MXSecurity.signV3 is called: url=https://m.xiangdian.com/api/mshop/mshop-aggr-prod/outer/v1/material/create/createAuth?appid=38741001&amp;did=d545ae984083237bae9a6358ca29910f&amp;noncestr=2cd903&amp;svs=v3&amp;timestamp=1736605877, nonceStr=2cd903, timestamp=1736605877, body=37a6259cc0c1dae299a7866489dff0bd</span><br><span class="line">MXSecurity.signV3 result=7df7962bdd9a2e5182cbacb123e0f95aba154da8f4499c9dab69b45e90003f17</span><br><span class="line">MXSecurity.signV3 is called: url=https://zuul.aikucun.com/appconfigmgt/api/v1/download/config?appid=38741001&amp;did=d545ae984083237bae9a6358ca29910f&amp;noncestr=63ba42&amp;svs=v3&amp;timestamp=1736605879, nonceStr=63ba42, timestamp=1736605879, body=ce10a5623f4ce537c8cbd4e306504860</span><br><span class="line">MXSecurity.signV3 result=70b90270cefb862185029b36663c9643201f13f790a9b20fd7a31082e30d0fbe</span><br></pre></td></tr></table></figure>

<h2 id="url"><a href="#url" class="headerlink" title="url"></a>url</h2><p>url是signV3的第一个参数，</p>
<p>分析url里的参数，url的第一个参数是<code>appid</code></p>
<p>如下，<code>appid</code>是在so里面获取的，等分析so的时候再去分析它</p>
<p><img src="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/26.jpg"></p>
<p>url的第二个参数是did</p>
<p>如下，调用getDid方法</p>
<h3 id="getDId"><a href="#getDId" class="headerlink" title="getDId"></a>getDId</h3><p><img src="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/27.jpg"></p>
<p>在getDid方法里调用了md5String方法，其参数是<code>&quot;micker.cn&quot;</code>拼接<code>getUdid()</code>的返回值，对参数进行md5加密，得到did</p>
<h3 id="getUdid"><a href="#getUdid" class="headerlink" title="getUdid"></a>getUdid</h3><p>获取udid的值</p>
<p><img src="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/28.jpg"></p>
<p>如果udid为空，会重新随机一个uuid，设置为udid</p>
<h2 id="nonceStr"><a href="#nonceStr" class="headerlink" title="nonceStr"></a>nonceStr</h2><p>nonceStr是signV3的第二个参数</p>
<p><strong>substring</strong></p>
<p>传入signV3方法的第二个参数是<code>substring</code>，查找这个参数是怎么生成的</p>
<p><img src="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/8.jpg"></p>
<p>可以看出来，这个参数是<code>replace$default</code>的子字符串，也就是其前六个字符。</p>
<p><strong>replace$default</strong></p>
<p>如下</p>
<p><img src="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/9.jpg"></p>
<p>StringsJVM调用的<code>replace$default</code>方法，里面传入了一个参数uuid，它是随机生成的  </p>
<p>看一下这个方法是怎么实现的，如下</p>
<p><img src="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/10.jpg"></p>
<p>又调用了replace方法，查看其实现</p>
<p><img src="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/11.jpg"></p>
<p>好长一串啊，这里我选择直接hook <code>replace</code>方法分析其参数和返回值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_replace</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="title class_">StringsJVM</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;kotlin.text.StringsKt__StringsJVMKt&quot;</span>);</span><br><span class="line">        <span class="title class_">StringsJVM</span>[<span class="string">&quot;replace&quot;</span>].<span class="title function_">overload</span>(<span class="string">&#x27;java.lang.String&#x27;</span>, <span class="string">&#x27;java.lang.String&#x27;</span>, <span class="string">&#x27;java.lang.String&#x27;</span>, <span class="string">&#x27;boolean&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">str, oldValue, newValue, z</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`StringsJVM.replace is called: str=<span class="subst">$&#123;str&#125;</span>, oldValue=<span class="subst">$&#123;oldValue&#125;</span>, newValue=<span class="subst">$&#123;newValue&#125;</span>, z=<span class="subst">$&#123;z&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;replace&quot;</span>](str, oldValue, newValue, z);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`StringsJVM.replace result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">hook_replace</span>()</span><br></pre></td></tr></table></figure>

<p><strong>hook 结果</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">StringsJVM.replace is called: str=14d557b1-496b-4daa-ba2f-d7cffe054397, oldValue=-, newValue=, z=false</span><br><span class="line">StringsJVM.replace result=14d557b1496b4daaba2fd7cffe054397</span><br></pre></td></tr></table></figure>

<p>它是把<code>uuid</code>中的<code>-</code>符号给去除了</p>
<p>到这里就知道nonceStr的值就是uuid的前六个字符</p>
<h2 id="timestamp"><a href="#timestamp" class="headerlink" title="timestamp"></a>timestamp</h2><p><code>signV3</code>的第三个参数是timestamp没什么好分析的，是一个时间戳。</p>
<h2 id="body"><a href="#body" class="headerlink" title="body"></a>body</h2><p>接下来分析<code>signV3</code>的第四个参数，<code>body</code></p>
<p>传入<code>signV3</code>的参数是<code>bodyMD5</code>，看名字就与<code>bodyMD5</code>有关系</p>
<p>看这个参数是怎么生成的</p>
<p><img src="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/12.jpg"></p>
<p>调用了bodyMD5()方法，里面传入了一个request参数</p>
<h3 id="bodyMD5"><a href="#bodyMD5" class="headerlink" title="bodyMD5"></a>bodyMD5</h3><p>查看这个方法的具体实现</p>
<p><img src="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/13.jpg"></p>
<p>把请求体进行了一个MD5运算</p>
<h3 id="hook-bodyMD5"><a href="#hook-bodyMD5" class="headerlink" title="hook bodyMD5"></a>hook bodyMD5</h3><p>这里可以把bodyMD5方法和md5标准加密算法同时hook，更清晰</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_md5</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="title class_">MD5Utils</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.mengxiang.arch.utils.MD5Utils&quot;</span>);</span><br><span class="line">        <span class="title class_">MD5Utils</span>[<span class="string">&quot;md5&quot;</span>].<span class="title function_">overload</span>(<span class="string">&#x27;java.lang.String&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">value</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`MD5Utils.md5 is called: value=<span class="subst">$&#123;value&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;md5&quot;</span>](value);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`MD5Utils.md5 result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hook_bodymd5</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="title class_">MXV1Sign</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.mengxiang.arch.net.sign.MXV1Sign&quot;</span>);</span><br><span class="line">        <span class="title class_">MXV1Sign</span>[<span class="string">&quot;bodyMD5&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">request</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`MXV1Sign.bodyMD5 is called: request=<span class="subst">$&#123;request&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;bodyMD5&quot;</span>](request);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`MXV1Sign.bodyMD5 result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">hook_bodymd5</span>()</span><br><span class="line"><span class="title function_">hook_md5</span>()</span><br></pre></td></tr></table></figure>

<p><strong>hook 结果</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">MXV1Sign.bodyMD5 is called: request=Request&#123;method=GET, url=https://zuul.aikucun.com/akucun-base-data-new/base/address/selectAddrVersion, tags=&#123;class retrofit2.Invocation=com.aikucun.akapp.business.address.service.AddressService.selectAddressVersion() []&#125;&#125;</span><br><span class="line">MXV1Sign.bodyMD5 result=</span><br><span class="line"></span><br><span class="line">MXV1Sign.bodyMD5 is called: request=Request&#123;method=POST, url=https://m.xiangdian.com/api/mshop/mshop-aggr-prod/outer/common/bwl/isHitByBatch, tags=&#123;class retrofit2.Invocation=com.aikucun.akapp.common.gray.GrayService$GrayServiceApi.grayControl() [&#123;bwlCodes=[B-MATERIAL-CREATE-V2, B-MATERIAL-CREATE-V3, B-MATERIAL-INCOME]&#125;]&#125;&#125;</span><br><span class="line"></span><br><span class="line">MD5Utils.md5 is called: value=&#123;&quot;bwlCodes&quot;:[&quot;B-MATERIAL-CREATE-V2&quot;,&quot;B-MATERIAL-CREATE-V3&quot;,&quot;B-MATERIAL-INCOME&quot;]&#125;</span><br><span class="line">MD5Utils.md5 result=398a40be5a2a6a5a742f35b1b606277a</span><br><span class="line">MXV1Sign.bodyMD5 result=398a40be5a2a6a5a742f35b1b606277a</span><br><span class="line"></span><br><span class="line">MXV1Sign.bodyMD5 is called: request=Request&#123;method=POST, url=https://m.xiangdian.com/api/mshop/mshop-aggr-prod/outer/v1/material/create/createAuth, headers=[app-cache-strategy:1], tags=&#123;class retrofit2.Invocation=com.mengxiang.arch.channel.impl.network.NetChannel$APIService.postRequest() [/api/mshop/mshop-aggr-prod/outer/v1/material/create/createAuth, &#123;app-cache-strategy=1&#125;, null]&#125;&#125;</span><br><span class="line">MD5Utils.md5 is called: value=null</span><br><span class="line">MD5Utils.md5 result=37a6259cc0c1dae299a7866489dff0bd</span><br><span class="line">MXV1Sign.bodyMD5 result=37a6259cc0c1dae299a7866489dff0bd</span><br><span class="line"></span><br><span class="line">MXV1Sign.bodyMD5 is called: request=Request&#123;method=POST, url=https://zuul.aikucun.com/appconfigmgt/api/v1/download/config, tags=&#123;class retrofit2.Invocation=com.aikucun.akapp.business.update.service.UpdateService.checkAppUpgrade() [&#123;configKey=[Ljava.lang.String;@61048d9, system=1, isShowUpdate=false, appId=com.aikucun.akapp, channel=2010, deviceModel=google-Pixel 3, buildCode=76302, version=7.63.2, userCode=, deviceBrand=Google&#125;]&#125;&#125;</span><br><span class="line">MD5Utils.md5 is called: value=&#123;&quot;configKey&quot;:[&quot;versionUpdate&quot;],&quot;system&quot;:1,&quot;isShowUpdate&quot;:false,&quot;appId&quot;:&quot;com.aikucun.akapp&quot;,&quot;channel&quot;:&quot;2010&quot;,&quot;deviceModel&quot;:&quot;google-Pixel 3&quot;,&quot;buildCode&quot;:76302,&quot;version&quot;:&quot;7.63.2&quot;,&quot;userCode&quot;:&quot;&quot;,&quot;deviceBrand&quot;:&quot;Google&quot;&#125;</span><br><span class="line">MD5Utils.md5 result=ce10a5623f4ce537c8cbd4e306504860</span><br><span class="line">MXV1Sign.bodyMD5 result=ce10a5623f4ce537c8cbd4e306504860</span><br><span class="line"></span><br><span class="line">MXV1Sign.bodyMD5 is called: request=Request&#123;method=POST, url=https://zuul.aikucun.com/appconfigmgt/api/v1/download/config, tags=&#123;class retrofit2.Invocation=com.aikucun.akapp.business.update.service.UpdateService.checkAppUpgrade() [&#123;configKey=[Ljava.lang.String;@f07dfd1, system=1, isShowUpdate=false, appId=com.aikucun.akapp, channel=2010, deviceModel=google-Pixel 3, buildCode=76302, version=7.63.2, userCode=, deviceBrand=Google&#125;]&#125;&#125;</span><br><span class="line">MD5Utils.md5 is called: value=&#123;&quot;configKey&quot;:[&quot;versionUpdate&quot;],&quot;system&quot;:1,&quot;isShowUpdate&quot;:false,&quot;appId&quot;:&quot;com.aikucun.akapp&quot;,&quot;channel&quot;:&quot;2010&quot;,&quot;deviceModel&quot;:&quot;google-Pixel 3&quot;,&quot;buildCode&quot;:76302,&quot;version&quot;:&quot;7.63.2&quot;,&quot;userCode&quot;:&quot;&quot;,&quot;deviceBrand&quot;:&quot;Google&quot;&#125;</span><br><span class="line">MD5Utils.md5 result=ce10a5623f4ce537c8cbd4e306504860</span><br><span class="line">MXV1Sign.bodyMD5 result=ce10a5623f4ce537c8cbd4e306504860</span><br><span class="line">MXV1Sign.bodyMD5 is called: request=Request&#123;method=POST, url=https://zuul.aikucun.com/appconfigmgt/api/v1/download/config, tags=&#123;class retrofit2.Invocation=com.aikucun.akapp.business.update.service.UpdateService.checkAppUpgrade() [&#123;configKey=[Ljava.lang.String;@cf2f91a, system=1, isShowUpdate=false, appId=com.aikucun.akapp, channel=2010, deviceModel=google-Pixel 3, buildCode=76302, version=7.63.2, userCode=, deviceBrand=Google&#125;]&#125;&#125;</span><br><span class="line">MD5Utils.md5 is called: value=&#123;&quot;configKey&quot;:[&quot;versionUpdate&quot;],&quot;system&quot;:1,&quot;isShowUpdate&quot;:false,&quot;appId&quot;:&quot;com.aikucun.akapp&quot;,&quot;channel&quot;:&quot;2010&quot;,&quot;deviceModel&quot;:&quot;google-Pixel 3&quot;,&quot;buildCode&quot;:76302,&quot;version&quot;:&quot;7.63.2&quot;,&quot;userCode&quot;:&quot;&quot;,&quot;deviceBrand&quot;:&quot;Google&quot;&#125;</span><br><span class="line">MD5Utils.md5 result=ce10a5623f4ce537c8cbd4e306504860</span><br><span class="line">MXV1Sign.bodyMD5 result=ce10a5623f4ce537c8cbd4e306504860</span><br></pre></td></tr></table></figure>



<p>好了，这里就把<code>signV3</code>方法的参数和返回值分析完成了，接下来就到so里面具体分析这个函数的实现过程了。</p>
<h1 id="so分析"><a href="#so分析" class="headerlink" title="so分析"></a>so分析</h1><p>signV3的实现在<code>mx</code>里</p>
<p><img src="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/14.jpg"></p>
<h2 id="定位signV3"><a href="#定位signV3" class="headerlink" title="定位signV3"></a>定位signV3</h2><p>IDA打开so文件，在导出函数表里搜索<code>Java</code>，直接就定位到了，双击跳转到函数地址</p>
<p><img src="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/15.jpg"></p>
<p>对反汇编的内容稍作处理，得到如下内容</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">Java_com_mengxiang_arch_security_MXSecurity_signV3</span><span class="params">(</span></span><br><span class="line"><span class="params">        JNIEnv *env,</span></span><br><span class="line"><span class="params">        jobject obj,</span></span><br><span class="line"><span class="params">        <span class="type">char</span> *url,</span></span><br><span class="line"><span class="params">        <span class="type">char</span> *noncestr,</span></span><br><span class="line"><span class="params">        <span class="type">char</span> *timestamp,</span></span><br><span class="line"><span class="params">        <span class="type">char</span> *body)</span></span><br><span class="line">&#123;</span><br><span class="line">  JNIEnv v6; <span class="comment">// x8</span></span><br><span class="line">  <span class="type">size_t</span> v11; <span class="comment">// x28</span></span><br><span class="line">  <span class="type">size_t</span> v12; <span class="comment">// x25</span></span><br><span class="line">  <span class="type">size_t</span> v13; <span class="comment">// x26</span></span><br><span class="line">  <span class="type">size_t</span> v14; <span class="comment">// x27</span></span><br><span class="line">  <span class="type">size_t</span> v15; <span class="comment">// x20</span></span><br><span class="line">  <span class="type">size_t</span> v16; <span class="comment">// x21</span></span><br><span class="line">  <span class="type">size_t</span> v17; <span class="comment">// x22</span></span><br><span class="line">  <span class="type">size_t</span> v18; <span class="comment">// x23</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v19; <span class="comment">// x20</span></span><br><span class="line">  _QWORD *v20; <span class="comment">// x24</span></span><br><span class="line">  __int64 v21; <span class="comment">// x8</span></span><br><span class="line">  <span class="type">char</span> *v22; <span class="comment">// x0</span></span><br><span class="line">  <span class="type">char</span> *v23; <span class="comment">// x0</span></span><br><span class="line">  <span class="type">char</span> *v24; <span class="comment">// x0</span></span><br><span class="line">  <span class="type">char</span> *v25; <span class="comment">// x0</span></span><br><span class="line">  <span class="type">char</span> *v26; <span class="comment">// x0</span></span><br><span class="line">  <span class="type">char</span> *v27; <span class="comment">// x0</span></span><br><span class="line">  <span class="type">char</span> *v28; <span class="comment">// x0</span></span><br><span class="line">  <span class="type">char</span> *v29; <span class="comment">// x0</span></span><br><span class="line">  __int64 v30; <span class="comment">// x8</span></span><br><span class="line">  <span class="type">char</span> *v31; <span class="comment">// x0</span></span><br><span class="line">  <span class="type">char</span> *v32; <span class="comment">// x0</span></span><br><span class="line">  <span class="type">char</span> *v33; <span class="comment">// x0</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v34; <span class="comment">// w20</span></span><br><span class="line">  jbyteArray sha256_data; <span class="comment">// x21</span></span><br><span class="line">  <span class="type">char</span> *v36; <span class="comment">// x1</span></span><br><span class="line">  jstring (*NewStringUTF)(JNIEnv *, <span class="type">const</span> <span class="type">char</span> *); <span class="comment">// x2</span></span><br><span class="line">  <span class="type">size_t</span> v39; <span class="comment">// [xsp+8h] [xbp-78h]</span></span><br><span class="line">  <span class="type">char</span> *timestamp_char; <span class="comment">// [xsp+10h] [xbp-70h]</span></span><br><span class="line">  <span class="type">char</span> *noncestr_char; <span class="comment">// [xsp+18h] [xbp-68h]</span></span><br><span class="line">  <span class="type">char</span> *url_char; <span class="comment">// [xsp+20h] [xbp-60h]</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *body_char; <span class="comment">// [xsp+28h] [xbp-58h]</span></span><br><span class="line"></span><br><span class="line">  v6 = *env;</span><br><span class="line">  <span class="keyword">if</span> ( (byte_32051 &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    noncestr_char = v6-&gt;GetStringUTFChars(env, noncestr, <span class="number">0LL</span>);</span><br><span class="line">    timestamp_char = (*env)-&gt;GetStringUTFChars(env, timestamp, <span class="number">0LL</span>);</span><br><span class="line">    url_char = (*env)-&gt;GetStringUTFChars(env, url, <span class="number">0LL</span>);</span><br><span class="line">    body_char = (*env)-&gt;GetStringUTFChars(env, body, <span class="number">0LL</span>);</span><br><span class="line">    v39 = __strlen_chk(<span class="string">&quot;appid=&quot;</span>, <span class="number">7uLL</span>);</span><br><span class="line">    v11 = __strlen_chk(<span class="string">&quot;&amp;svs=&quot;</span>, <span class="number">6uLL</span>);</span><br><span class="line">    v12 = __strlen_chk(<span class="string">&quot;v3&quot;</span>, <span class="number">3uLL</span>);</span><br><span class="line">    v13 = __strlen_chk(<span class="string">&quot;&amp;noncestr=&quot;</span>, <span class="number">0xB</span>uLL);</span><br><span class="line">    v14 = <span class="built_in">strlen</span>(noncestr_char);</span><br><span class="line">    v15 = __strlen_chk(<span class="string">&quot;&amp;timestamp=&quot;</span>, <span class="number">0xC</span>uLL);</span><br><span class="line">    v16 = <span class="built_in">strlen</span>(timestamp_char);</span><br><span class="line">    v17 = __strlen_chk(<span class="string">&quot;&amp;secret=&quot;</span>, <span class="number">9uLL</span>);</span><br><span class="line">    v18 = __strlen_chk(<span class="string">&quot;&amp;url=&quot;</span>, <span class="number">6uLL</span>);</span><br><span class="line">    v19 = v39 + v11 + v12 + v13 + v14 + v15 + v16 + v17 + v18 + <span class="built_in">strlen</span>(url_char) + <span class="number">74</span>;</span><br><span class="line">    v20 = operator new[](v19);</span><br><span class="line">    <span class="built_in">memset</span>(v20, <span class="number">0</span>, v19);</span><br><span class="line">    *v20 = <span class="number">0LL</span>;</span><br><span class="line">    <span class="built_in">strcat</span>(v20, <span class="string">&quot;appid=&quot;</span>);</span><br><span class="line">    v21 = <span class="number">32LL</span>;</span><br><span class="line">    <span class="keyword">if</span> ( isDebug )</span><br><span class="line">      v21 = <span class="number">16LL</span>;</span><br><span class="line">    v22 = <span class="built_in">strcat</span>(v20, *(lpAppInfo + v21));</span><br><span class="line">    v23 = <span class="built_in">strcat</span>(v22, <span class="string">&quot;&amp;svs=&quot;</span>);</span><br><span class="line">    v24 = <span class="built_in">strcat</span>(v23, <span class="string">&quot;v3&quot;</span>);</span><br><span class="line">    v25 = <span class="built_in">strcat</span>(v24, <span class="string">&quot;&amp;noncestr=&quot;</span>);</span><br><span class="line">    v26 = <span class="built_in">strcat</span>(v25, noncestr_char);</span><br><span class="line">    v27 = <span class="built_in">strcat</span>(v26, <span class="string">&quot;&amp;timestamp=&quot;</span>);</span><br><span class="line">    v28 = <span class="built_in">strcat</span>(v27, timestamp_char);</span><br><span class="line">    v29 = <span class="built_in">strcat</span>(v28, <span class="string">&quot;&amp;secret=&quot;</span>);</span><br><span class="line">    v30 = <span class="number">40LL</span>;</span><br><span class="line">    <span class="keyword">if</span> ( isDebug )</span><br><span class="line">      v30 = <span class="number">24LL</span>;</span><br><span class="line">    v31 = <span class="built_in">strcat</span>(v29, *(lpAppInfo + v30));</span><br><span class="line">    v32 = <span class="built_in">strcat</span>(v31, <span class="string">&quot;&amp;url=&quot;</span>);</span><br><span class="line">    <span class="built_in">strcat</span>(v32, url_char);</span><br><span class="line">    <span class="keyword">if</span> ( body_char &amp;&amp; <span class="built_in">strlen</span>(body_char) )</span><br><span class="line">    &#123;</span><br><span class="line">      v33 = <span class="built_in">strcat</span>(v20, <span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">      <span class="built_in">strcat</span>(v33, body_char);</span><br><span class="line">    &#125;</span><br><span class="line">    v34 = <span class="built_in">strlen</span>(v20);</span><br><span class="line">    sha256_data = (*env)-&gt;NewByteArray(env, v34);</span><br><span class="line">    (*env)-&gt;SetByteArrayRegion(env, sha256_data, <span class="number">0LL</span>, v34, v20);</span><br><span class="line">    v36 = digest(env, ALGORITHM_SHA256, sha256_data);</span><br><span class="line">    NewStringUTF = (*env)-&gt;NewStringUTF;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    NewStringUTF = v6-&gt;NewStringUTF;</span><br><span class="line">    v36 = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> NewStringUTF(env, v36);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用了digest方法，是SHA256签名算法，参数是<code>sha256_data</code>，分析这个参数是怎么生成的</p>
<p>它是由<code>appid</code>，<code>svs</code>、<code>noncestr</code>、<code>timestamp</code>、<code>secret</code>、<code>url</code>、<code>body</code>这些内容拼接而成的</p>
<p>目前还有两个未知参数<code>appid</code>和<code>secret</code></p>
<h3 id="appid"><a href="#appid" class="headerlink" title="appid"></a>appid</h3><p><img src="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/16.jpg"></p>
<p>这里看到appid的值是<code>lpAppInfo</code>加上一个偏移，偏移与<code>isDebug</code>有关</p>
<p><img src="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/18.jpg"></p>
<p>可以直接用frida直接打印内存中的数据</p>
<p><img src="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/17.jpg"></p>
<p><code>isDebug</code>的值为0，所以<code>v21</code>的值为32</p>
<p>接下来打印<code>lpAppInfo</code>的值</p>
<p><img src="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/19.jpg"></p>
<p><code>lpAppInfo</code>的值为<code>773f4e8b70</code>，<code>lpAppInfo</code>是个二级指针，加上偏移，打印它在内存中的数据</p>
<p><img src="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/20.jpg"></p>
<p>还是指向一个地址，继续打印</p>
<p><img src="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/21.jpg"></p>
<p>这里就得到appid的值为<code>38741001</code></p>
<h3 id="secret"><a href="#secret" class="headerlink" title="secret"></a>secret</h3><p><img src="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/22.jpg"></p>
<p>这里和<code>appid</code>参数一样，只需要修改偏移就可以打印<code>secret</code>的值</p>
<p><img src="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/23.jpg"></p>
<p>继续打印</p>
<p><img src="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/24.jpg"></p>
<p>这里得到<code>secret</code>的值为<code>04fdc5e4d9c7420e896ee92b17c68e9f</code></p>
<h3 id="hook-digest"><a href="#hook-digest" class="headerlink" title="hook digest"></a>hook digest</h3><p>参数分析完成了，接下来hook digest函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_dlopen</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//Android8.0之后加载so通过android_dlopen_ext函数</span></span><br><span class="line">    <span class="keyword">var</span> android_dlopen_ext = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="literal">null</span>,<span class="string">&quot;android_dlopen_ext&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;addr_android_dlopen_ext&quot;</span>,android_dlopen_ext);</span><br><span class="line">    <span class="keyword">var</span> islibmx = <span class="literal">false</span>;</span><br><span class="line">    <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(android_dlopen_ext,&#123;</span><br><span class="line">        <span class="attr">onEnter</span>:<span class="keyword">function</span>(<span class="params">args</span>)&#123;</span><br><span class="line">            <span class="keyword">var</span> pathptr = args[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">if</span>(pathptr!=<span class="literal">null</span> &amp;&amp; pathptr != <span class="literal">undefined</span>)&#123;</span><br><span class="line">                <span class="keyword">var</span> path = <span class="title function_">ptr</span>(pathptr).<span class="title function_">readCString</span>();</span><br><span class="line">                <span class="keyword">if</span>(path.<span class="title function_">indexOf</span>(<span class="string">&quot;libmx.so&quot;</span>)!=-<span class="number">1</span>)&#123;</span><br><span class="line">                    islibmx = <span class="literal">true</span>;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;android_dlopen_ext:&quot;</span>,path);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onLeave</span>:<span class="keyword">function</span>(<span class="params">retvel</span>)&#123;</span><br><span class="line">            <span class="comment">//console.log(&quot;leave!&quot;);</span></span><br><span class="line">            <span class="keyword">if</span>(islibmx)&#123;</span><br><span class="line">                islibmx=<span class="literal">false</span>;</span><br><span class="line">                <span class="title function_">hook_digest</span>()</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hook_digest</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> digest_addr = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&quot;libmx.so&quot;</span>,<span class="string">&quot;_Z6digestP7_JNIEnvPKcP11_jbyteArray&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;addr:&quot;</span>,digest_addr);</span><br><span class="line">    <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(digest_addr,&#123;</span><br><span class="line">        <span class="attr">onEnter</span>:<span class="keyword">function</span>(<span class="params">args</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hooked&quot;</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;args[1]:&quot;</span>,args[<span class="number">1</span>].<span class="title function_">readCString</span>());</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;args[2]:&quot;</span>,args[<span class="number">2</span>]);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onLeave</span>:<span class="keyword">function</span>(<span class="params">retval</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;retval:&quot;</span>,retval.<span class="title function_">readCString</span>())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="title function_">hook_dlopen</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">main</span>()</span><br></pre></td></tr></table></figure>

<p><strong>hook 结果</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">hooked</span><br><span class="line">args[1]: SHA256</span><br><span class="line">args[2]: 0x15</span><br><span class="line">retval: 580ef777f37fbb91dc13afa7cf6c2cd40db25286898f79af7ee4d707a2776a5b</span><br><span class="line">hooked</span><br><span class="line">args[1]: SHA256</span><br><span class="line">args[2]: 0x19</span><br><span class="line">retval: 06c3972159e698bec75632ecf9dd3e03ef47414f4cb22ec963effa10764a526e</span><br><span class="line">hooked</span><br><span class="line">args[1]: SHA256</span><br><span class="line">args[2]: 0x15</span><br><span class="line">retval: de46725478edde6cc051dcdab7d0cd762678999038fa010d7188e7340c530932</span><br><span class="line">hooked</span><br><span class="line">args[1]: SHA256</span><br><span class="line">args[2]: 0x15</span><br><span class="line">retval: b1eabf65340dd48a7e3d2855ffe38c4b21461f2a5688a7abbdfe970c30799ae2</span><br></pre></td></tr></table></figure>

<p>这里有些小疑惑，<code>args[2]</code>是加密的数据，应该是一个指针，指向一个字符串，而这里是一个数值</p>
<p>找到这个变量定义的地方，原来它的类型是<code>jbyteArray</code>类型，打印出来的值实际上是<code>jbyteArray</code>的句柄值。</p>
<p><img src="/2025/01/13/%E7%88%B1%E5%BA%93%E5%AD%98app%E5%8F%82%E6%95%B0sign%E8%BF%98%E5%8E%9F/25.jpg"></p>
<p>打印<code>jbyteArray</code>，我们可以调用如下方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">jbyteArray2Array</span>(<span class="params">jbyteArray</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> ret;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> b = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;[B&#x27;</span>);</span><br><span class="line">        <span class="keyword">var</span> buffer = <span class="title class_">Java</span>.<span class="title function_">cast</span>(jbyteArray, b);</span><br><span class="line">        ret = <span class="title class_">Java</span>.<span class="title function_">array</span>(<span class="string">&#x27;byte&#x27;</span>, buffer);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>加入到hook代码中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_dlopen</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//Android8.0之后加载so通过android_dlopen_ext函数</span></span><br><span class="line">    <span class="keyword">var</span> android_dlopen_ext = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="literal">null</span>,<span class="string">&quot;android_dlopen_ext&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;addr_android_dlopen_ext&quot;</span>,android_dlopen_ext);</span><br><span class="line">    <span class="keyword">var</span> islibmx = <span class="literal">false</span>;</span><br><span class="line">    <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(android_dlopen_ext,&#123;</span><br><span class="line">        <span class="attr">onEnter</span>:<span class="keyword">function</span>(<span class="params">args</span>)&#123;</span><br><span class="line">            <span class="keyword">var</span> pathptr = args[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">if</span>(pathptr!=<span class="literal">null</span> &amp;&amp; pathptr != <span class="literal">undefined</span>)&#123;</span><br><span class="line">                <span class="keyword">var</span> path = <span class="title function_">ptr</span>(pathptr).<span class="title function_">readCString</span>();</span><br><span class="line">                <span class="keyword">if</span>(path.<span class="title function_">indexOf</span>(<span class="string">&quot;libmx.so&quot;</span>)!=-<span class="number">1</span>)&#123;</span><br><span class="line">                    islibmx = <span class="literal">true</span>;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;android_dlopen_ext:&quot;</span>,path);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onLeave</span>:<span class="keyword">function</span>(<span class="params">retvel</span>)&#123;</span><br><span class="line">            <span class="comment">//console.log(&quot;leave!&quot;);</span></span><br><span class="line">            <span class="keyword">if</span>(islibmx)&#123;</span><br><span class="line">                islibmx=<span class="literal">false</span>;</span><br><span class="line">                <span class="title function_">hook_digest</span>()</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hook_digest</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> digest_addr = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&quot;libmx.so&quot;</span>,<span class="string">&quot;_Z6digestP7_JNIEnvPKcP11_jbyteArray&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;addr:&quot;</span>,digest_addr);</span><br><span class="line">    <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(digest_addr,&#123;</span><br><span class="line">        <span class="attr">onEnter</span>:<span class="keyword">function</span>(<span class="params">args</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hooked&quot;</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;args[1]:&quot;</span>,args[<span class="number">1</span>].<span class="title function_">readCString</span>());</span><br><span class="line">            <span class="keyword">let</span> arrayStr = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.String&quot;</span>).$new(<span class="title function_">jbyteArray2Array</span>(args[<span class="number">2</span>]))</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;args[2]&quot;</span>,arrayStr);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onLeave</span>:<span class="keyword">function</span>(<span class="params">retval</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;retval:&quot;</span>,retval.<span class="title function_">readCString</span>())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">jbyteArray2Array</span>(<span class="params">jbyteArray</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> ret;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> b = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;[B&#x27;</span>);</span><br><span class="line">        <span class="keyword">var</span> buffer = <span class="title class_">Java</span>.<span class="title function_">cast</span>(jbyteArray, b);</span><br><span class="line">        ret = <span class="title class_">Java</span>.<span class="title function_">array</span>(<span class="string">&#x27;byte&#x27;</span>, buffer);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="title function_">hook_dlopen</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">main</span>()</span><br></pre></td></tr></table></figure>

<p><strong>hook 结果如下</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">hooked</span><br><span class="line">args[1]: SHA256</span><br><span class="line">args[2] appid=38741001&amp;svs=v3&amp;noncestr=52d7e0&amp;timestamp=1736841686&amp;secret=04fdc5e4d9c7420e896ee92b17c68e9f&amp;url=https://m.xiangdian.com/api/mshop/mshop-aggr-prod/outer/v1/material/create/createAuth?appid=38741001&amp;did=cf05095e7e5c4492023833c88e4701bd&amp;noncestr=52d7e0&amp;svs=v3&amp;timestamp=1736841686&amp;37a6259cc0c1dae299a7866489dff0bd</span><br><span class="line">retval: c8a8920fdb192fbff509a3fcc02a574387bba8387b3699c3b523f6b9a5f1a9bb</span><br><span class="line">hooked</span><br><span class="line">args[1]: SHA256</span><br><span class="line">args[2] appid=38741001&amp;svs=v3&amp;noncestr=dc5f62&amp;timestamp=1736841687&amp;secret=04fdc5e4d9c7420e896ee92b17c68e9f&amp;url=https://zuul.aikucun.com/appconfigmgt/api/v1/download/config?appid=38741001&amp;did=cf05095e7e5c4492023833c88e4701bd&amp;noncestr=dc5f62&amp;svs=v3&amp;timestamp=1736841687&amp;ce10a5623f4ce537c8cbd4e306504860</span><br><span class="line">retval: 374c820993d895d427540bc5a0416a20c0813b0050f9f2d547b6557531b587e3</span><br><span class="line">hooked</span><br><span class="line">args[1]: SHA256</span><br><span class="line">args[2] appid=38741001&amp;svs=v3&amp;noncestr=0446f5&amp;timestamp=1736841688&amp;secret=04fdc5e4d9c7420e896ee92b17c68e9f&amp;url=https://zuul.aikucun.com/appconfigmgt/api/v1/download/config?appid=38741001&amp;did=cf05095e7e5c4492023833c88e4701bd&amp;noncestr=0446f5&amp;svs=v3&amp;timestamp=1736841688&amp;ce10a5623f4ce537c8cbd4e306504860</span><br><span class="line">retval: cf733458b1142b469afbee61529ca5e37730c551ada13e8839cc390660c773db</span><br><span class="line">hooked</span><br><span class="line">args[1]: SHA256</span><br><span class="line">args[2] appid=38741001&amp;svs=v3&amp;noncestr=e8e90a&amp;timestamp=1736841688&amp;secret=04fdc5e4d9c7420e896ee92b17c68e9f&amp;url=https://zuul.aikucun.com/appconfigmgt/api/v1/download/config?appid=38741001&amp;did=cf05095e7e5c4492023833c88e4701bd&amp;noncestr=e8e90a&amp;svs=v3&amp;timestamp=1736841688&amp;ce10a5623f4ce537c8cbd4e306504860</span><br><span class="line">retval: 8af4d51e17d8d8c1d9b3a0da22796ea52871bbeb27a630e74db97befce039814</span><br></pre></td></tr></table></figure>

<h1 id="参数还原"><a href="#参数还原" class="headerlink" title="参数还原"></a>参数还原</h1><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5_digest</span>(<span class="params">data</span>):</span><br><span class="line">    md5 = hashlib.md5()</span><br><span class="line">    md5.update(data.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">    result = md5.hexdigest()</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://zuul.aikucun.com/appconfigmgt/api/v1/download/config&quot;</span></span><br><span class="line"></span><br><span class="line">body = <span class="string">&#x27;&#123;&quot;configKey&quot;:[&quot;versionUpdate&quot;],&quot;system&quot;:1,&quot;isShowUpdate&quot;:false,&quot;appId&quot;:&quot;com.aikucun.akapp&quot;,&quot;channel&quot;:&quot;2010&quot;,&quot;deviceModel&quot;:&quot;google-Pixel 3&quot;,&quot;buildCode&quot;:76302,&quot;version&quot;:&quot;7.63.2&quot;,&quot;userCode&quot;:&quot;&quot;,&quot;deviceBrand&quot;:&quot;Google&quot;&#125;&#x27;</span></span><br><span class="line">bodymd5 = md5_digest(body)</span><br><span class="line"></span><br><span class="line">uuid = <span class="built_in">str</span>(uuid.uuid4())</span><br><span class="line">appid = <span class="string">&quot;38741001&quot;</span></span><br><span class="line">svs = <span class="string">&quot;v3&quot;</span></span><br><span class="line">noncestr = uuid[<span class="number">0</span>:<span class="number">6</span>]</span><br><span class="line">timestamp = <span class="built_in">str</span>(<span class="built_in">int</span>(time.time()))</span><br><span class="line">secret = <span class="string">&quot;04fdc5e4d9c7420e896ee92b17c68e9f&quot;</span></span><br><span class="line">did = md5_digest(<span class="string">&quot;micker.cn&quot;</span>+uuid)</span><br><span class="line">cat_url = url+<span class="string">&quot;?&quot;</span>+<span class="string">&quot;appid=&quot;</span>+appid+<span class="string">&quot;&amp;did=&quot;</span>+did+<span class="string">&quot;&amp;noncestr=&quot;</span>+noncestr+<span class="string">&quot;&amp;svs=v3&quot;</span>+<span class="string">&quot;&amp;timestamp=&quot;</span>+timestamp+<span class="string">&quot;&amp;&quot;</span>+bodymd5</span><br><span class="line">sha256_str = <span class="string">&quot;appid=&quot;</span>+appid+<span class="string">&quot;&amp;svs=&quot;</span>+svs+<span class="string">&quot;&amp;noncestr=&quot;</span>+noncestr+<span class="string">&quot;&amp;timestamp=&quot;</span>+timestamp+<span class="string">&quot;&amp;secret=&quot;</span>+secret+<span class="string">&quot;&amp;url=&quot;</span>+cat_url</span><br><span class="line">sha256 = hashlib.sha256()</span><br><span class="line">sha256.update(sha256_str.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">sign = sha256.hexdigest()</span><br><span class="line"><span class="built_in">print</span>(sha256_str)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">  <span class="string">&quot;Auth-Token&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Pixel3 android 9 7.63.2 2.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;token&quot;</span>: <span class="string">&quot;477c33c6-2f38-4363-a670-314393b47c1b&quot;</span>,</span><br><span class="line">  <span class="string">&quot;AKC-MODEL&quot;</span>: <span class="string">&quot;Pixel3&quot;</span>,</span><br><span class="line">  <span class="string">&quot;AKC-OS&quot;</span>: <span class="string">&quot;android&quot;</span>,</span><br><span class="line">  <span class="string">&quot;AKC-OS-VERSION&quot;</span>: <span class="string">&quot;9&quot;</span>,</span><br><span class="line">  <span class="string">&quot;AKC-APP-VERSION&quot;</span>: <span class="string">&quot;7.63.2&quot;</span>,</span><br><span class="line">  <span class="string">&quot;AKC-APP-API-VERSION&quot;</span>: <span class="string">&quot;2.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;AKC-APP-BUILD-VERSION&quot;</span>: <span class="string">&quot;76302&quot;</span>,</span><br><span class="line">  <span class="string">&quot;AKC-DID&quot;</span>: <span class="string">&quot;bedf28c355443e1f695fad8bed68fb62&quot;</span>,</span><br><span class="line">  <span class="string">&quot;AKC-APP-CHANNEL&quot;</span>: <span class="string">&quot;2010&quot;</span>,</span><br><span class="line">  <span class="string">&quot;applicationId&quot;</span>: <span class="string">&quot;com.aikucun.akapp&quot;</span>,</span><br><span class="line">  <span class="string">&quot;x-auth-token&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;live-channel&quot;</span>: <span class="string">&quot;20&quot;</span>,</span><br><span class="line">  <span class="string">&quot;dtdToken&quot;</span>: <span class="string">&quot;6784f1da9Lvio98PqHQ7NhCTS4TB4ruXU4mwxoe3&quot;</span>,</span><br><span class="line">  <span class="string">&quot;app2H5Token&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;uid&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;subUid&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;APP-LOGIN-CHANNEL&quot;</span>: <span class="string">&quot;akcApp&quot;</span>,</span><br><span class="line">  <span class="string">&quot;app-request-id&quot;</span>: <span class="string">&quot;120883481161481b9ab275208092d108&quot;</span>,</span><br><span class="line">  <span class="string">&quot;PAGE-NAME&quot;</span>: <span class="string">&quot;%E7%99%BB%E5%BD%95&quot;</span>,</span><br><span class="line">  <span class="string">&quot;TRACKER-SESSION-ID&quot;</span>: <span class="string">&quot;0be8b952d15b980a&quot;</span>,</span><br><span class="line">  <span class="string">&quot;APP-USER-TYPE&quot;</span>: <span class="string">&quot;6&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json; charset=UTF-8&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Content-Length&quot;</span>: <span class="string">&quot;213&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;zuul.aikucun.com&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;Keep-Alive&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">params = &#123;</span><br><span class="line">  <span class="string">&quot;appid&quot;</span>: appid,</span><br><span class="line">  <span class="string">&quot;did&quot;</span>: did,</span><br><span class="line">  <span class="string">&quot;noncestr&quot;</span>: noncestr,</span><br><span class="line">  <span class="string">&quot;svs&quot;</span>: svs,</span><br><span class="line">  <span class="string">&quot;timestamp&quot;</span>: timestamp,</span><br><span class="line">  <span class="string">&quot;sign&quot;</span>: sign</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">  <span class="string">&quot;configKey&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;versionUpdate&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;system&quot;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="string">&quot;isShowUpdate&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">  <span class="string">&quot;appId&quot;</span>: <span class="string">&quot;com.aikucun.akapp&quot;</span>,</span><br><span class="line">  <span class="string">&quot;channel&quot;</span>: <span class="string">&quot;2010&quot;</span>,</span><br><span class="line">  <span class="string">&quot;deviceModel&quot;</span>: <span class="string">&quot;google-Pixel 3&quot;</span>,</span><br><span class="line">  <span class="string">&quot;buildCode&quot;</span>: <span class="number">76302</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;7.63.2&quot;</span>,</span><br><span class="line">  <span class="string">&quot;userCode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;deviceBrand&quot;</span>: <span class="string">&quot;Google&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.post(url=url,headers=headers,params=params,json=data)</span><br><span class="line"><span class="built_in">print</span>(response.status_code)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">appid=<span class="number">38741001</span>&amp;svs=v3&amp;noncestr=ade8eb&amp;timestamp=<span class="number">1736844173</span>&amp;secret=04fdc5e4d9c7420e896ee92b17c68e9f&amp;url=https://zuul.aikucun.com/appconfigmgt/api/v1/download/config?appid=<span class="number">38741001</span>&amp;did=eb3be18635dec1ae73f3a0b86e81c982&amp;noncestr=ade8eb&amp;svs=v3&amp;timestamp=<span class="number">1736844173</span>&amp;ce10a5623f4ce537c8cbd4e306504860</span><br><span class="line"><span class="number">200</span></span><br><span class="line">&#123;<span class="string">&quot;code&quot;</span>:<span class="number">200</span>,<span class="string">&quot;data&quot;</span>:&#123;&#125;,<span class="string">&quot;message&quot;</span>:<span class="string">&quot;success&quot;</span>,<span class="string">&quot;status&quot;</span>:<span class="string">&quot;success&quot;</span>,<span class="string">&quot;success&quot;</span>:true&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/01/11/Android%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android.svg">
      <meta itemprop="name" content="Bileton">
      <meta itemprop="description" content="路漫漫其修远夕！">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="白乐天">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/01/11/Android%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">Android系统相关命令</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-01-11 18:40:52" itemprop="dateCreated datePublished" datetime="2025-01-11T18:40:52+08:00">2025-01-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-01-13 22:43:49" itemprop="dateModified" datetime="2025-01-13T22:43:49+08:00">2025-01-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">Android系统</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>191</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="getprop"><a href="#getprop" class="headerlink" title="getprop"></a>getprop</h1><p><code>getprop</code> 是 Android 系统中常用的命令，用于获取设备的属性值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getprop [属性名]</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>无参数</strong>: 直接运行 <code>getprop</code>，会列出系统中所有的属性及其值。</p>
</li>
<li><p><strong>指定属性名</strong>: 指定某个属性名时，会返回该属性的值。</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">getprop ro.debuggable	# 检查当前 Android 设备是否处于可调试模式。（0为不可调试）</span><br><span class="line">getprop ro.serialno		# 获取设备的序列号</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/default-index/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/default-index/page/6/">6</a><a class="extend next" rel="next" href="/default-index/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Bileton"
      src="/images/android.svg">
  <p class="site-author-name" itemprop="name">Bileton</p>
  <div class="site-description" itemprop="description">路漫漫其修远夕！</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">55</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">52</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Bileton</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">331k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">5:01</span>
</div>


<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("01/01/2024 00:00:00"); //修改为你的网站开始运行的时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒.";
    }
setInterval("createtime()",250);
</script>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
