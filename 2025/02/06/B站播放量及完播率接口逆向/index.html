<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/wxlog.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/wxlog.jpg">
  <link rel="mask-icon" href="/images/wxlog.jpg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="APP信息包名：tv.danmaku.bili  抓包分析数据包抓包工具开启之后，打开bilibili，随便点一个视频，分析数据包，找到相关数据包  分析请求体请求体是一堆二进制信息  反编译apkreportClick搜索&#x2F;x&#x2F;report&#x2F;click&#x2F;android2，找到一个接口，接口里定义了reportClick方法  查找用例，在如下方法中有对reportClick方法的调用 12345">
<meta property="og:type" content="article">
<meta property="og:title" content="B站播放量及完播率接口逆向">
<meta property="og:url" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/index.html">
<meta property="og:site_name" content="白乐天">
<meta property="og:description" content="APP信息包名：tv.danmaku.bili  抓包分析数据包抓包工具开启之后，打开bilibili，随便点一个视频，分析数据包，找到相关数据包  分析请求体请求体是一堆二进制信息  反编译apkreportClick搜索&#x2F;x&#x2F;report&#x2F;click&#x2F;android2，找到一个接口，接口里定义了reportClick方法  查找用例，在如下方法中有对reportClick方法的调用 12345">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/1.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/2.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/3.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/4.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/5.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/7.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/9.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/8.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/6.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/10.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/11.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/12.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/13.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/14.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/15.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/16.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/17.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/18.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/19.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/20.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/21.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/22.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/23.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/24.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/25.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/26.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/27.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/28.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/32.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/33.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/29.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/30.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/31.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/34.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/35.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/36.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/37.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/38.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/39.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/40.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/41.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/42.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/43.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/44.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/45.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/46.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/47.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/48.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/49.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/50.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/51.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/43.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/52.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/53.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/54.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/55.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/56.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/57.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/58.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/59.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/60.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/61.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/62.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/63.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/64.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/65.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/66.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/67.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/68.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/69.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/70.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/71.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/72.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/73.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/74.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/75.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/76.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/77.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/78.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/79.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/80.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/81.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/82.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/83.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/84.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/85.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/86.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/87.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/88.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/89.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/90.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/91.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/92.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/93.jpg">
<meta property="og:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/94.jpg">
<meta property="article:published_time" content="2025-02-06T12:54:49.000Z">
<meta property="article:modified_time" content="2025-02-26T11:17:56.381Z">
<meta property="article:author" content="Bileton">
<meta property="article:tag" content="B站">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/1.jpg">

<link rel="canonical" href="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>B站播放量及完播率接口逆向 | 白乐天</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">白乐天</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">道阻且长，行则将至。</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">90</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">35</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">98</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/love.js"></script>
</div>
    </header>

    
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android.svg">
      <meta itemprop="name" content="Bileton">
      <meta itemprop="description" content="路漫漫其修远夕！">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="白乐天">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          B站播放量及完播率接口逆向
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-02-06 20:54:49" itemprop="dateCreated datePublished" datetime="2025-02-06T20:54:49+08:00">2025-02-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-02-26 19:17:56" itemprop="dateModified" datetime="2025-02-26T19:17:56+08:00">2025-02-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%80%86%E5%90%91%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/" itemprop="url" rel="index"><span itemprop="name">逆向实战案例</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>127k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1:55</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="APP信息"><a href="#APP信息" class="headerlink" title="APP信息"></a>APP信息</h1><p>包名：tv.danmaku.bili</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/1.jpg" alt="1"></p>
<h1 id="抓包分析数据包"><a href="#抓包分析数据包" class="headerlink" title="抓包分析数据包"></a>抓包分析数据包</h1><p>抓包工具开启之后，打开bilibili，随便点一个视频，分析数据包，找到相关数据包</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/2.jpg" alt="1"></p>
<h2 id="分析请求体"><a href="#分析请求体" class="headerlink" title="分析请求体"></a>分析请求体</h2><p>请求体是一堆二进制信息</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/3.jpg" alt="1"></p>
<h2 id="反编译apk"><a href="#反编译apk" class="headerlink" title="反编译apk"></a>反编译apk</h2><h3 id="reportClick"><a href="#reportClick" class="headerlink" title="reportClick"></a>reportClick</h3><p>搜索<code>/x/report/click/android2</code>，找到一个接口，接口里定义了<code>reportClick</code>方法</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/4.jpg" alt="1"></p>
<p>查找用例，在如下方法中有对<code>reportClick</code>方法的调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">a</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">long</span> j2;</span><br><span class="line">    <span class="type">long</span> <span class="variable">i</span> <span class="operator">=</span> c2.f.f.c.j.a.i() / <span class="number">1000</span>;</span><br><span class="line">    c2.f.b0.c.b.b.a.<span class="type">a</span> <span class="variable">E</span> <span class="operator">=</span> c2.f.b0.c.b.b.a.a.E();</span><br><span class="line">    x.h(E, <span class="string">&quot;EnvironmentPrefHelper.getInstance()&quot;</span>);</span><br><span class="line">    <span class="type">long</span> <span class="variable">A</span> <span class="operator">=</span> E.A();</span><br><span class="line">    <span class="keyword">if</span> (A == -<span class="number">1</span>) &#123;</span><br><span class="line">        c2.f.b0.c.b.b.a.<span class="type">a</span> <span class="variable">E2</span> <span class="operator">=</span> c2.f.b0.c.b.b.a.a.E();</span><br><span class="line">        x.h(E2, <span class="string">&quot;EnvironmentPrefHelper.getInstance()&quot;</span>);</span><br><span class="line">        E2.V(i);</span><br><span class="line">        j2 = i;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        j2 = A;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">byte</span>[] H7 = d.<span class="built_in">this</span>.H7(<span class="built_in">this</span>.b.a(), <span class="built_in">this</span>.b.b(), <span class="built_in">this</span>.b.h(), i, j2, <span class="built_in">this</span>.b.n(), <span class="built_in">this</span>.b.m(), <span class="built_in">this</span>.b.k(), <span class="built_in">this</span>.b.c(), <span class="built_in">this</span>.b.e(), <span class="built_in">this</span>.b.l(), <span class="built_in">this</span>.b.f());</span><br><span class="line">    tv.danmaku.biliplayerimpl.report.heartbeat.<span class="type">a</span> <span class="variable">aVar</span> <span class="operator">=</span> (tv.danmaku.biliplayerimpl.report.heartbeat.a) com.bilibili.okretro.c.a(tv.danmaku.biliplayerimpl.report.heartbeat.a.class);</span><br><span class="line">    <span class="type">c0</span> <span class="variable">create</span> <span class="operator">=</span> c0.create(w.d(com.hpplay.sdk.source.protocol.h.E), H7);</span><br><span class="line">    x.h(create, <span class="string">&quot;RequestBody.create(Media…ion/octet-stream\&quot;), body)&quot;</span>);</span><br><span class="line">    l&lt;String&gt; execute = aVar.reportClick(create).execute();</span><br><span class="line">    BLog.i(<span class="string">&quot;HeartBeatTracker&quot;</span>, <span class="string">&quot;player report click(vv): responseCode:&quot;</span> + execute.b() + <span class="string">&quot;, responseMsg:&quot;</span> + execute.h() + <span class="string">&quot;, responseBody:&quot;</span> + execute.a());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>分析<code>reportClick</code>方法的参数<code>create</code>的生成过程，如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create参数通过c0.create(w.d(com.hpplay.sdk.source.protocol.h.E), H7)方法得到</span><br><span class="line">com.hpplay.sdk.source.protocol.h.E的值是&quot;application/octet-stream&quot;，还有一个H7参数</span><br><span class="line">H7参数通过d.this.H7()方法得到</span><br><span class="line">byte[] H7 = d.this.H7(this.b.a(), this.b.b(), this.b.h(), i, j2, this.b.n(), this.b.m(), this.b.k(), this.b.c(), this.b.e(), this.b.l(), this.b.f());</span><br></pre></td></tr></table></figure>

<h3 id="d-this-H7"><a href="#d-this-H7" class="headerlink" title="d.this.H7()"></a>d.this.H7()</h3><p>其源码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">byte</span>[] H7(<span class="type">long</span> j2, <span class="type">long</span> j4, <span class="type">int</span> i, <span class="type">long</span> j5, <span class="type">long</span> j6, <span class="type">int</span> i2, <span class="type">int</span> i3, <span class="type">long</span> j7, String str, <span class="type">int</span> i4, String str2, String str3) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">       <span class="type">long</span> j8;</span><br><span class="line">       <span class="type">int</span> i5;</span><br><span class="line">       <span class="type">Application</span> <span class="variable">f2</span> <span class="operator">=</span> BiliContext.f();</span><br><span class="line">       com.bilibili.lib.accounts.<span class="type">b</span> <span class="variable">client</span> <span class="operator">=</span> com.bilibili.lib.accounts.b.f(f2);</span><br><span class="line">       <span class="type">AccountInfo</span> <span class="variable">h</span> <span class="operator">=</span> BiliAccountInfo.f.a().h();</span><br><span class="line">       <span class="keyword">if</span> (h != <span class="literal">null</span>) &#123;</span><br><span class="line">           j8 = h.getMid();</span><br><span class="line">           i5 = h.getLevel();</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           j8 = <span class="number">0</span>;</span><br><span class="line">           i5 = <span class="number">0</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="type">TreeMap</span> <span class="variable">treeMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeMap</span>();</span><br><span class="line">       treeMap.put(<span class="string">&quot;aid&quot;</span>, String.valueOf(j2));</span><br><span class="line">       treeMap.put(<span class="string">&quot;cid&quot;</span>, String.valueOf(j4));</span><br><span class="line">       treeMap.put(<span class="string">&quot;part&quot;</span>, String.valueOf(i));</span><br><span class="line">       treeMap.put(EditCustomizeSticker.TAG_MID, String.valueOf(j8));</span><br><span class="line">       treeMap.put(<span class="string">&quot;lv&quot;</span>, String.valueOf(i5));</span><br><span class="line">       treeMap.put(<span class="string">&quot;ftime&quot;</span>, String.valueOf(j6));</span><br><span class="line">       treeMap.put(<span class="string">&quot;stime&quot;</span>, String.valueOf(j5));</span><br><span class="line">       treeMap.put(<span class="string">&quot;did&quot;</span>, com.bilibili.lib.biliid.utils.f.a.c(f2));</span><br><span class="line">       treeMap.put(<span class="string">&quot;type&quot;</span>, String.valueOf(i2));</span><br><span class="line">       treeMap.put(<span class="string">&quot;sub_type&quot;</span>, String.valueOf(i3));</span><br><span class="line">       treeMap.put(<span class="string">&quot;sid&quot;</span>, String.valueOf(j7));</span><br><span class="line">       treeMap.put(<span class="string">&quot;epid&quot;</span>, str);</span><br><span class="line">       treeMap.put(<span class="string">&quot;auto_play&quot;</span>, String.valueOf(i4));</span><br><span class="line">       x.h(client, <span class="string">&quot;client&quot;</span>);</span><br><span class="line">       <span class="keyword">if</span> (client.r()) &#123;</span><br><span class="line">           treeMap.put(<span class="string">&quot;access_key&quot;</span>, client.g());</span><br><span class="line">       &#125;</span><br><span class="line">       treeMap.put(<span class="string">&quot;build&quot;</span>, String.valueOf(com.bilibili.api.a.f()));</span><br><span class="line">       treeMap.put(<span class="string">&quot;mobi_app&quot;</span>, com.bilibili.api.a.l());</span><br><span class="line">       treeMap.put(<span class="string">&quot;spmid&quot;</span>, str2);</span><br><span class="line">       treeMap.put(<span class="string">&quot;from_spmid&quot;</span>, str3);</span><br><span class="line">       <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">       <span class="keyword">for</span> (Map.Entry entry : treeMap.entrySet()) &#123;</span><br><span class="line">           <span class="type">String</span> <span class="variable">str4</span> <span class="operator">=</span> (String) entry.getKey();</span><br><span class="line">           <span class="type">String</span> <span class="variable">str5</span> <span class="operator">=</span> (String) entry.getValue();</span><br><span class="line">           sb.append(str4);</span><br><span class="line">           sb.append(<span class="string">&#x27;=&#x27;</span>);</span><br><span class="line">           <span class="keyword">if</span> (str5 == <span class="literal">null</span>) &#123;</span><br><span class="line">               str5 = <span class="string">&quot;&quot;</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           sb.append(str5);</span><br><span class="line">           sb.append(<span class="string">&#x27;&amp;&#x27;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       sb.deleteCharAt(sb.length() - <span class="number">1</span>);</span><br><span class="line">       <span class="type">String</span> <span class="variable">sb2</span> <span class="operator">=</span> sb.toString();</span><br><span class="line">       x.h(sb2, <span class="string">&quot;builder.toString()&quot;</span>);</span><br><span class="line">       <span class="type">String</span> <span class="variable">b2</span> <span class="operator">=</span> t3.a.i.a.a.a.b.e.b(sb2);</span><br><span class="line">       BLog.i(<span class="string">&quot;HeartBeatTracker&quot;</span>, <span class="string">&quot;player report click(vv), params: &quot;</span> + sb2 + <span class="string">&quot; &amp; sign=&quot;</span> + b2);</span><br><span class="line">       sb.append(<span class="string">&quot;&amp;sign=&quot;</span>);</span><br><span class="line">       sb.append(b2);</span><br><span class="line">       <span class="type">String</span> <span class="variable">sb3</span> <span class="operator">=</span> sb.toString();</span><br><span class="line">       x.h(sb3, <span class="string">&quot;builder.toString()&quot;</span>);</span><br><span class="line">       <span class="keyword">return</span> t3.a.i.a.a.a.b.e.a(sb3);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>分析</p>
<p>H7方法里的参数都放进了treeMap里，然后通过<code>&amp;</code>拼接成字符串，调用了<code>t3.a.i.a.a.a.b.e.b()</code>方法进行签名，签名结果通过<code>&amp;</code>符号拼接到字符串末尾，最后再调用一个<code>t3.a.i.a.a.a.b.e.a()</code>方法</p>
<h4 id="hook-H7"><a href="#hook-H7" class="headerlink" title="hook H7"></a>hook H7</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">ByteString</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.android.okhttp.okio.ByteString&quot;</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">toHex</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">ByteString</span>.<span class="title function_">of</span>(data).<span class="title function_">hex</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hook_h7</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> d = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;tv.danmaku.biliplayerimpl.report.heartbeat.d&quot;</span>);</span><br><span class="line">        d[<span class="string">&quot;H7&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">j2, j4, i, j5, j6, i2, i3, j7, str, i4, str2, str3</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`d.H7 is called: j2=<span class="subst">$&#123;j2&#125;</span>, j4=<span class="subst">$&#123;j4&#125;</span>, i=<span class="subst">$&#123;i&#125;</span>, j5=<span class="subst">$&#123;j5&#125;</span>, j6=<span class="subst">$&#123;j6&#125;</span>, i2=<span class="subst">$&#123;i2&#125;</span>, i3=<span class="subst">$&#123;i3&#125;</span>, j7=<span class="subst">$&#123;j7&#125;</span>, str=<span class="subst">$&#123;str&#125;</span>, i4=<span class="subst">$&#123;i4&#125;</span>, str2=<span class="subst">$&#123;str2&#125;</span>, str3=<span class="subst">$&#123;str3&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;H7&quot;</span>](j2, j4, i, j5, j6, i2, i3, j7, str, i4, str2, str3);</span><br><span class="line">            <span class="comment">// console.log(`d.H7 result=$&#123;Java.use(&quot;java.lang.String&quot;).$new(result)&#125;`);</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;to hex result:&quot;</span>,<span class="title function_">toHex</span>(result));</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>hook 结果</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d.H7 is called: j2=113886342676927, j4=28065268176, i=1, j5=1737979363, j6=1737960450, i2=3, i3=0, j7=0, str=, i4=0, str2=main.ugc-video-detail.0.0, str3=tm.recommend.0.0</span><br><span class="line">to hex result: b2eadf0bc65f99660f2ffbe874d802918231b6f0445bbf1c005253f1b42c251a61835063707effd59fc5800b4377d4241b252ec063dd6ca55f66a738ce7d5de3d5ef17d04714e17e0d3b592e18109e4e4d8d534666159c204dd8c31ec68c92355f57ce3798454155d57b360d9855dc4d8b131dcb9befebe638635b103d40b0f66d33c283c6dd28b49d38e724f7f7abcb7ba16a7a150941bd301275e326c56e89e97210c18b36437fa4d6fde0f7911cbb7b2e80e56051a9f9f7e238ca20da5dbd6481362a85afceb73e55816d6ff8d7f740a5d8c8e3a0c6779ba406f400cb34936c6e1d3534bf0ed2eee6ce743fcf0ce8fd8ac478980f3dc6f1aac8de96e2be031e1e5f7a32bf06ec73840f4632728a576c9d2f4fa6fc76141e961920885e1d57b3a5e4f77a88d285f6eea2398d97a949e9577bba57665c84a5f85a102e07921e</span><br></pre></td></tr></table></figure>

<h4 id="主动调用H7"><a href="#主动调用H7" class="headerlink" title="主动调用H7"></a>主动调用H7</h4><p>找到<code>tv.danmaku.biliplayerimpl.report.heartbeat.d</code>类的一个实例，然后主动调用H7方法，固定输出结果</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">ByteString</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.android.okhttp.okio.ByteString&quot;</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">toHex</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">ByteString</span>.<span class="title function_">of</span>(data).<span class="title function_">hex</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hook_h7</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> d = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;tv.danmaku.biliplayerimpl.report.heartbeat.d&quot;</span>);</span><br><span class="line">        d[<span class="string">&quot;H7&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">j2, j4, i, j5, j6, i2, i3, j7, str, i4, str2, str3</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`d.H7 is called: j2=<span class="subst">$&#123;j2&#125;</span>, j4=<span class="subst">$&#123;j4&#125;</span>, i=<span class="subst">$&#123;i&#125;</span>, j5=<span class="subst">$&#123;j5&#125;</span>, j6=<span class="subst">$&#123;j6&#125;</span>, i2=<span class="subst">$&#123;i2&#125;</span>, i3=<span class="subst">$&#123;i3&#125;</span>, j7=<span class="subst">$&#123;j7&#125;</span>, str=<span class="subst">$&#123;str&#125;</span>, i4=<span class="subst">$&#123;i4&#125;</span>, str2=<span class="subst">$&#123;str2&#125;</span>, str3=<span class="subst">$&#123;str3&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;H7&quot;</span>](j2, j4, i, j5, j6, i2, i3, j7, str, i4, str2, str3);</span><br><span class="line">            <span class="comment">// console.log(`d.H7 result=$&#123;Java.use(&quot;java.lang.String&quot;).$new(result)&#125;`);</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;to hex result:&quot;</span>,<span class="title function_">toHex</span>(result));</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">call_h7</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&quot;tv.danmaku.biliplayerimpl.report.heartbeat.d&quot;</span>,&#123;</span><br><span class="line">            <span class="attr">onMatch</span>:<span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">                <span class="comment">// console.log(obj.toString());</span></span><br><span class="line">                <span class="keyword">if</span>(obj.<span class="title function_">toString</span>()==<span class="string">&quot;tv.danmaku.biliplayerimpl.report.heartbeat.d@8ca9273&quot;</span>)&#123;</span><br><span class="line">                    obj.<span class="title function_">H7</span>(<span class="number">113886342676927</span>,<span class="number">28065268176</span>,<span class="number">1</span>,<span class="number">1737979363</span>,<span class="number">1737960450</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="string">&quot;&quot;</span>,<span class="number">0</span>,<span class="string">&quot;main.ugc-video-detail.0.0&quot;</span>,<span class="string">&quot;tm.recommend.0.0&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onComplete</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="t3-a-i-a-a-a-b-e-b"><a href="#t3-a-i-a-a-a-b-e-b" class="headerlink" title="t3.a.i.a.a.a.b.e.b"></a>t3.a.i.a.a.a.b.e.b</h3><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/5.jpg" alt="1"></p>
<h4 id="hook-b"><a href="#hook-b" class="headerlink" title="hook b"></a>hook b</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">call_h7</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&quot;tv.danmaku.biliplayerimpl.report.heartbeat.d&quot;</span>,&#123;</span><br><span class="line">            <span class="attr">onMatch</span>:<span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">                <span class="comment">// console.log(obj.toString());</span></span><br><span class="line">                <span class="keyword">if</span>(obj.<span class="title function_">toString</span>()==<span class="string">&quot;tv.danmaku.biliplayerimpl.report.heartbeat.d@8ca9273&quot;</span>)&#123;</span><br><span class="line">                    obj.<span class="title function_">H7</span>(<span class="number">113886342676927</span>,<span class="number">28065268176</span>,<span class="number">1</span>,<span class="number">1737979363</span>,<span class="number">1737960450</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="string">&quot;&quot;</span>,<span class="number">0</span>,<span class="string">&quot;main.ugc-video-detail.0.0&quot;</span>,<span class="string">&quot;tm.recommend.0.0&quot;</span>);</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;H7 is called!&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onComplete</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hook_b</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> b = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;t3.a.i.a.a.a.b&quot;</span>);</span><br><span class="line">        b[<span class="string">&quot;b&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">params</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`b.b is called: params=<span class="subst">$&#123;params&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;b&quot;</span>](params);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`b.b result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>hook 结果</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">b.<span class="property">b</span> is <span class="attr">called</span>: params=aid=<span class="number">113886342676927</span>&amp;auto_play=<span class="number">0</span>&amp;build=<span class="number">6240300</span>&amp;cid=<span class="number">28065268176</span>&amp;did=<span class="title class_">PF9</span>tVWMHYgNiUTQGegZ6&amp;epid=&amp;from_spmid=tm.<span class="property">recommend</span><span class="number">.0</span><span class="number">.0</span>&amp;ftime=<span class="number">1737960450</span>&amp;lv=<span class="number">0</span>&amp;mid=<span class="number">0</span>&amp;mobi_app=android&amp;part=<span class="number">1</span>&amp;sid=<span class="number">0</span>&amp;spmid=main.<span class="property">ugc</span>-video-detail<span class="number">.0</span><span class="number">.0</span>&amp;stime=<span class="number">1737979363</span>&amp;sub_type=<span class="number">0</span>&amp;type=<span class="number">3</span></span><br><span class="line">b.<span class="property">b</span> result=2e012b190fa7060fba2941e72bd14646d0bb2d5445838e2812f95dd1807b6208</span><br><span class="line"><span class="variable constant_">H7</span> is called!</span><br></pre></td></tr></table></figure>

<p>查看<code>t3.a.i.a.a.a.b.e.b</code>的源码发现，结果来源于<code>com.bilibili.commons.m.a.g</code>函数</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/7.jpg" alt="1"></p>
<p>它的两个参数一个是<code>params</code>，另一个是<code>d</code>，可以通过hook得到它的值</p>
<p>其实在这个页面往上翻一下，可以找到对<code>d</code>的赋值</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/9.jpg" alt="1"></p>
<p><code>d</code>是一个定值<code>&quot;9cafa6466a028bfb&quot;</code></p>
<h3 id="com-bilibili-commons-m-a-g"><a href="#com-bilibili-commons-m-a-g" class="headerlink" title="com.bilibili.commons.m.a.g"></a>com.bilibili.commons.m.a.g</h3><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/8.jpg" alt="1"></p>
<p>这里还使用了一个SHA256哈希算法</p>
<h4 id="hook-g"><a href="#hook-g" class="headerlink" title="hook g"></a>hook g</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">call_h7</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&quot;tv.danmaku.biliplayerimpl.report.heartbeat.d&quot;</span>,&#123;</span><br><span class="line">            <span class="attr">onMatch</span>:<span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">                <span class="comment">// console.log(obj.toString());</span></span><br><span class="line">                <span class="keyword">if</span>(obj.<span class="title function_">toString</span>()==<span class="string">&quot;tv.danmaku.biliplayerimpl.report.heartbeat.d@a68ff35&quot;</span>)&#123;</span><br><span class="line">                    obj.<span class="title function_">H7</span>(<span class="number">113886342676927</span>,<span class="number">28065268176</span>,<span class="number">1</span>,<span class="number">1737979363</span>,<span class="number">1737960450</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="string">&quot;&quot;</span>,<span class="number">0</span>,<span class="string">&quot;main.ugc-video-detail.0.0&quot;</span>,<span class="string">&quot;tm.recommend.0.0&quot;</span>);</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;H7 is called!&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onComplete</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hook_g</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> a = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.bilibili.commons.m.a&quot;</span>);</span><br><span class="line">        a[<span class="string">&quot;g&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">bArr, bArr2</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> string_class = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.String&quot;</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`a.g is called: bArr=<span class="subst">$&#123;bArr&#125;</span>, bArr2=<span class="subst">$&#123;bArr2&#125;</span>`</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`a.g is called: bArr=<span class="subst">$&#123;string_class.$new(bArr)&#125;</span>, bArr2=<span class="subst">$&#123;string_class.$new(bArr2)&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;g&quot;</span>](bArr, bArr2);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`a.g result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>hook 结果</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a.g is called: bArr=97,105,100,61,49,49,51,56,56,54,51,52,50,54,55,54,57,50,55,38,97,117,116,111,95,112,108,97,121,61,48,38,98,117,105,108,100,61,54,50,52,48,51,48,48,38,99,105,100,61,50,56,48,54,53,50,54,56,49,55,54,38,100,105,100,61,80,70,57,116,86,87,77,72,89,103,78,105,85,84,81,71,101,103,90,54,38,101,112,105,100,61,38,102,114,111,109,95,115,112,109,105,100,61,116,109,46,114,101,99,111,109,109,101,110,100,46,48,46,48,38,102,116,105,109,101,61,49,55,51,55,57,54,48,52,53,48,38,108,118,61,48,38,109,105,100,61,48,38,109,111,98,105,95,97,112,112,61,97,110,100,114,111,105,100,38,112,97,114,116,61,49,38,115,105,100,61,48,38,115,112,109,105,100,61,109,97,105,110,46,117,103,99,45,118,105,100,101,111,45,100,101,116,97,105,108,46,48,46,48,38,115,116,105,109,101,61,49,55,51,55,57,55,57,51,54,51,38,115,117,98,95,116,121,112,101,61,48,38,116,121,112,101,61,51, bArr2=57,99,97,102,97,54,52,54,54,97,48,50,56,98,102,98</span><br><span class="line">a.g is called: bArr=aid=113886342676927&amp;auto_play=0&amp;build=6240300&amp;cid=28065268176&amp;did=PF9tVWMHYgNiUTQGegZ6&amp;epid=&amp;from_spmid=tm.recommend.0.0&amp;ftime=1737960450&amp;lv=0&amp;mid=0&amp;mobi_app=android&amp;part=1&amp;sid=0&amp;spmid=main.ugc-video-detail.0.0&amp;stime=1737979363&amp;sub_type=0&amp;type=3, bArr2=9cafa6466a028bfb</span><br><span class="line">a.g result=2e012b190fa7060fba2941e72bd14646d0bb2d5445838e2812f95dd1807b6208</span><br><span class="line">H7 is called!</span><br></pre></td></tr></table></figure>

<p>签名之后传递给<code>t3.a.i.a.a.a.b.e.a()</code>方法</p>
<h3 id="t3-a-i-a-a-a-b-e-a"><a href="#t3-a-i-a-a-a-b-e-a" class="headerlink" title="t3.a.i.a.a.a.b.e.a"></a>t3.a.i.a.a.a.b.e.a</h3><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/6.jpg" alt="1"></p>
<p>这里使用了aes加密</p>
<h4 id="hook-a"><a href="#hook-a" class="headerlink" title="hook a"></a>hook a</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">ByteString</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.android.okhttp.okio.ByteString&quot;</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">toHex</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">ByteString</span>.<span class="title function_">of</span>(data).<span class="title function_">hex</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">call_h7</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&quot;tv.danmaku.biliplayerimpl.report.heartbeat.d&quot;</span>,&#123;</span><br><span class="line">            <span class="attr">onMatch</span>:<span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">                <span class="comment">// console.log(obj.toString());</span></span><br><span class="line">                <span class="keyword">if</span>(obj.<span class="title function_">toString</span>()==<span class="string">&quot;tv.danmaku.biliplayerimpl.report.heartbeat.d@a68ff35&quot;</span>)&#123;</span><br><span class="line">                    obj.<span class="title function_">H7</span>(<span class="number">113886342676927</span>,<span class="number">28065268176</span>,<span class="number">1</span>,<span class="number">1737979363</span>,<span class="number">1737960450</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="string">&quot;&quot;</span>,<span class="number">0</span>,<span class="string">&quot;main.ugc-video-detail.0.0&quot;</span>,<span class="string">&quot;tm.recommend.0.0&quot;</span>);</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;H7 is called!&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onComplete</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hook_a</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> b = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;t3.a.i.a.a.a.b&quot;</span>);</span><br><span class="line">        b[<span class="string">&quot;a&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">body</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`b.a is called: body=<span class="subst">$&#123;body&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;a&quot;</span>](body);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`b.a result=<span class="subst">$&#123;toHex(result)&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>hook 结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">b.a is called: body=aid=113886342676927&amp;auto_play=0&amp;build=6240300&amp;cid=28065268176&amp;did=PF9tVWMHYgNiUTQGegZ6&amp;epid=&amp;from_spmid=tm.recommend.0.0&amp;ftime=1737960450&amp;lv=0&amp;mid=0&amp;mobi_app=android&amp;part=1&amp;sid=0&amp;spmid=main.ugc-video-detail.0.0&amp;stime=1737979363&amp;sub_type=0&amp;type=3&amp;sign=2e012b190fa7060fba2941e72bd14646d0bb2d5445838e2812f95dd1807b6208</span><br><span class="line">b.a result=b2eadf0bc65f99660f2ffbe874d802918231b6f0445bbf1c005253f1b42c251a61835063707effd59fc5800b4377d4241b252ec063dd6ca55f66a738ce7d5de3d5ef17d04714e17e0d3b592e18109e4e4d8d534666159c204dd8c31ec68c92355f57ce3798454155d57b360d9855dc4d8b131dcb9befebe638635b103d40b0f66d33c283c6dd28b49d38e724f7f7abcb7ba16a7a150941bd301275e326c56e89e97210c18b36437fa4d6fde0f7911cbb7b2e80e56051a9f9f7e238ca20da5dbd6481362a85afceb73e55816d6ff8d7f740a5d8c8e3a0c6779ba406f400cb34936c6e1d3534bf0ed2eee6ce743fcf0ce8fd8ac478980f3dc6f1aac8de96e2be031e1e5f7a32bf06ec73840f4632728a576c9d2f4fa6fc76141e961920885e1d57b3a5e4f77a88d285f6eea2398d97a949e9577bba57665c84a5f85a102e07921e</span><br><span class="line">H7 is called!</span><br></pre></td></tr></table></figure>

<p>查看源码，可在源码中，找到AES加密的Key和IV向量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Key: &quot;fd6b639dbcff0c2a1b03b389ec763c4b&quot;</span><br><span class="line">IV : &quot;77b07a672d57d64c&quot;</span><br></pre></td></tr></table></figure>

<h3 id="解密请求体"><a href="#解密请求体" class="headerlink" title="解密请求体"></a>解密请求体</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> unpad</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_decrypt</span>(<span class="params">ciphertext_hex, key, iv</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    使用AES解密数据（hex编码的密文）</span></span><br><span class="line"><span class="string">    :param ciphertext_hex: hex编码的密文（str）</span></span><br><span class="line"><span class="string">    :param key: 密钥（bytes, 长度为16, 24或32字节）</span></span><br><span class="line"><span class="string">    :param iv: 初始化向量IV（bytes, 长度为16字节）</span></span><br><span class="line"><span class="string">    :return: 解密后的明文（str）</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 将hex编码的密文转换为bytes</span></span><br><span class="line">    ciphertext = <span class="built_in">bytes</span>.fromhex(ciphertext_hex)</span><br><span class="line">    <span class="comment"># 创建AES解密对象</span></span><br><span class="line">    cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    <span class="comment"># 解密并移除填充</span></span><br><span class="line">    plaintext = unpad(cipher.decrypt(ciphertext), AES.block_size)</span><br><span class="line">    <span class="keyword">return</span> plaintext.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例数据</span></span><br><span class="line">key = <span class="string">b&#x27;fd6b639dbcff0c2a1b03b389ec763c4b&#x27;</span>  <span class="comment"># 16字节密钥</span></span><br><span class="line">iv = <span class="string">b&#x27;77b07a672d57d64c&#x27;</span>   <span class="comment"># 16字节IV</span></span><br><span class="line">ciphertext_hex = <span class="string">&#x27;b2eadf0bc65f99660f2ffbe874d802918231b6f0445bbf1c005253f1b42c251a61835063707effd59fc5800b4377d4241b252ec063dd6ca55f66a738ce7d5de3d5ef17d04714e17e0d3b592e18109e4e4d8d534666159c204dd8c31ec68c92355f57ce3798454155d57b360d9855dc4d8b131dcb9befebe638635b103d40b0f66d33c283c6dd28b49d38e724f7f7abcb7ba16a7a150941bd301275e326c56e89e97210c18b36437fa4d6fde0f7911cbb7b2e80e56051a9f9f7e238ca20da5dbd6481362a85afceb73e55816d6ff8d7f740a5d8c8e3a0c6779ba406f400cb34936c6e1d3534bf0ed2eee6ce743fcf0ce8fd8ac478980f3dc6f1aac8de96e2be031e1e5f7a32bf06ec73840f4632728a576c9d2f4fa6fc76141e961920885e1d57b3a5e4f77a88d285f6eea2398d97a949e9577bba57665c84a5f85a102e07921e&#x27;</span>  <span class="comment"># hex编码的密文</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    plaintext = aes_decrypt(ciphertext_hex, key, iv)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;解密后的明文:&quot;</span>, plaintext)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;解密失败:&quot;</span>, e)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">解密后的明文: aid=<span class="number">113886342676927</span>&amp;auto_play=<span class="number">0</span>&amp;build=<span class="number">6240300</span>&amp;cid=<span class="number">28065268176</span>&amp;did=PF9tVWMHYgNiUTQGegZ6&amp;epid=&amp;from_spmid=tm.recommend<span class="number">.0</span><span class="number">.0</span>&amp;ftime=<span class="number">1737960450</span>&amp;lv=<span class="number">0</span>&amp;mid=<span class="number">0</span>&amp;mobi_app=android&amp;part=<span class="number">1</span>&amp;sid=<span class="number">0</span>&amp;spmid=main.ugc-video-detail<span class="number">.0</span><span class="number">.0</span>&amp;stime=<span class="number">1737979363</span>&amp;sub_type=<span class="number">0</span>&amp;<span class="built_in">type</span>=<span class="number">3</span>&amp;sign=2e012b190fa7060fba2941e72bd14646d0bb2d5445838e2812f95dd1807b6208</span><br></pre></td></tr></table></figure>

<h1 id="Python实现请求体加密"><a href="#Python实现请求体加密" class="headerlink" title="Python实现请求体加密"></a>Python实现请求体加密</h1><h2 id="请求体参数还原"><a href="#请求体参数还原" class="headerlink" title="请求体参数还原"></a>请求体参数还原</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;aid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;113886342676927&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;auto_play&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="number">6240300</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;cid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;28065268176&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;did&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PF9tVWMHYgNiUTQGegZ6&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;epid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;from_spmid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tm.recommend.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;ftime&quot;</span><span class="punctuation">:</span> <span class="number">1737960450</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;lv&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;mid&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;mobi_app&quot;</span><span class="punctuation">:</span> <span class="string">&quot;android&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;part&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sid&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;spmid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;main.ugc-video-detail.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;stime&quot;</span><span class="punctuation">:</span> <span class="number">1737979363</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sub_type&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sign&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2e012b190fa7060fba2941e72bd14646d0bb2d5445838e2812f95dd1807b6208&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>这里面需要逆向的参数有<code>aid</code>、<code>build</code>、<code>cid</code>、<code>did</code>和<code>sign</code></p>
<h3 id="sign还原"><a href="#sign还原" class="headerlink" title="sign还原"></a>sign还原</h3><p><code>sign</code>值我们已经分析过了，所以先把它还原一下</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SHA256_call</span>(<span class="params">data,salt</span>):</span><br><span class="line">    <span class="comment"># 创建sha256对象</span></span><br><span class="line">    sha256 = hashlib.sha256()</span><br><span class="line">    sha256.update(data.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> salt!=<span class="string">&quot;&quot;</span>:</span><br><span class="line">        sha256.update(salt.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">    <span class="comment"># 获取加密后的数据，以16进制表示</span></span><br><span class="line">    sha256_hex = sha256.hexdigest()</span><br><span class="line">    <span class="keyword">return</span> sha256_hex</span><br><span class="line"></span><br><span class="line">param = <span class="string">&quot;aid=113886342676927&amp;auto_play=0&amp;build=6240300&amp;cid=28065268176&amp;did=PF9tVWMHYgNiUTQGegZ6&amp;epid=&amp;from_spmid=tm.recommend.0.0&amp;ftime=1737960450&amp;lv=0&amp;mid=0&amp;mobi_app=android&amp;part=1&amp;sid=0&amp;spmid=main.ugc-video-detail.0.0&amp;stime=1737979363&amp;sub_type=0&amp;type=3&quot;</span></span><br><span class="line">salt = <span class="string">&quot;9cafa6466a028bfb&quot;</span></span><br><span class="line"><span class="built_in">print</span>(SHA256_call(param,salt))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">2e012b190fa7060fba2941e72bd14646d0bb2d5445838e2812f95dd1807b6208</span><br></pre></td></tr></table></figure>

<h3 id="aid还原"><a href="#aid还原" class="headerlink" title="aid还原"></a>aid还原</h3><p>分析源码，发现<code>aid</code>参数可以从<code>Video</code>类的内部类<code>h</code>类中的<code>a()</code>方法获取，hook一下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_aid</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> h = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;tv.danmaku.biliplayerv2.service.Video$h&quot;</span>);</span><br><span class="line">        h[<span class="string">&quot;a&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`h.a is called`</span>);</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;a&quot;</span>]();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`h.a result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>hook结果，点击不同的视频它的结果是不一样的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">h.a is called</span><br><span class="line">h.a result=113886342676927</span><br></pre></td></tr></table></figure>

<p>猜测aid可能与视频有关</p>
<h3 id="build还原"><a href="#build还原" class="headerlink" title="build还原"></a>build还原</h3><p>在源码里面翻了翻，发现它是个定值<code>6240300</code></p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/10.jpg" alt="1"></p>
<h3 id="cid还原"><a href="#cid还原" class="headerlink" title="cid还原"></a>cid还原</h3><p>浏览源码，发现<code>cid</code>参数可以从<code>Video</code>类的内部类<code>h</code>类中的<code>b()</code>方法获取，hook一下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_cid</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> h = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;tv.danmaku.biliplayerv2.service.Video$h&quot;</span>);</span><br><span class="line">        h[<span class="string">&quot;b&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`h.b is called`</span>);</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;b&quot;</span>]();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`h.b result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>hook结果，与<code>aid</code>参数类似的是，不同的视频，<code>cid</code>参数的值也是不一样的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">h.b is called</span><br><span class="line">h.b result=28065268176</span><br></pre></td></tr></table></figure>

<h3 id="did还原"><a href="#did还原" class="headerlink" title="did还原"></a>did还原</h3><p><code>did</code>参数是通过<code>com.bilibili.lib.biliid.utils.f.a.c()</code>方法得到的</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/11.jpg" alt="1"></p>
<p>hook 一下c方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_did</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> a = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.bilibili.lib.biliid.utils.f.a&quot;</span>);</span><br><span class="line">        a[<span class="string">&quot;c&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">context</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`a.c is called: context=<span class="subst">$&#123;context&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;c&quot;</span>](context);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`a.c result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>hook 结果，点击不同的视频，结果都是一样的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a.c is called: context=BiliApplication(tv.danmaku.bili)@bd968dc</span><br><span class="line">a.c result=PF9tVWMHYgNiUTQGegZ6</span><br></pre></td></tr></table></figure>

<p>分析其如何生成的，去看c方法的源码</p>
<h4 id="c"><a href="#c" class="headerlink" title="c"></a>c</h4><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/12.jpg" alt="1"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">首先判断f13193c字段是否为空，非空直接返回</span><br><span class="line">如果是空的话，会调用c2.f.b0.c.a.e.k().f(context)方法来获取f字段</span><br><span class="line">如果f字段还是空的话，会调用g(context)方法生成f13193c,</span><br></pre></td></tr></table></figure>

<p>看g方法源码</p>
<h4 id="g"><a href="#g" class="headerlink" title="g"></a>g</h4><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/13.jpg" alt="1"></p>
<p>通过f方法返回一个f字段，然后对字段f进行处理然后返回</p>
<p>看f方法源码</p>
<h4 id="f"><a href="#f" class="headerlink" title="f"></a>f</h4><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/14.jpg" alt="1"></p>
<p>先看<code>j2</code>字段，它通过<code>j(context)</code>获取到</p>
<h4 id="j"><a href="#j" class="headerlink" title="j"></a>j</h4><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/15.jpg" alt="1"></p>
<p>在这里面调用了一个c方法</p>
<h4 id="c-1"><a href="#c-1" class="headerlink" title="c"></a>c</h4><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/16.jpg" alt="1"></p>
<p>它是获取mac地址的，这个东西我们也可以自己生成</p>
<p>接着去看<code>f</code>函数，有一个<code>a2</code>参数，它获取的是<code>persist.service.bdroid.bdaddr</code>，也就是蓝牙地址</p>
<p>在<code>f</code>函数里找到<code>h</code>参数，<code>h</code>来源于<code>h()</code>方法</p>
<h4 id="h"><a href="#h" class="headerlink" title="h"></a>h</h4><p>h里面调用了一个<code>a()</code>方法</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/17.jpg" alt="1"></p>
<p>它是<code>/sys/bus/mmc/devices</code>文件的内容，与设备总线信息有关</p>
<p>f函数里还有一个参数<code>i</code>，通过<code>i()</code>方法获得</p>
<h4 id="i"><a href="#i" class="headerlink" title="i"></a>i</h4><p>i里面调用了<code>a()</code>方法</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/18.jpg" alt="1"></p>
<p>这里面提到了<code>/sys/class/android_usb/android0/iSerial</code>这个文件，它是Android 设备 USB 序列号的用户空间控制接口，与设备USB序列号有关。</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>经过分析，在<code>g()</code>方法里生成的<code>f</code>字段与4个内容有关，分别是mac地址，蓝牙地址，设备总线和sn号，把他们通过<code>|</code>拼接起来，拼接起来的字符串传入<code>b()</code>方法。</p>
<h4 id="b"><a href="#b" class="headerlink" title="b"></a>b</h4><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/19.jpg" alt="1"></p>
<p>在这里面对字符串进行处理然后通过Base64编码后返回</p>
<h4 id="参数还原"><a href="#参数还原" class="headerlink" title="参数还原"></a>参数还原</h4><p>接下来我们自己生成四个内容拼接起来然后通过python实现一个b方法再调用base64进行编码就可以得到did参数。</p>
<h4 id="hook-f"><a href="#hook-f" class="headerlink" title="hook f"></a>hook f</h4><p>hook一下f方法</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">process = frida.get_usb_device().attach(<span class="string">&quot;哔哩哔哩&quot;</span>)</span><br><span class="line"></span><br><span class="line">jsCode = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Java.perform(function()&#123;</span></span><br><span class="line"><span class="string">    let a = Java.use(&quot;com.bilibili.lib.biliid.utils.f.a&quot;);</span></span><br><span class="line"><span class="string">        a[&quot;f&quot;].implementation = function (context) &#123;</span></span><br><span class="line"><span class="string">            console.log(`a.f is called: context=$&#123;context&#125;`);</span></span><br><span class="line"><span class="string">            let result = this[&quot;f&quot;](context);</span></span><br><span class="line"><span class="string">            console.log(`a.f result=$&#123;result&#125;`);</span></span><br><span class="line"><span class="string">            return result;</span></span><br><span class="line"><span class="string">        &#125;;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">scrpt = process.create_script(jsCode)</span><br><span class="line"></span><br><span class="line">scrpt.load()</span><br><span class="line">sys.stdin.read()</span><br></pre></td></tr></table></figure>

<p>hook 结果，如下只获取到了mac地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a.f is called: context=BiliApplication(tv.danmaku.bili)@fa97dd3</span><br><span class="line">a.f result=3c286deaa3e2|||</span><br></pre></td></tr></table></figure>

<p>对于Mac地址参数，源码里还对它进行了处理，如下，把非<code>0-9A-Fa-f</code>的内容替换为空，并都转换为小写。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">lowerCase</span> <span class="operator">=</span> j2.replaceAll(<span class="string">&quot;[^0-9A-Fa-f]&quot;</span>, <span class="string">&quot;&quot;</span>).toLowerCase();</span><br></pre></td></tr></table></figure>

<p>源码里对第二个参数蓝牙地址也是这样处理，把非<code>0-9A-Fa-f</code>的内容替换为空，并都转换为小写。</p>
<p>从源码里还可以看出的是，只要<code>f()</code>方法返回值的长度大于等于4，那么它就有效，所以这四个参数只要获取到了其中一个，就可以拿过来使用。</p>
<h4 id="Python生成mac地址"><a href="#Python生成mac地址" class="headerlink" title="Python生成mac地址"></a>Python生成mac地址</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_mac</span>():</span><br><span class="line">    mac = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">7</span>):</span><br><span class="line">        part = random.sample(<span class="string">&quot;0123456789abcdef&quot;</span>,<span class="number">2</span>)</span><br><span class="line">        mac += <span class="string">&quot;&quot;</span>.join(part)</span><br><span class="line">    <span class="keyword">return</span> mac</span><br><span class="line"><span class="built_in">print</span>(g_mac())</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">e5d76827d57f</span><br></pre></td></tr></table></figure>

<h4 id="Python实现b方法"><a href="#Python实现b方法" class="headerlink" title="Python实现b方法"></a>Python实现b方法</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_mac</span>():</span><br><span class="line">    mac = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">7</span>):</span><br><span class="line">        part = random.sample(<span class="string">&quot;0123456789abcdef&quot;</span>,<span class="number">2</span>)</span><br><span class="line">        mac += <span class="string">&quot;&quot;</span>.join(part)</span><br><span class="line">    <span class="keyword">return</span> mac</span><br><span class="line"><span class="comment"># print(g_mac())</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">b</span>(<span class="params"><span class="built_in">str</span></span>):</span><br><span class="line">    <span class="built_in">str</span>+=<span class="string">&quot;|||&quot;</span></span><br><span class="line">    byte_list = <span class="built_in">list</span>(<span class="built_in">str</span>.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">    byte_list[<span class="number">0</span>] = byte_list[<span class="number">0</span>] ^ (<span class="built_in">len</span>(byte_list) &amp; <span class="number">255</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(byte_list)):</span><br><span class="line">        byte_list[i] = (byte_list[i-<span class="number">1</span>]^byte_list[i]) &amp; <span class="number">255</span></span><br><span class="line">    <span class="keyword">return</span> base64.b64encode(<span class="built_in">bytes</span>(byte_list))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(b(g_mac()))</span><br><span class="line"><span class="comment"># print(b(&quot;e5d76827d57f|||&quot;))  # al87DDoCMAdjVmEHewd7</span></span><br></pre></td></tr></table></figure>

<p>至此，did参数还原完成</p>
<h3 id="Python实现请求体加密-1"><a href="#Python实现请求体加密-1" class="headerlink" title="Python实现请求体加密"></a>Python实现请求体加密</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_mac</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    生成一个随机MAC地址（不是真实的MAC地址格式）</span></span><br><span class="line"><span class="string">    每个部分由2个十六进制字符组成，共6部分</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    mac = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">7</span>):</span><br><span class="line">        part = random.sample(<span class="string">&quot;0123456789abcdef&quot;</span>, <span class="number">2</span>)  <span class="comment"># 随机选择2个十六进制字符</span></span><br><span class="line">        mac += <span class="string">&quot;&quot;</span>.join(part)  <span class="comment"># 拼接成字符串</span></span><br><span class="line">    <span class="keyword">return</span> mac</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_did</span>(<span class="params">string</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    生成设备ID（did），对字符串进行特殊的XOR变换，并进行Base64编码</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    string += <span class="string">&quot;|||&quot;</span>  <span class="comment"># 添加分隔符</span></span><br><span class="line">    byte_list = <span class="built_in">list</span>(string.encode(<span class="string">&quot;utf-8&quot;</span>))  <span class="comment"># 转换为字节列表</span></span><br><span class="line">    byte_list[<span class="number">0</span>] = byte_list[<span class="number">0</span>] ^ (<span class="built_in">len</span>(byte_list) &amp; <span class="number">255</span>)  <span class="comment"># 首字节与长度取低8位的值异或</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(byte_list)):</span><br><span class="line">        byte_list[i] = (byte_list[i - <span class="number">1</span>] ^ byte_list[i]) &amp; <span class="number">255</span>  <span class="comment"># 每个字节与前一个字节异或，并取低8位</span></span><br><span class="line">    <span class="keyword">return</span> base64.b64encode(<span class="built_in">bytes</span>(byte_list)).decode(<span class="string">&quot;utf-8&quot;</span>)  <span class="comment"># Base64编码后返回字符串</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成设备ID</span></span><br><span class="line">did = g_did(g_mac())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请求体参数</span></span><br><span class="line">body = &#123;</span><br><span class="line">    <span class="string">&quot;aid&quot;</span>: <span class="string">&quot;113886342676927&quot;</span>,</span><br><span class="line">    <span class="string">&quot;auto_play&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;6240300&quot;</span>,</span><br><span class="line">    <span class="string">&quot;cid&quot;</span>: <span class="string">&quot;28065268176&quot;</span>,</span><br><span class="line">    <span class="string">&quot;did&quot;</span>: did,</span><br><span class="line">    <span class="string">&quot;epid&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;from_spmid&quot;</span>: <span class="string">&quot;tm.recommend.0.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ftime&quot;</span>: <span class="built_in">str</span>(<span class="built_in">int</span>(time.time())),</span><br><span class="line">    <span class="string">&quot;lv&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;mid&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;mobi_app&quot;</span>: <span class="string">&quot;android&quot;</span>,</span><br><span class="line">    <span class="string">&quot;part&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sid&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;spmid&quot;</span>: <span class="string">&quot;main.ugc-video-detail.0.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;stime&quot;</span>: <span class="built_in">str</span>(<span class="built_in">int</span>(time.time())),</span><br><span class="line">    <span class="string">&quot;sub_type&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_sign</span>(<span class="params">data_sign, salt</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    计算数据签名，使用SHA-256哈希</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    sha256 = hashlib.sha256()</span><br><span class="line">    sha256.update(data_sign.encode(<span class="string">&quot;utf-8&quot;</span>))  <span class="comment"># 更新数据</span></span><br><span class="line">    <span class="keyword">if</span> salt != <span class="string">&quot;&quot;</span>:</span><br><span class="line">        sha256.update(salt.encode(<span class="string">&quot;utf-8&quot;</span>))  <span class="comment"># 如果有盐值，追加到哈希计算中</span></span><br><span class="line">    <span class="keyword">return</span> sha256.hexdigest()  <span class="comment"># 返回SHA-256的十六进制字符串</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">salt = <span class="string">&quot;9cafa6466a028bfb&quot;</span>  <span class="comment"># 预定义的盐值</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_data_sign</span>(<span class="params">data_sign</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    将请求体参数转换为字符串，以&amp;连接键值对</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&amp;&quot;</span>.join([key + <span class="string">&quot;=&quot;</span> + value <span class="keyword">for</span> key, value <span class="keyword">in</span> data_sign.items()])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算签名</span></span><br><span class="line">data_sign = g_data_sign(body)</span><br><span class="line"><span class="built_in">print</span>(data_sign)  <span class="comment"># 打印待签名的字符串</span></span><br><span class="line">sign = g_sign(data_sign, salt)</span><br><span class="line"><span class="built_in">print</span>(sign)  <span class="comment"># 打印计算出的签名</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加签名到请求体</span></span><br><span class="line">body[<span class="string">&quot;sign&quot;</span>] = sign</span><br><span class="line"><span class="built_in">print</span>(body)  <span class="comment"># 打印最终的请求体</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将请求体转换为URL编码格式的字符串</span></span><br><span class="line">body_str = (<span class="string">&quot;&amp;&quot;</span>.join([key + <span class="string">&quot;=&quot;</span> + value <span class="keyword">for</span> key, value <span class="keyword">in</span> body.items()])).encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># AES加密密钥和IV（初始化向量）</span></span><br><span class="line">key = <span class="string">b&#x27;fd6b639dbcff0c2a1b03b389ec763c4b&#x27;</span>  <span class="comment"># 32字节密钥（AES-256）</span></span><br><span class="line">iv = <span class="string">b&#x27;77b07a672d57d64c&#x27;</span>  <span class="comment"># 16字节IV</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_encrypt</span>(<span class="params">body_str, key, iv</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    使用AES CBC模式加密请求体</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    cipher = AES.new(key, AES.MODE_CBC, iv)  <span class="comment"># 创建AES加密器</span></span><br><span class="line">    padded_data = pad(body_str, AES.block_size)  <span class="comment"># 对数据进行PKCS7填充</span></span><br><span class="line">    ciphertext = cipher.encrypt(padded_data)  <span class="comment"># 加密数据</span></span><br><span class="line">    <span class="keyword">return</span> ciphertext</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对请求体进行AES加密</span></span><br><span class="line">encrypt_body = aes_encrypt(body_str, key, iv)</span><br><span class="line"><span class="built_in">print</span>(encrypt_body.<span class="built_in">hex</span>())  <span class="comment"># 以十六进制格式打印加密后的数据</span></span><br></pre></td></tr></table></figure>



<h1 id="请求头参数分析"><a href="#请求头参数分析" class="headerlink" title="请求头参数分析"></a>请求头参数分析</h1><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;:authority&quot;</span><span class="punctuation">:</span> <span class="string">&quot;api.bilibili.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;:method&quot;</span><span class="punctuation">:</span> <span class="string">&quot;POST&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;:path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/x/report/click/android2&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;:scheme&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;content-length&quot;</span><span class="punctuation">:</span> <span class="string">&quot;320&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;buvid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;XY17684138CCA764C73112F1B0464F485C112&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;device-id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PF9tVWMHYgNiUTQGegZ6&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;fp_local&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2e941853742b47fa1e688cd567d1a40320250201120422d47654095c87a2e160&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;fp_remote&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2e941853742b47fa1e688cd567d1a4032024123013422042cd4fe24a164fc683&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;session_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;d2bb5a0d&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;env&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prod&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;app-key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;android&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;user-agent&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Mozilla/5.0 BiliDroid/6.24.0 (bbcallen@gmail.com) os/android model/Pixel 3 mobi_app/android build/6240300 channel/alifenfa innerVer/6240300 osVer/9 network/2&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;bili-bridge-engine&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cronet&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;content-type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;application/octet-stream&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;accept-encoding&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gzip, deflate, br&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>这里面需要还原的参数有<code>buvid</code>、<code>device-id</code>、<code>fp_local</code>、<code>fp_remote</code>、<code>session_id</code></p>
<h2 id="buvid参数还原"><a href="#buvid参数还原" class="headerlink" title="buvid参数还原"></a>buvid参数还原</h2><p>通过抓包找到请求接口，反编译apk，定位接口</p>
<p>请求头信息一般会在拦截器当中</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/20.jpg" alt="1"></p>
<p>进入拦截器的类进行分析</p>
<h3 id="c-2"><a href="#c-2" class="headerlink" title="c"></a>c</h3><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/21.jpg" alt="1"></p>
<p>查看<code>e()</code>方法</p>
<h3 id="e"><a href="#e" class="headerlink" title="e"></a>e</h3><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/22.jpg" alt="1"></p>
<p>这里就看到了请求头的参数</p>
<p>先去分析<code>Buvid</code>，通过a3赋值，a3是从<code>com.bilibili.api.c.a()</code>这个方法里获得到的</p>
<h3 id="a"><a href="#a" class="headerlink" title="a"></a>a</h3><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/23.jpg" alt="1"></p>
<p>从这里面看出a是通过<code>str</code>赋值的，<code>str</code>参数是<code>b</code>方法里传进去的参数，对b方法查找用例</p>
<h3 id="e-1"><a href="#e-1" class="headerlink" title="e"></a>e</h3><p>查找用例找到了e方法</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/24.jpg" alt="1"></p>
<p>而这里面参数<code>str</code>来源于e方法，继续查找用例</p>
<h3 id="a-1"><a href="#a-1" class="headerlink" title="a"></a>a</h3><p>查找用例找到了a方法</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/25.jpg" alt="1"></p>
<p>这里面<code>str</code>通过<code>this.a</code>赋值，接着找谁给<code>this.a</code>赋值的</p>
<h3 id="d"><a href="#d" class="headerlink" title="d"></a>d</h3><p>找到了一个<code>d</code>方法，这里面对<code>this.a</code>进行了赋值</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/26.jpg" alt="1"></p>
<p>其实还有一种方式，通过打印调用栈信息也可以追溯到参数被赋值的位置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_b</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> c = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.bilibili.api.c&quot;</span>);</span><br><span class="line">        c[<span class="string">&quot;b&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">str</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.util.Log&quot;</span>).<span class="title function_">getStackTraceString</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.Throwable&quot;</span>).$new()));</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`c.b is called: str=<span class="subst">$&#123;str&#125;</span>`</span>);</span><br><span class="line">            <span class="variable language_">this</span>[<span class="string">&quot;b&quot;</span>](str);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">hook_b</span>()</span><br></pre></td></tr></table></figure>

<p><strong>hook 结果</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[Pixel 3::tv.danmaku.bili ]-&gt; java.lang.Throwable</span><br><span class="line">        at com.bilibili.api.c.b(Native Method)</span><br><span class="line">        at c2.f.b0.c.a.d.e(BL:1)</span><br><span class="line">        at c2.f.b0.c.a.d.a(BL:11)</span><br><span class="line">        at tv.danmaku.bili.utils.x.a(BL:14)</span><br><span class="line">        at tv.danmaku.bili.proc.y.f(BL:1)</span><br><span class="line">        at tv.danmaku.bili.proc.c.run(Unknown Source:2)</span><br><span class="line">        at android.os.Handler.handleCallback(Handler.java:873)</span><br><span class="line">        at android.os.Handler.dispatchMessage(Handler.java:99)</span><br><span class="line">        at android.os.Looper.loop(Looper.java:193)</span><br><span class="line">        at android.os.HandlerThread.run(HandlerThread.java:65)</span><br><span class="line"></span><br><span class="line">c.b is called: str=XY17684138CCA764C73112F1B0464F485C112</span><br></pre></td></tr></table></figure>



<p>找到了<code>this.a</code>之后，发现有三种赋值的情况，第一种情况<code>MiscHelperKt.d(e.k().b())</code>是从<code>XML</code>文件和内存中取<code>buvid</code>的值，如果都取不到，会到第二种方式<code>MiscHelperKt.d(e.k().c())</code>也是从<code>XML</code>文件和内存中取<code>buvid</code>的值，如果都取不到，会到第三种方式<code>c2.f.b0.c.b.a.c.a().toUpperCase()</code>，说明第三种方式才是生成<code>buvid</code>的方式</p>
<h3 id="c2-f-b0-c-b-a-c-a"><a href="#c2-f-b0-c-b-a-c-a" class="headerlink" title="c2.f.b0.c.b.a.c.a()"></a>c2.f.b0.c.b.a.c.a()</h3><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/27.jpg" alt="1"></p>
<p>首先调用<code>Application f = BiliContext.f()</code>，返回一个<code>Application</code>类型的字段<code>f</code></p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/28.jpg" alt="1"></p>
<p>可以看到返回的是当前的<code>ActivityThread.currentApplication()</code></p>
<p>在这里有四种返回值的情况</p>
<p>先看第一种，<code>return &quot;XZ&quot; + e(d) + d;</code>，它与<code>e()</code>方法和d有关，d通过<code>com.bilibili.commons.m.a.d(b2);</code>获得</p>
<p>找<code>b2</code>，它通过<code>com.bilibili.lib.biliid.utils.f.c.b(f)</code>获得</p>
<h3 id="com-bilibili-lib-biliid-utils-f-c-b"><a href="#com-bilibili-lib-biliid-utils-f-c-b" class="headerlink" title="com.bilibili.lib.biliid.utils.f.c.b"></a>com.bilibili.lib.biliid.utils.f.c.b</h3><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/32.jpg" alt="1"></p>
<p>返回<code>j2</code>，它通过<code>g.b(context)</code>生成</p>
<h3 id="g-b"><a href="#g-b" class="headerlink" title="g.b"></a>g.b</h3><p>这里可以看出它是与设备状态有关</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/33.jpg" alt="1"></p>
<p>最后的返回值传入了<code>com.bilibili.commons.m.a.d</code>方法</p>
<h3 id="com-bilibili-commons-m-a-d"><a href="#com-bilibili-commons-m-a-d" class="headerlink" title="com.bilibili.commons.m.a.d"></a>com.bilibili.commons.m.a.d</h3><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/29.jpg" alt="1"></p>
<p>这里把传进去的参数转为字节，然后调用了<code>e()</code>方法</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/30.jpg" alt="1"></p>
<p>这里是把传进去的参数再放到<code>h</code>方法里进行了<code>MD5</code>哈希算法</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/31.jpg" alt="1"></p>
<p>还没完，哈希算法之后对结果又进行了处理。</p>
<p>生成的结果要传入<code>e(d)</code>这个方法里</p>
<h3 id="e-2"><a href="#e-2" class="headerlink" title="e"></a>e</h3><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/34.jpg" alt="1"></p>
<p>它是取字符串的第2位，第12位，第22位拼接起来了</p>
<p>最后把<code>XZ</code>和<code>e(d)</code>和<code>d</code>拼接起来就是<code>buvid</code>了</p>
<p>接下来看第二种情况</p>
<h3 id="com-bilibili-lib-biliid-utils-f-a-j"><a href="#com-bilibili-lib-biliid-utils-f-a-j" class="headerlink" title="com.bilibili.lib.biliid.utils.f.a.j"></a>com.bilibili.lib.biliid.utils.f.a.j</h3><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/35.jpg" alt="1"></p>
<p>它调用<code>com.bilibili.droid.g.c(context)</code>来生成返回值</p>
<p>它与mac地址有关</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/36.jpg" alt="1"></p>
<p>后面调用的方法与第一种情况相同</p>
<p>接下来看第三种情况</p>
<h3 id="com-bilibili-lib-biliid-utils-f-c-a"><a href="#com-bilibili-lib-biliid-utils-f-c-a" class="headerlink" title="com.bilibili.lib.biliid.utils.f.c.a"></a>com.bilibili.lib.biliid.utils.f.c.a</h3><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/37.jpg" alt="1"></p>
<p>这里面调用<code>g.a(context)</code>来生成返回值</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/38.jpg" alt="1"></p>
<p>它返回的是<code>android_id</code>也就是如下的<code>a2</code></p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/39.jpg" alt="1"></p>
<p>如果<code>a2</code>不为空，会调用<code>com.bilibili.commons.m.a.d</code>，然后返回<code>&quot;XX&quot; + e(d4) + d4</code></p>
<p>如果<code>a2</code>是空的话，会调用<code>e.k().i().replace(com.bilibili.base.util.d.f, &quot;&quot;)</code>，也就是调用<code>i()</code>方法，返回通过<code>replace</code>对字符进行替换</p>
<p><code>e.k().i()</code>方法如下</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/40.jpg" alt="1"></p>
<p>它其实就是生成了随机的<code>uuid</code>然后字符替换把<code>-</code>设置为空</p>
<p>然后<code>return &quot;XW&quot; + e(replace) + replace</code></p>
<p>这样看的话，<code>a2</code>为空的这种情况还原<code>buvid</code>是最简单的</p>
<h3 id="Python还原buvid"><a href="#Python还原buvid" class="headerlink" title="Python还原buvid"></a>Python还原buvid</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line">uuid_data = <span class="built_in">str</span>(uuid.uuid4()).replace(<span class="string">&quot;-&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">t2_12_22 = uuid_data[<span class="number">2</span>]+uuid_data[<span class="number">12</span>]+uuid_data[<span class="number">22</span>]</span><br><span class="line">buvid = (<span class="string">&quot;XW&quot;</span>+t2_12_22+uuid_data).upper()</span><br><span class="line"><span class="built_in">print</span>(buvid)</span><br></pre></td></tr></table></figure>

<h2 id="session-id参数还原"><a href="#session-id参数还原" class="headerlink" title="session_id参数还原"></a>session_id参数还原</h2><p>如下，<code>session_id</code>的值是字段<code>m2</code>，它是<code>com.bilibili.api.a.m()</code>方法的返回值</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/41.jpg" alt="1"></p>
<p>去分析m方法</p>
<h3 id="com-bilibili-api-a-m"><a href="#com-bilibili-api-a-m" class="headerlink" title="com.bilibili.api.a.m()"></a>com.bilibili.api.a.m()</h3><p>这里通过<code>b</code>调用了<code>gerSessionId()</code>返回的session_id</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/42.jpg" alt="1"></p>
<p>看了一下<code>getSessionId</code>方法，发现它是一个接口方法，要找其实现类</p>
<p>那就去看b是谁，找到一个o方法</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/43.jpg" alt="1"></p>
<p>这个方法接受一个 <code>b</code> 类型的参数 <code>bVar</code>，并将其赋值给 <code>b</code> 静态变量，通过调用 <code>o()</code> 方法来设置 <code>b</code> 变量为一个实现了接口 <code>b</code> 的对象实例。</p>
<p>接下来可以通过hook o方法查看传入的参数bVar是什么类型</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_o</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> a = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.bilibili.api.a&quot;</span>);</span><br><span class="line">        a[<span class="string">&quot;o&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">bVar</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`a.o is called: bVar=<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(bVar)&#125;</span>`</span>);</span><br><span class="line">            <span class="variable language_">this</span>[<span class="string">&quot;o&quot;</span>](bVar);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>hook 结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a.o is called: bVar=&quot;&lt;instance: com.bilibili.api.a$b, $className: tv.danmaku.bili.utils.p$a&gt;&quot;</span><br><span class="line">接口类型是：com.bilibili.api.a$b</span><br><span class="line">具体类型是：tv.danmaku.bili.utils.p$a</span><br></pre></td></tr></table></figure>

<p>去找<code>tv.danmaku.bili.utils.p$a</code></p>
<h3 id="tv-danmaku-bili-utils-p-a"><a href="#tv-danmaku-bili-utils-p-a" class="headerlink" title="tv.danmaku.bili.utils.p.a"></a>tv.danmaku.bili.utils.p.a</h3><p>在这个类里面找到了<code>gerSessionId()</code>的实现</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/44.jpg" alt="1"></p>
<p>这里是通过<code>com.bilibili.lib.foundation.e.b()</code>来调用的<code>gerSessionId()</code></p>
<p>看<code>b</code>方法的内容</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/45.jpg" alt="1"></p>
<p>它又调用了<code>d.g.b().d()</code></p>
<p>看<code>d</code>方法的内容</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/46.jpg" alt="1"></p>
<p>它返回的是<code>this.a</code></p>
<p>去找谁给<code>this.a</code>赋值的</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/47.jpg" alt="1"></p>
<p><code>this.a</code>是<code>DefaultApps</code>类型</p>
<p>在<code>DefaultApps</code>里面就会有对<code>gerSessionId()</code>的重写，找到了</p>
<h3 id="gerSessionId"><a href="#gerSessionId" class="headerlink" title="gerSessionId()"></a>gerSessionId()</h3><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/48.jpg" alt="1"></p>
<p>调用<code>getString()</code>方法返回一个字符串，<code>e()</code>返回的是<code>SharedPreferences</code>类型， <code>getString()</code>从保存的数据中找键为<code>foundation:session_id</code>的值，如果没有找到，返回<code>l</code>。</p>
<p>接下来去找<code>l</code>是怎么赋值的，如下</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/49.jpg" alt="1"></p>
<p>这段代码生成了一个由4个随机字节组成的字节数组，并将这些字节转换为一个十六进制字符串。随后，这个十六进制字符串通过 <code>x.h()</code> 方法进行处理，并赋值给变量 <code>l</code>。<code>x.h()</code>用于对<code>hex</code>进行是否为空的检测。</p>
<h3 id="Python生成session-id"><a href="#Python生成session-id" class="headerlink" title="Python生成session_id"></a>Python生成session_id</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_session_id</span>():</span><br><span class="line">    <span class="keyword">return</span> random.randbytes(<span class="number">4</span>).<span class="built_in">hex</span>()</span><br></pre></td></tr></table></figure>

<h2 id="fp-local参数还原"><a href="#fp-local参数还原" class="headerlink" title="fp_local参数还原"></a>fp_local参数还原</h2><p>如下，<code>fp_local</code>的值为字段<code>j2</code>，它是通过<code>com.bilibili.api.a.j()</code>方法获取的</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/50.jpg" alt="1"></p>
<h3 id="com-bilibili-api-a-j"><a href="#com-bilibili-api-a-j" class="headerlink" title="com.bilibili.api.a.j()"></a>com.bilibili.api.a.j()</h3><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/51.jpg" alt="1"></p>
<p>这里的<code>F()</code>方法是接口方法，b是其实现类，它是在一个<code>o</code>方法里赋值的</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/43.jpg" alt="1"></p>
<p>找到o方法的上层调用，在<code>tv.danmaku.bili.utils.p.b()</code>方法里</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/52.jpg" alt="1"></p>
<p>里面传入的是一个a对象，在a类里有对<code>F()</code>方法的实现</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/53.jpg" alt="1"></p>
<p>在<code>F()</code>方法里返回了一个字段<code>a</code>，它使用过<code>c2.f.b0.c.a.c.a()</code>，这个方法获得的 </p>
<h3 id="c2-f-b0-c-a-c-a"><a href="#c2-f-b0-c-a-c-a" class="headerlink" title="c2.f.b0.c.a.c.a()"></a>c2.f.b0.c.a.c.a()</h3><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/54.jpg" alt="1"></p>
<p><code>a</code>方法返回的是<code>Fingerprint.h.c()</code>方法的返回值</p>
<p>看<code>Fingerprint.h.c()</code>方法</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/55.jpg" alt="1"></p>
<p>这里是首先定义了一个<code>str</code>为空，然后把类字段<code>a</code>赋值给了<code>str</code>，然后进行返回，所以返回的值其实是<code>a</code>，接下来找<code>a</code>是怎么来的</p>
<p>如下，找到了一个地方对<code>a</code>进行了赋值</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/56.jpg" alt="1"></p>
<p>通过字段<code>d2</code>对<code>a</code>进行赋值，接下来找<code>d2</code>是怎么生成的</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/57.jpg" alt="1"></p>
<p>先调用<code>env.d()</code>方法在内存中找<code>fp_local</code>，找不到的话就调用<code>d2 = com.bilibili.lib.biliid.internal.fingerprint.a.a.a(buvidLegacy, aVar);</code>来生成</p>
<p>先分析<code>a()</code>方法里的两个参数是怎么来的</p>
<h3 id="buvidLegacy"><a href="#buvidLegacy" class="headerlink" title="buvidLegacy"></a>buvidLegacy</h3><p><code>buvidLegacy</code>通过<code>String buvidLegacy = c3.a();</code>方法来获取</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/58.jpg" alt="1"></p>
<p>这个<code>a()</code>方法与生成<code>buvid</code>时的<code>a()</code>方法是一样的，它的返回值就是<code>buvid</code></p>
<h3 id="aVar"><a href="#aVar" class="headerlink" title="aVar"></a>aVar</h3><p><code>aVar</code>通过<code>com.bilibili.lib.biliid.internal.fingerprint.b.a aVar = b;</code>来赋值，</p>
<p>字段<code>b</code>来源于<code>b = Data.a();</code></p>
<p>这里我hook了一下<code>a()</code>方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_a</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="title class_">Data</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.bilibili.lib.biliid.internal.fingerprint.data.DataKt&quot;</span>);</span><br><span class="line">        <span class="title class_">Data</span>[<span class="string">&quot;a&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Data.a is called`</span>);</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;a&quot;</span>]();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Data.a result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">hook_a</span>()</span><br></pre></td></tr></table></figure>

<p><strong>hook 结果</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Data.a is called</span><br><span class="line">Data.a result=</span><br><span class="line">Data(main=&#123;str_brightness=32, app_version=6.24.0, cpuModel=ARMv8 Processor rev 13 (v8l), speed_sensor=1, adb_enabled=1, screen=1080,2028,440, ui_version=pd1a.180720.030, linear_speed_sensor=1, virtualproc=[], sensors_info=[&#123;&quot;name&quot;:&quot;TMD2725 Proximity (wake-up)&quot;,&quot;vendor&quot;:&quot;AMS&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;8&quot;,&quot;maxRange&quot;:&quot;5.0&quot;,&quot;resolution&quot;:&quot;0.1&quot;,&quot;power&quot;:&quot;0.001&quot;,&quot;minDelay&quot;:&quot;0&quot;&#125;, &#123;&quot;name&quot;:&quot;BMP380 Barometer&quot;,&quot;vendor&quot;:&quot;Bosch&quot;,&quot;version&quot;:&quot;8709&quot;,&quot;type&quot;:&quot;6&quot;,&quot;maxRange&quot;:&quot;1250.0&quot;,&quot;resolution&quot;:&quot;0.1&quot;,&quot;power&quot;:&quot;0.7&quot;,&quot;minDelay&quot;:&quot;40000&quot;&#125;, &#123;&quot;name&quot;:&quot;BMP380 Temperature&quot;,&quot;vendor&quot;:&quot;Bosch&quot;,&quot;version&quot;:&quot;8709&quot;,&quot;type&quot;:&quot;33172003&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;0.1&quot;,&quot;power&quot;:&quot;0.3&quot;,&quot;minDelay&quot;:&quot;200000&quot;&#125;, &#123;&quot;name&quot;:&quot;LIS2MDL Magnetometer Uncalibrated&quot;,&quot;vendor&quot;:&quot;STMicro&quot;,&quot;version&quot;:&quot;262&quot;,&quot;type&quot;:&quot;14&quot;,&quot;maxRange&quot;:&quot;4915.2&quot;,&quot;resolution&quot;:&quot;0.1&quot;,&quot;power&quot;:&quot;0.2&quot;,&quot;minDelay&quot;:&quot;10000&quot;&#125;, &#123;&quot;name&quot;:&quot;BMI160 Temperature&quot;,&quot;vendor&quot;:&quot;BOSCH&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;33172002&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;0.1&quot;,&quot;power&quot;:&quot;0.18&quot;,&quot;minDelay&quot;:&quot;200000&quot;&#125;, &#123;&quot;name&quot;:&quot;camera v-sync 2&quot;,&quot;vendor&quot;:&quot;google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;33172005&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;0.1&quot;,&quot;power&quot;:&quot;0.001&quot;,&quot;minDelay&quot;:&quot;0&quot;&#125;, &#123;&quot;name&quot;:&quot;camera v-sync 1&quot;,&quot;vendor&quot;:&quot;google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;33172005&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;0.1&quot;,&quot;power&quot;:&quot;0.001&quot;,&quot;minDelay&quot;:&quot;0&quot;&#125;, &#123;&quot;name&quot;:&quot;camera v-sync 0&quot;,&quot;vendor&quot;:&quot;google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;33172005&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;0.1&quot;,&quot;power&quot;:&quot;0.001&quot;,&quot;minDelay&quot;:&quot;0&quot;&#125;, &#123;&quot;name&quot;:&quot;BMI160 Gyroscope Uncalibrated&quot;,&quot;vendor&quot;:&quot;BOSCH&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;16&quot;,&quot;maxRange&quot;:&quot;34.906555&quot;,&quot;resolution&quot;:&quot;0.0010652635&quot;,&quot;power&quot;:&quot;0.9&quot;,&quot;minDelay&quot;:&quot;2500&quot;&#125;, &#123;&quot;name&quot;:&quot;BMI160 Gyroscope&quot;,&quot;vendor&quot;:&quot;BOSCH&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;4&quot;,&quot;maxRange&quot;:&quot;34.906555&quot;,&quot;resolution&quot;:&quot;0.0010652635&quot;,&quot;power&quot;:&quot;0.9&quot;,&quot;minDelay&quot;:&quot;2500&quot;&#125;, &#123;&quot;name&quot;:&quot;LIS2MDL Temperature&quot;,&quot;vendor&quot;:&quot;STMicro&quot;,&quot;version&quot;:&quot;262&quot;,&quot;type&quot;:&quot;33172004&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;0.1&quot;,&quot;power&quot;:&quot;0.001&quot;,&quot;minDelay&quot;:&quot;10000&quot;&#125;, &#123;&quot;name&quot;:&quot;MAX11261&quot;,&quot;vendor&quot;:&quot;Maxim&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;33172001&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;0.1&quot;,&quot;power&quot;:&quot;0.001&quot;,&quot;minDelay&quot;:&quot;10000&quot;&#125;, &#123;&quot;name&quot;:&quot;BMI160 Accelerometer Uncalibrated&quot;,&quot;vendor&quot;:&quot;BOSCH&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;35&quot;,&quot;maxRange&quot;:&quot;1539.5468&quot;,&quot;resolution&quot;:&quot;4.6983238E-5&quot;,&quot;power&quot;:&quot;0.18&quot;,&quot;minDelay&quot;:&quot;2500&quot;&#125;, &#123;&quot;name&quot;:&quot;LIS2MDL Magnetometer&quot;,&quot;vendor&quot;:&quot;STMicro&quot;,&quot;version&quot;:&quot;262&quot;,&quot;type&quot;:&quot;2&quot;,&quot;maxRange&quot;:&quot;4915.2&quot;,&quot;resolution&quot;:&quot;0.1&quot;,&quot;power&quot;:&quot;0.2&quot;,&quot;minDelay&quot;:&quot;10000&quot;&#125;, &#123;&quot;name&quot;:&quot;TMD2725 Ambient Light&quot;,&quot;vendor&quot;:&quot;AMS&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;5&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;0.001&quot;,&quot;power&quot;:&quot;0.001&quot;,&quot;minDelay&quot;:&quot;0&quot;&#125;, &#123;&quot;name&quot;:&quot;BMI160 Accelerometer&quot;,&quot;vendor&quot;:&quot;BOSCH&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;1&quot;,&quot;maxRange&quot;:&quot;1539.5468&quot;,&quot;resolution&quot;:&quot;4.6983238E-5&quot;,&quot;power&quot;:&quot;0.18&quot;,&quot;minDelay&quot;:&quot;2500&quot;&#125;, &#123;&quot;name&quot;:&quot;Binned Brightness&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;65541&quot;,&quot;maxRange&quot;:&quot;255.0&quot;,&quot;resolution&quot;:&quot;1.0&quot;,&quot;power&quot;:&quot;0.2&quot;,&quot;minDelay&quot;:&quot;1000000&quot;&#125;, &#123;&quot;name&quot;:&quot;Device Pickup Sensor&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;25&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;1.0&quot;,&quot;power&quot;:&quot;0.25&quot;,&quot;minDelay&quot;:&quot;-1&quot;&#125;, &#123;&quot;name&quot;:&quot;Proximity Gated Double Tap Gesture&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;65543&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;0.0&quot;,&quot;power&quot;:&quot;0.001&quot;,&quot;minDelay&quot;:&quot;-1&quot;&#125;, &#123;&quot;name&quot;:&quot;Double Twist&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;65537&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;1.0&quot;,&quot;power&quot;:&quot;1.0&quot;,&quot;minDelay&quot;:&quot;0&quot;&#125;, &#123;&quot;name&quot;:&quot;Game Rotation Vector Sensor&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;15&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;1.0E-5&quot;,&quot;power&quot;:&quot;1.0&quot;,&quot;minDelay&quot;:&quot;5000&quot;&#125;, &#123;&quot;name&quot;:&quot;Geomagnetic Rotation Vector Sensor&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;20&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;1.0E-5&quot;,&quot;power&quot;:&quot;1.0&quot;,&quot;minDelay&quot;:&quot;5000&quot;&#125;, &#123;&quot;name&quot;:&quot;Gravity Sensor&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;9&quot;,&quot;maxRange&quot;:&quot;9.81&quot;,&quot;resolution&quot;:&quot;1.0E-5&quot;,&quot;power&quot;:&quot;1.0&quot;,&quot;minDelay&quot;:&quot;5000&quot;&#125;, &#123;&quot;name&quot;:&quot;Linear Acceleration Sensor&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;10&quot;,&quot;maxRange&quot;:&quot;156.96&quot;,&quot;resolution&quot;:&quot;1.0E-5&quot;,&quot;power&quot;:&quot;1.0&quot;,&quot;minDelay&quot;:&quot;20000&quot;&#125;, &#123;&quot;name&quot;:&quot;Orientation Sensor&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;3&quot;,&quot;maxRange&quot;:&quot;360.0&quot;,&quot;resolution&quot;:&quot;1.0E-5&quot;,&quot;power&quot;:&quot;1.0&quot;,&quot;minDelay&quot;:&quot;5000&quot;&#125;, &#123;&quot;name&quot;:&quot;Rotation Vector Sensor&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;11&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;1.0E-5&quot;,&quot;power&quot;:&quot;1.0&quot;,&quot;minDelay&quot;:&quot;5000&quot;&#125;, &#123;&quot;name&quot;:&quot;Significant Motion&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;17&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;1.0&quot;,&quot;power&quot;:&quot;0.25&quot;,&quot;minDelay&quot;:&quot;-1&quot;&#125;, &#123;&quot;name&quot;:&quot;Step Counter&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;19&quot;,&quot;maxRange&quot;:&quot;1.8446744E19&quot;,&quot;resolution&quot;:&quot;1.0&quot;,&quot;power&quot;:&quot;0.1&quot;,&quot;minDelay&quot;:&quot;0&quot;&#125;, &#123;&quot;name&quot;:&quot;Step Detector&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;18&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;1.0&quot;,&quot;power&quot;:&quot;0.1&quot;,&quot;minDelay&quot;:&quot;0&quot;&#125;, &#123;&quot;name&quot;:&quot;Tilt Sensor&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;22&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;0.0&quot;,&quot;power&quot;:&quot;0.25&quot;,&quot;minDelay&quot;:&quot;0&quot;&#125;, &#123;&quot;name&quot;:&quot;Device Orientation&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;27&quot;,&quot;maxRange&quot;:&quot;3.0&quot;,&quot;resolution&quot;:&quot;1.0&quot;,&quot;power&quot;:&quot;1.0&quot;,&quot;minDelay&quot;:&quot;0&quot;&#125;], app_version_code=6240300, batteryState=BATTERY_STATUS_CHARGING, aaid=, model=Pixel 3, band=g845-00023-180815-B-4956438, wifimac=3C:28:6D:EA:A3:E2, net=[&quot;dummy0,fe80::64cc:afff:fe17:88eb%dummy0,66:cc:af:17:88:eb&quot;, &quot;r_rmnet_data0,fe80::9615:8f49:b195:c0c2%r_rmnet_data0,&quot;, &quot;lo,::1,127.0.0.1,&quot;, &quot;wlan0,fe80::3e28:6dff:feea:a3e2%wlan0,192.168.0.112,3c:28:6d:ea:a3:e2&quot;, &quot;rmnet_data0,fe80::f39b:f668:3162:3fd1%rmnet_data0,&quot;, &quot;rmnet_ipa0,,&quot;], app_id=1, brand=google, cpuCount=8, biometric=1, maps=, btmac=, cpuVendor=Qualcomm, device_angle=-0.011197972,2.7591743,-0.0041870493, str_battery=96, vaid=, build_id=PD1A.180720.030, androidappcnt=260, guid=a05fc3dd-ed19-4d54-b7f7-e0a628a91c2a, files=/data/user/0/tv.danmaku.bili/files, sensor=[&quot;TMD2725 Proximity (wake-up),AMS&quot;, &quot;BMP380 Barometer,Bosch&quot;, &quot;BMP380 Temperature,Bosch&quot;, &quot;LIS2MDL Magnetometer Uncalibrated,STMicro&quot;, &quot;BMI160 Temperature,BOSCH&quot;, &quot;camera v-sync 2,google&quot;, &quot;camera v-sync 1,google&quot;, &quot;camera v-sync 0,google&quot;, &quot;BMI160 Gyroscope Uncalibrated,BOSCH&quot;, &quot;BMI160 Gyroscope,BOSCH&quot;, &quot;LIS2MDL Temperature,STMicro&quot;, &quot;MAX11261,Maxim&quot;, &quot;BMI160 Accelerometer Uncalibrated,BOSCH&quot;, &quot;LIS2MDL Magnetometer,STMicro&quot;, &quot;TMD2725 Ambient Light,AMS&quot;, &quot;BMI160 Accelerometer,BOSCH&quot;, &quot;Binned Brightness,Google&quot;, &quot;Device Pickup Sensor,Google&quot;, &quot;Proximity Gated Double Tap Gesture,Google&quot;, &quot;Double Twist,Google&quot;, &quot;Game Rotation Vector Sensor,Google&quot;, &quot;Geomagnetic Rotation Vector Sensor,Google&quot;, &quot;Gravity Sensor,Google&quot;, &quot;Linear Acceleration Sensor,Google&quot;, &quot;Orientation Sensor,Google&quot;, &quot;Rotation Vector Sensor,Google&quot;, &quot;Significant Motion,Google&quot;, &quot;Step Counter,Google&quot;, &quot;Step Detector,Google&quot;, &quot;Tilt Sensor,Google&quot;, &quot;Device Orientation,Google&quot;], gadid=, fstorage=33928413184, virtual=0, memory=3723137024, mid=, oid=, emu=000, is_root=true, battery=96, mac=3C:28:6D:EA:A3:E2, network=WIFI, uid=10243, data_connect_state=0, glimit=, adid=5abb19ceea116b31, mem=3723137024, countryIso=CN, sim=1, root=1, sdkver=0.2.4, light_intensity=4.1807923, boot=976254663, str_app_id=1, oaid=, apps=[&quot;1230796800000,com.google.omadm.trigger,1,1.0,1,1230796800000&quot;,&quot;1230796800000,com.google.android.carriersetup,1,9,28,1230796800000&quot;,&quot;1230796800000,com.android.cts.priv.ctsshim,1,8.1.0-4396705,27,1230796800000&quot;,&quot;1230796800000,com.google.android.youtube,1,20.02.40,1552287168,1738224905212&quot;,&quot;1230796800000,com.vzw.apnlib,1,13.0,14,1230796800000&quot;,&quot;1230796800000,com.android.internal.display.cutout.emulation.corner,1,1.0,1,1230796800000&quot;,&quot;1230796800000,com.google.android.ext.services,1,1,1,1230796800000&quot;,&quot;1729696867893,com.example.hellojnitest,0,1.0,1,1729737782103&quot;,&quot;1230796800000,com.android.internal.display.cutout.emulation.double,1,1.0,1,1230796800000&quot;,&quot;1230796800000,com.android.providers.telephony,1,9,28,1230796800000&quot;,&quot;1230796800000,com.android.sdm.plugins.connmo,1,1.0,1,1230796800000&quot;,&quot;1230796800000,com.google.android.googlequicksearchbox,1,16.2.40.ve.arm64,301459242,1738224848635&quot;,&quot;1230796800000,com.android.providers.calendar,1,9,28,1230796800000&quot;,&quot;1711181586493,net.typeblog.socks,0,1.0.4,13,1711181586493&quot;,&quot;1230796800000,com.android.providers.media,1,9,900,1230796800000&quot;,&quot;1711199319522,com.qiyi.video,0,11.5.0,800110550,1711199319522&quot;,&quot;1230796800000,com.google.android.onetimeinitializer,1,9,28,1230796800000&quot;,&quot;1230796800000,com.google.android.ext.shared,1,1,1,1230796800000&quot;,&quot;1230796800000,com.qualcomm.ltebc_vzw,1,MSDC_LA_4.2.01.11.0,42010110,1230796800000&quot;,&quot;1230796800000,com.quicinc.cne.CNEService,1,1.1,1,1230796800000&quot;], androidsysapp20=[&quot;1230796800000,com.google.omadm.trigger,1,1.0,1,1230796800000&quot;,&quot;1230796800000,com.google.android.carriersetup,1,9,28,1230796800000&quot;,&quot;1230796800000,com.android.cts.priv.ctsshim,1,8.1.0-4396705,27,1230796800000&quot;,&quot;1230796800000,com.google.android.youtube,1,20.02.40,1552287168,1738224905212&quot;,&quot;1230796800000,com.vzw.apnlib,1,13.0,14,1230796800000&quot;,&quot;1230796800000,com.android.internal.display.cutout.emulation.corner,1,1.0,1,1230796800000&quot;,&quot;1230796800000,com.google.android.ext.services,1,1,1,1230796800000&quot;,&quot;1230796800000,com.android.internal.display.cutout.emulation.double,1,1.0,1,1230796800000&quot;,&quot;1230796800000,com.android.providers.telephony,1,9,28,1230796800000&quot;,&quot;1230796800000,com.android.sdm.plugins.connmo,1,1.0,1,1230796800000&quot;,&quot;1230796800000,com.google.android.googlequicksearchbox,1,16.2.40.ve.arm64,301459242,1738224848635&quot;,&quot;1230796800000,com.android.providers.calendar,1,9,28,1230796800000&quot;,&quot;1230796800000,com.android.providers.media,1,9,900,1230796800000&quot;,&quot;1230796800000,com.google.android.onetimeinitializer,1,9,28,1230796800000&quot;,&quot;1230796800000,com.google.android.ext.shared,1,1,1,1230796800000&quot;,&quot;1230796800000,com.qualcomm.ltebc_vzw,1,MSDC_LA_4.2.01.11.0,42010110,1230796800000&quot;,&quot;1230796800000,com.quicinc.cne.CNEService,1,1.1,1,1230796800000&quot;,&quot;1230796800000,com.qualcomm.qti.smcinvokepkgmgr,1,1.0,1,1230796800000&quot;,&quot;1230796800000,com.android.documentsui,1,9,28,1230796800000&quot;,&quot;1230796800000,android.auto_generated_rro__,1,1.0,1,1230796800000&quot;], proc=tv.danmaku.bili, fts=1738507220, os=android, languages=zh, systemvolume=0, free_memory=1727660032, totalSpace=55379472384, accessibility_service=[&quot;com.google.android.marvin.talkback/.TalkBackService&quot;, &quot;com.google.android.marvin.talkback/com.google.android.accessibility.accessibilitymenu.AccessibilityMenuService&quot;, &quot;com.google.android.marvin.talkback/com.google.android.accessibility.selecttospeak.SelectToSpeakService&quot;, &quot;com.google.android.marvin.talkback/com.android.switchaccess.SwitchAccessService&quot;, &quot;bin.mt.plus/bin.mt.function.ar.ActivityRecordService&quot;, &quot;com.estrongs.android.pop/com.estrongs.fs.impl.local.AutoAuthService&quot;, &quot;com.qihoo.appstore/.accessibility.AppstoreAccessibility&quot;, &quot;com.wandoujia.phoenix2/com.pp.assistant.accessibility.AccessibilityService&quot;, &quot;com.xingin.xhs/com.xingin.alpha.common.access.GameRecordAccessibilityService&quot;], osver=9, chid=alifenfa, androidapp20=[&quot;1729696867893,com.example.hellojnitest,0,1.0,1,1729737782103&quot;,&quot;1711181586493,net.typeblog.socks,0,1.0.4,13,1711181586493&quot;,&quot;1711199319522,com.qiyi.video,0,11.5.0,800110550,1711199319522&quot;,&quot;1728583109623,com.zx.Justmeplush,0,2.0,2,1728583109623&quot;,&quot;1737391958923,com.douban.frodo,0,7.89.0,307,1737391958923&quot;,&quot;1730733792580,com.github.kr328.clash,0,3.0.3.premium,300003,1730733792580&quot;,&quot;1730769260488,com.example.packerapp,0,1.0,1,1730799296361&quot;,&quot;1725493032640,com.example.javahookdemo,0,1.0,1,1725974937739&quot;,&quot;1737130307244,com.ushaqi.zhuishushenqi,0,4.85.73,7973,1737130307244&quot;,&quot;1732863178328,com.yaotong.crackme,0,1.0,1,1732863178328&quot;,&quot;1730294059865,com.example.unidbgtest,0,1.0,1,1730295569462&quot;,&quot;1728375218269,com.izen.abc,0,1.0.9,1,1728375218269&quot;,&quot;1729958664139,com.example.aestool,0,1.0,1,1729958783366&quot;,&quot;1730368506985,com.example.develop_test,0,1.0,1,1730373040462&quot;,&quot;1723908516582,com.example.activitytest,0,1.0,1,1723909442352&quot;,&quot;1732874628219,com.xingin.xhs,0,8.57.0,8570985,1732961699211&quot;,&quot;1738373185269,com.zj.wuaipojie2025,0,1.0,1,1738373185269&quot;,&quot;1726495470725,com.example.plugindex,0,1.0,1,1726495470725&quot;,&quot;1732961995889,com.netease.community,0,1.2,67,1732961995889&quot;,&quot;1732244828849,vz.bwu,0,1.0,1,1732244828849&quot;], biometrics=touchid, last_dump_ts=1738576816411, brightness=32, gyroscope_sensor=1, t=1738586160751, kernel_version=4.9.96-g340a9aaf92bc-ab4959234, usb_connected=1, cpuFreq=1766400, gps_sensor=1, data_activity_state=0, axposed=false, first=false&#125;, propery=&#123;net.hostname=, ro.boot.hardware=blueline, gsm.sim.state=, ro.build.date.utc=1534990449, ro.product.device=blueline, persist.sys.language=, ro.debuggable=0, net.gprs.local-ip=, ro.build.tags=release-keys, http.proxy=, ro.serialno=, persist.sys.country=, ro.boot.serialno=, gsm.network.type=Unknown, net.eth0.gw=, net.dns1=, sys.usb.state=, http.agent=&#125;, sys=&#123;product=blueline, cpu_abi=armeabi-v7a, serial=unknown, display=PD1A.180720.030, fingerprint=google/blueline/blueline:9/PD1A.180720.030/4972053:user/release-keys, cpu_abi2=armeabi, device=blueline, manufacturer=Google, hardware=blueline&#125;)</span><br></pre></td></tr></table></figure>

<p>这个结果很长，先放在这里，后面分析。</p>
<h3 id="a-2"><a href="#a-2" class="headerlink" title="a()"></a>a()</h3><p><code>buvidLegacy</code>和 <code>aVar</code>这两个参数知道是什么了，接下来再去看<code>a()</code>方法</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/59.jpg" alt="1"></p>
<p>这里面调用了一系列函数得到返回值先看<code>MiscHelperKt.a(f(buvidLegacy, data))</code>里的<code>f(buvidLegacy, data)</code></p>
<h3 id="f-1"><a href="#f-1" class="headerlink" title="f()"></a>f()</h3><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/60.jpg" alt="1"></p>
<p>这里面是调用<code>aVar.a()</code>得到<code>a2</code></p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/61.jpg" alt="1"></p>
<p>这里的<code>a2</code>就是前面<code>aVar</code>里的<code>main</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">main=&#123;str_brightness=32, app_version=6.24.0, cpuModel=ARMv8 Processor rev 13 (v8l), speed_sensor=1, adb_enabled=1, screen=1080,2028,440, ui_version=pd1a.180720.030, linear_speed_sensor=1, virtualproc=[], sensors_info=[&#123;&quot;name&quot;:&quot;TMD2725 Proximity (wake-up)&quot;,&quot;vendor&quot;:&quot;AMS&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;8&quot;,&quot;maxRange&quot;:&quot;5.0&quot;,&quot;resolution&quot;:&quot;0.1&quot;,&quot;power&quot;:&quot;0.001&quot;,&quot;minDelay&quot;:&quot;0&quot;&#125;, &#123;&quot;name&quot;:&quot;BMP380 Barometer&quot;,&quot;vendor&quot;:&quot;Bosch&quot;,&quot;version&quot;:&quot;8709&quot;,&quot;type&quot;:&quot;6&quot;,&quot;maxRange&quot;:&quot;1250.0&quot;,&quot;resolution&quot;:&quot;0.1&quot;,&quot;power&quot;:&quot;0.7&quot;,&quot;minDelay&quot;:&quot;40000&quot;&#125;, &#123;&quot;name&quot;:&quot;BMP380 Temperature&quot;,&quot;vendor&quot;:&quot;Bosch&quot;,&quot;version&quot;:&quot;8709&quot;,&quot;type&quot;:&quot;33172003&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;0.1&quot;,&quot;power&quot;:&quot;0.3&quot;,&quot;minDelay&quot;:&quot;200000&quot;&#125;, &#123;&quot;name&quot;:&quot;LIS2MDL Magnetometer Uncalibrated&quot;,&quot;vendor&quot;:&quot;STMicro&quot;,&quot;version&quot;:&quot;262&quot;,&quot;type&quot;:&quot;14&quot;,&quot;maxRange&quot;:&quot;4915.2&quot;,&quot;resolution&quot;:&quot;0.1&quot;,&quot;power&quot;:&quot;0.2&quot;,&quot;minDelay&quot;:&quot;10000&quot;&#125;, &#123;&quot;name&quot;:&quot;BMI160 Temperature&quot;,&quot;vendor&quot;:&quot;BOSCH&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;33172002&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;0.1&quot;,&quot;power&quot;:&quot;0.18&quot;,&quot;minDelay&quot;:&quot;200000&quot;&#125;, &#123;&quot;name&quot;:&quot;camera v-sync 2&quot;,&quot;vendor&quot;:&quot;google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;33172005&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;0.1&quot;,&quot;power&quot;:&quot;0.001&quot;,&quot;minDelay&quot;:&quot;0&quot;&#125;, &#123;&quot;name&quot;:&quot;camera v-sync 1&quot;,&quot;vendor&quot;:&quot;google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;33172005&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;0.1&quot;,&quot;power&quot;:&quot;0.001&quot;,&quot;minDelay&quot;:&quot;0&quot;&#125;, &#123;&quot;name&quot;:&quot;camera v-sync 0&quot;,&quot;vendor&quot;:&quot;google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;33172005&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;0.1&quot;,&quot;power&quot;:&quot;0.001&quot;,&quot;minDelay&quot;:&quot;0&quot;&#125;, &#123;&quot;name&quot;:&quot;BMI160 Gyroscope Uncalibrated&quot;,&quot;vendor&quot;:&quot;BOSCH&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;16&quot;,&quot;maxRange&quot;:&quot;34.906555&quot;,&quot;resolution&quot;:&quot;0.0010652635&quot;,&quot;power&quot;:&quot;0.9&quot;,&quot;minDelay&quot;:&quot;2500&quot;&#125;, &#123;&quot;name&quot;:&quot;BMI160 Gyroscope&quot;,&quot;vendor&quot;:&quot;BOSCH&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;4&quot;,&quot;maxRange&quot;:&quot;34.906555&quot;,&quot;resolution&quot;:&quot;0.0010652635&quot;,&quot;power&quot;:&quot;0.9&quot;,&quot;minDelay&quot;:&quot;2500&quot;&#125;, &#123;&quot;name&quot;:&quot;LIS2MDL Temperature&quot;,&quot;vendor&quot;:&quot;STMicro&quot;,&quot;version&quot;:&quot;262&quot;,&quot;type&quot;:&quot;33172004&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;0.1&quot;,&quot;power&quot;:&quot;0.001&quot;,&quot;minDelay&quot;:&quot;10000&quot;&#125;, &#123;&quot;name&quot;:&quot;MAX11261&quot;,&quot;vendor&quot;:&quot;Maxim&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;33172001&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;0.1&quot;,&quot;power&quot;:&quot;0.001&quot;,&quot;minDelay&quot;:&quot;10000&quot;&#125;, &#123;&quot;name&quot;:&quot;BMI160 Accelerometer Uncalibrated&quot;,&quot;vendor&quot;:&quot;BOSCH&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;35&quot;,&quot;maxRange&quot;:&quot;1539.5468&quot;,&quot;resolution&quot;:&quot;4.6983238E-5&quot;,&quot;power&quot;:&quot;0.18&quot;,&quot;minDelay&quot;:&quot;2500&quot;&#125;, &#123;&quot;name&quot;:&quot;LIS2MDL Magnetometer&quot;,&quot;vendor&quot;:&quot;STMicro&quot;,&quot;version&quot;:&quot;262&quot;,&quot;type&quot;:&quot;2&quot;,&quot;maxRange&quot;:&quot;4915.2&quot;,&quot;resolution&quot;:&quot;0.1&quot;,&quot;power&quot;:&quot;0.2&quot;,&quot;minDelay&quot;:&quot;10000&quot;&#125;, &#123;&quot;name&quot;:&quot;TMD2725 Ambient Light&quot;,&quot;vendor&quot;:&quot;AMS&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;5&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;0.001&quot;,&quot;power&quot;:&quot;0.001&quot;,&quot;minDelay&quot;:&quot;0&quot;&#125;, &#123;&quot;name&quot;:&quot;BMI160 Accelerometer&quot;,&quot;vendor&quot;:&quot;BOSCH&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;1&quot;,&quot;maxRange&quot;:&quot;1539.5468&quot;,&quot;resolution&quot;:&quot;4.6983238E-5&quot;,&quot;power&quot;:&quot;0.18&quot;,&quot;minDelay&quot;:&quot;2500&quot;&#125;, &#123;&quot;name&quot;:&quot;Binned Brightness&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;65541&quot;,&quot;maxRange&quot;:&quot;255.0&quot;,&quot;resolution&quot;:&quot;1.0&quot;,&quot;power&quot;:&quot;0.2&quot;,&quot;minDelay&quot;:&quot;1000000&quot;&#125;, &#123;&quot;name&quot;:&quot;Device Pickup Sensor&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;25&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;1.0&quot;,&quot;power&quot;:&quot;0.25&quot;,&quot;minDelay&quot;:&quot;-1&quot;&#125;, &#123;&quot;name&quot;:&quot;Proximity Gated Double Tap Gesture&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;65543&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;0.0&quot;,&quot;power&quot;:&quot;0.001&quot;,&quot;minDelay&quot;:&quot;-1&quot;&#125;, &#123;&quot;name&quot;:&quot;Double Twist&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;65537&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;1.0&quot;,&quot;power&quot;:&quot;1.0&quot;,&quot;minDelay&quot;:&quot;0&quot;&#125;, &#123;&quot;name&quot;:&quot;Game Rotation Vector Sensor&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;15&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;1.0E-5&quot;,&quot;power&quot;:&quot;1.0&quot;,&quot;minDelay&quot;:&quot;5000&quot;&#125;, &#123;&quot;name&quot;:&quot;Geomagnetic Rotation Vector Sensor&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;20&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;1.0E-5&quot;,&quot;power&quot;:&quot;1.0&quot;,&quot;minDelay&quot;:&quot;5000&quot;&#125;, &#123;&quot;name&quot;:&quot;Gravity Sensor&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;9&quot;,&quot;maxRange&quot;:&quot;9.81&quot;,&quot;resolution&quot;:&quot;1.0E-5&quot;,&quot;power&quot;:&quot;1.0&quot;,&quot;minDelay&quot;:&quot;5000&quot;&#125;, &#123;&quot;name&quot;:&quot;Linear Acceleration Sensor&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;10&quot;,&quot;maxRange&quot;:&quot;156.96&quot;,&quot;resolution&quot;:&quot;1.0E-5&quot;,&quot;power&quot;:&quot;1.0&quot;,&quot;minDelay&quot;:&quot;20000&quot;&#125;, &#123;&quot;name&quot;:&quot;Orientation Sensor&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;3&quot;,&quot;maxRange&quot;:&quot;360.0&quot;,&quot;resolution&quot;:&quot;1.0E-5&quot;,&quot;power&quot;:&quot;1.0&quot;,&quot;minDelay&quot;:&quot;5000&quot;&#125;, &#123;&quot;name&quot;:&quot;Rotation Vector Sensor&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;11&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;1.0E-5&quot;,&quot;power&quot;:&quot;1.0&quot;,&quot;minDelay&quot;:&quot;5000&quot;&#125;, &#123;&quot;name&quot;:&quot;Significant Motion&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;17&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;1.0&quot;,&quot;power&quot;:&quot;0.25&quot;,&quot;minDelay&quot;:&quot;-1&quot;&#125;, &#123;&quot;name&quot;:&quot;Step Counter&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;19&quot;,&quot;maxRange&quot;:&quot;1.8446744E19&quot;,&quot;resolution&quot;:&quot;1.0&quot;,&quot;power&quot;:&quot;0.1&quot;,&quot;minDelay&quot;:&quot;0&quot;&#125;, &#123;&quot;name&quot;:&quot;Step Detector&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;18&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;1.0&quot;,&quot;power&quot;:&quot;0.1&quot;,&quot;minDelay&quot;:&quot;0&quot;&#125;, &#123;&quot;name&quot;:&quot;Tilt Sensor&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;22&quot;,&quot;maxRange&quot;:&quot;1.0&quot;,&quot;resolution&quot;:&quot;0.0&quot;,&quot;power&quot;:&quot;0.25&quot;,&quot;minDelay&quot;:&quot;0&quot;&#125;, &#123;&quot;name&quot;:&quot;Device Orientation&quot;,&quot;vendor&quot;:&quot;Google&quot;,&quot;version&quot;:&quot;1&quot;,&quot;type&quot;:&quot;27&quot;,&quot;maxRange&quot;:&quot;3.0&quot;,&quot;resolution&quot;:&quot;1.0&quot;,&quot;power&quot;:&quot;1.0&quot;,&quot;minDelay&quot;:&quot;0&quot;&#125;], app_version_code=6240300, batteryState=BATTERY_STATUS_CHARGING, aaid=, model=Pixel 3, band=g845-00023-180815-B-4956438, wifimac=3C:28:6D:EA:A3:E2, net=[&quot;dummy0,fe80::64cc:afff:fe17:88eb%dummy0,66:cc:af:17:88:eb&quot;, &quot;r_rmnet_data0,fe80::9615:8f49:b195:c0c2%r_rmnet_data0,&quot;, &quot;lo,::1,127.0.0.1,&quot;, &quot;wlan0,fe80::3e28:6dff:feea:a3e2%wlan0,192.168.0.112,3c:28:6d:ea:a3:e2&quot;, &quot;rmnet_data0,fe80::f39b:f668:3162:3fd1%rmnet_data0,&quot;, &quot;rmnet_ipa0,,&quot;], app_id=1, brand=google, cpuCount=8, biometric=1, maps=, btmac=, cpuVendor=Qualcomm, device_angle=-0.011197972,2.7591743,-0.0041870493, str_battery=96, vaid=, build_id=PD1A.180720.030, androidappcnt=260, guid=a05fc3dd-ed19-4d54-b7f7-e0a628a91c2a, files=/data/user/0/tv.danmaku.bili/files, sensor=[&quot;TMD2725 Proximity (wake-up),AMS&quot;, &quot;BMP380 Barometer,Bosch&quot;, &quot;BMP380 Temperature,Bosch&quot;, &quot;LIS2MDL Magnetometer Uncalibrated,STMicro&quot;, &quot;BMI160 Temperature,BOSCH&quot;, &quot;camera v-sync 2,google&quot;, &quot;camera v-sync 1,google&quot;, &quot;camera v-sync 0,google&quot;, &quot;BMI160 Gyroscope Uncalibrated,BOSCH&quot;, &quot;BMI160 Gyroscope,BOSCH&quot;, &quot;LIS2MDL Temperature,STMicro&quot;, &quot;MAX11261,Maxim&quot;, &quot;BMI160 Accelerometer Uncalibrated,BOSCH&quot;, &quot;LIS2MDL Magnetometer,STMicro&quot;, &quot;TMD2725 Ambient Light,AMS&quot;, &quot;BMI160 Accelerometer,BOSCH&quot;, &quot;Binned Brightness,Google&quot;, &quot;Device Pickup Sensor,Google&quot;, &quot;Proximity Gated Double Tap Gesture,Google&quot;, &quot;Double Twist,Google&quot;, &quot;Game Rotation Vector Sensor,Google&quot;, &quot;Geomagnetic Rotation Vector Sensor,Google&quot;, &quot;Gravity Sensor,Google&quot;, &quot;Linear Acceleration Sensor,Google&quot;, &quot;Orientation Sensor,Google&quot;, &quot;Rotation Vector Sensor,Google&quot;, &quot;Significant Motion,Google&quot;, &quot;Step Counter,Google&quot;, &quot;Step Detector,Google&quot;, &quot;Tilt Sensor,Google&quot;, &quot;Device Orientation,Google&quot;], gadid=, fstorage=33928413184, virtual=0, memory=3723137024, mid=, oid=, emu=000, is_root=true, battery=96, mac=3C:28:6D:EA:A3:E2, network=WIFI, uid=10243, data_connect_state=0, glimit=, adid=5abb19ceea116b31, mem=3723137024, countryIso=CN, sim=1, root=1, sdkver=0.2.4, light_intensity=4.1807923, boot=976254663, str_app_id=1, oaid=, apps=[&quot;1230796800000,com.google.omadm.trigger,1,1.0,1,1230796800000&quot;,&quot;1230796800000,com.google.android.carriersetup,1,9,28,1230796800000&quot;,&quot;1230796800000,com.android.cts.priv.ctsshim,1,8.1.0-4396705,27,1230796800000&quot;,&quot;1230796800000,com.google.android.youtube,1,20.02.40,1552287168,1738224905212&quot;,&quot;1230796800000,com.vzw.apnlib,1,13.0,14,1230796800000&quot;,&quot;1230796800000,com.android.internal.display.cutout.emulation.corner,1,1.0,1,1230796800000&quot;,&quot;1230796800000,com.google.android.ext.services,1,1,1,1230796800000&quot;,&quot;1729696867893,com.example.hellojnitest,0,1.0,1,1729737782103&quot;,&quot;1230796800000,com.android.internal.display.cutout.emulation.double,1,1.0,1,1230796800000&quot;,&quot;1230796800000,com.android.providers.telephony,1,9,28,1230796800000&quot;,&quot;1230796800000,com.android.sdm.plugins.connmo,1,1.0,1,1230796800000&quot;,&quot;1230796800000,com.google.android.googlequicksearchbox,1,16.2.40.ve.arm64,301459242,1738224848635&quot;,&quot;1230796800000,com.android.providers.calendar,1,9,28,1230796800000&quot;,&quot;1711181586493,net.typeblog.socks,0,1.0.4,13,1711181586493&quot;,&quot;1230796800000,com.android.providers.media,1,9,900,1230796800000&quot;,&quot;1711199319522,com.qiyi.video,0,11.5.0,800110550,1711199319522&quot;,&quot;1230796800000,com.google.android.onetimeinitializer,1,9,28,1230796800000&quot;,&quot;1230796800000,com.google.android.ext.shared,1,1,1,1230796800000&quot;,&quot;1230796800000,com.qualcomm.ltebc_vzw,1,MSDC_LA_4.2.01.11.0,42010110,1230796800000&quot;,&quot;1230796800000,com.quicinc.cne.CNEService,1,1.1,1,1230796800000&quot;], androidsysapp20=[&quot;1230796800000,com.google.omadm.trigger,1,1.0,1,1230796800000&quot;,&quot;1230796800000,com.google.android.carriersetup,1,9,28,1230796800000&quot;,&quot;1230796800000,com.android.cts.priv.ctsshim,1,8.1.0-4396705,27,1230796800000&quot;,&quot;1230796800000,com.google.android.youtube,1,20.02.40,1552287168,1738224905212&quot;,&quot;1230796800000,com.vzw.apnlib,1,13.0,14,1230796800000&quot;,&quot;1230796800000,com.android.internal.display.cutout.emulation.corner,1,1.0,1,1230796800000&quot;,&quot;1230796800000,com.google.android.ext.services,1,1,1,1230796800000&quot;,&quot;1230796800000,com.android.internal.display.cutout.emulation.double,1,1.0,1,1230796800000&quot;,&quot;1230796800000,com.android.providers.telephony,1,9,28,1230796800000&quot;,&quot;1230796800000,com.android.sdm.plugins.connmo,1,1.0,1,1230796800000&quot;,&quot;1230796800000,com.google.android.googlequicksearchbox,1,16.2.40.ve.arm64,301459242,1738224848635&quot;,&quot;1230796800000,com.android.providers.calendar,1,9,28,1230796800000&quot;,&quot;1230796800000,com.android.providers.media,1,9,900,1230796800000&quot;,&quot;1230796800000,com.google.android.onetimeinitializer,1,9,28,1230796800000&quot;,&quot;1230796800000,com.google.android.ext.shared,1,1,1,1230796800000&quot;,&quot;1230796800000,com.qualcomm.ltebc_vzw,1,MSDC_LA_4.2.01.11.0,42010110,1230796800000&quot;,&quot;1230796800000,com.quicinc.cne.CNEService,1,1.1,1,1230796800000&quot;,&quot;1230796800000,com.qualcomm.qti.smcinvokepkgmgr,1,1.0,1,1230796800000&quot;,&quot;1230796800000,com.android.documentsui,1,9,28,1230796800000&quot;,&quot;1230796800000,android.auto_generated_rro__,1,1.0,1,1230796800000&quot;], proc=tv.danmaku.bili, fts=1738507220, os=android, languages=zh, systemvolume=0, free_memory=1727660032, totalSpace=55379472384, accessibility_service=[&quot;com.google.android.marvin.talkback/.TalkBackService&quot;, &quot;com.google.android.marvin.talkback/com.google.android.accessibility.accessibilitymenu.AccessibilityMenuService&quot;, &quot;com.google.android.marvin.talkback/com.google.android.accessibility.selecttospeak.SelectToSpeakService&quot;, &quot;com.google.android.marvin.talkback/com.android.switchaccess.SwitchAccessService&quot;, &quot;bin.mt.plus/bin.mt.function.ar.ActivityRecordService&quot;, &quot;com.estrongs.android.pop/com.estrongs.fs.impl.local.AutoAuthService&quot;, &quot;com.qihoo.appstore/.accessibility.AppstoreAccessibility&quot;, &quot;com.wandoujia.phoenix2/com.pp.assistant.accessibility.AccessibilityService&quot;, &quot;com.xingin.xhs/com.xingin.alpha.common.access.GameRecordAccessibilityService&quot;], osver=9, chid=alifenfa, androidapp20=[&quot;1729696867893,com.example.hellojnitest,0,1.0,1,1729737782103&quot;,&quot;1711181586493,net.typeblog.socks,0,1.0.4,13,1711181586493&quot;,&quot;1711199319522,com.qiyi.video,0,11.5.0,800110550,1711199319522&quot;,&quot;1728583109623,com.zx.Justmeplush,0,2.0,2,1728583109623&quot;,&quot;1737391958923,com.douban.frodo,0,7.89.0,307,1737391958923&quot;,&quot;1730733792580,com.github.kr328.clash,0,3.0.3.premium,300003,1730733792580&quot;,&quot;1730769260488,com.example.packerapp,0,1.0,1,1730799296361&quot;,&quot;1725493032640,com.example.javahookdemo,0,1.0,1,1725974937739&quot;,&quot;1737130307244,com.ushaqi.zhuishushenqi,0,4.85.73,7973,1737130307244&quot;,&quot;1732863178328,com.yaotong.crackme,0,1.0,1,1732863178328&quot;,&quot;1730294059865,com.example.unidbgtest,0,1.0,1,1730295569462&quot;,&quot;1728375218269,com.izen.abc,0,1.0.9,1,1728375218269&quot;,&quot;1729958664139,com.example.aestool,0,1.0,1,1729958783366&quot;,&quot;1730368506985,com.example.develop_test,0,1.0,1,1730373040462&quot;,&quot;1723908516582,com.example.activitytest,0,1.0,1,1723909442352&quot;,&quot;1732874628219,com.xingin.xhs,0,8.57.0,8570985,1732961699211&quot;,&quot;1738373185269,com.zj.wuaipojie2025,0,1.0,1,1738373185269&quot;,&quot;1726495470725,com.example.plugindex,0,1.0,1,1726495470725&quot;,&quot;1732961995889,com.netease.community,0,1.2,67,1732961995889&quot;,&quot;1732244828849,vz.bwu,0,1.0,1,1732244828849&quot;], biometrics=touchid, last_dump_ts=1738576816411, brightness=32, gyroscope_sensor=1, t=1738586160751, kernel_version=4.9.96-g340a9aaf92bc-ab4959234, usb_connected=1, cpuFreq=1766400, gps_sensor=1, data_activity_state=0, axposed=false, first=false&#125;</span><br></pre></td></tr></table></figure>

<p>返回值调用了一个<code>e()</code>方法<code>e(str + a2.get(PersistEnv.KEY_PUB_MODEL) + a2.get(&quot;band&quot;))</code>，这里面的<code>str</code>是<code>buvid</code>，<code>PersistEnv.KEY_PUB_MODEL</code>的值为<code>model</code>，即手机型号，<code>band</code>是设备编号标识，他们拼接在一起作为<code>e()</code>方法的参数</p>
<h3 id="e-3"><a href="#e-3" class="headerlink" title="e()"></a>e()</h3><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/62.jpg" alt="1"></p>
<p>它是把拼接的字符串进行了MD5哈希算法</p>
<p>这个可以Python实现</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_buvid</span>():</span><br><span class="line">    uuid_data = <span class="built_in">str</span>(uuid.uuid4()).replace(<span class="string">&quot;-&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">    t2_12_22 = uuid_data[<span class="number">2</span>]+uuid_data[<span class="number">12</span>]+uuid_data[<span class="number">22</span>]</span><br><span class="line">    buvid = (<span class="string">&quot;XW&quot;</span>+t2_12_22+uuid_data).upper()</span><br><span class="line">    <span class="keyword">return</span> buvid</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5_call</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="comment"># 创建md5对象</span></span><br><span class="line">    md5 = hashlib.md5()</span><br><span class="line">    <span class="comment"># 更新要加密的数据，参数要是字节类型</span></span><br><span class="line">    md5.update(data.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">	<span class="comment"># 获取加密后的数据，以字节码表示</span></span><br><span class="line">    md5_byte = md5.digest()</span><br><span class="line">    <span class="keyword">return</span> md5_byte</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">e</span>(<span class="params">buvid,model,band</span>):</span><br><span class="line">    data = buvid+model+band</span><br><span class="line">    <span class="keyword">return</span> md5_call(data)</span><br></pre></td></tr></table></figure>

<h3 id="MiscHelperKt-a"><a href="#MiscHelperKt-a" class="headerlink" title="MiscHelperKt.a()"></a>MiscHelperKt.a()</h3><p>接下来分析<code>MiscHelperKt.a(f(buvidLegacy, data))</code></p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/63.jpg" alt="1"></p>
<p>通过调用<code>Oe</code>方法返回字段<code>Oe</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">Oe</span><span class="params">(<span class="type">byte</span>[] bArr, CharSequence charSequence, CharSequence charSequence2, CharSequence charSequence3, <span class="type">int</span> i2, CharSequence charSequence4, kotlin.jvm.c.l lVar, <span class="type">int</span> i3, Object obj)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((i3 &amp; <span class="number">1</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">        charSequence = <span class="string">&quot;, &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">CharSequence</span> <span class="variable">charSequence5</span> <span class="operator">=</span> (i3 &amp; <span class="number">2</span>) != <span class="number">0</span> ? <span class="string">&quot;&quot;</span> : charSequence2;</span><br><span class="line">    <span class="type">CharSequence</span> <span class="variable">charSequence6</span> <span class="operator">=</span> (i3 &amp; <span class="number">4</span>) == <span class="number">0</span> ? charSequence3 : <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i4</span> <span class="operator">=</span> (i3 &amp; <span class="number">8</span>) != <span class="number">0</span> ? -<span class="number">1</span> : i2;</span><br><span class="line">    <span class="keyword">if</span> ((i3 &amp; <span class="number">16</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">        charSequence4 = <span class="string">&quot;...&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">CharSequence</span> <span class="variable">charSequence7</span> <span class="operator">=</span> charSequence4;</span><br><span class="line">    <span class="keyword">if</span> ((i3 &amp; <span class="number">32</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">        lVar = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Fe(bArr, charSequence, charSequence5, charSequence6, i4, charSequence7, lVar);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里面调用了<code>Fe()</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <span class="title function_">Fe</span><span class="params">(<span class="type">byte</span>[] joinToString, CharSequence separator, CharSequence prefix, CharSequence postfix, <span class="type">int</span> i2, CharSequence truncated, kotlin.jvm.c.l&lt;? <span class="built_in">super</span> Byte, ? extends CharSequence&gt; lVar)</span> &#123;</span><br><span class="line">    kotlin.jvm.internal.x.q(joinToString, <span class="string">&quot;$this$joinToString&quot;</span>);</span><br><span class="line">    kotlin.jvm.internal.x.q(separator, <span class="string">&quot;separator&quot;</span>);</span><br><span class="line">    kotlin.jvm.internal.x.q(prefix, <span class="string">&quot;prefix&quot;</span>);</span><br><span class="line">    kotlin.jvm.internal.x.q(postfix, <span class="string">&quot;postfix&quot;</span>);</span><br><span class="line">    kotlin.jvm.internal.x.q(truncated, <span class="string">&quot;truncated&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">sb</span> <span class="operator">=</span> ((StringBuilder) ne(joinToString, <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(), separator, prefix, postfix, i2, truncated, lVar)).toString();</span><br><span class="line">    kotlin.jvm.internal.x.h(sb, <span class="string">&quot;joinTo(StringBuilder(), …ed, transform).toString()&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> sb;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Fe</code>方法返回一个字段<code>sb</code>，<code>sb</code>通过<code>ne()</code>方法获得</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> &lt;A <span class="keyword">extends</span> <span class="title class_">Appendable</span>&gt; A <span class="title function_">ne</span><span class="params">(<span class="type">byte</span>[] joinTo, A buffer, CharSequence separator, CharSequence prefix, CharSequence postfix, <span class="type">int</span> i2, CharSequence truncated, kotlin.jvm.c.l&lt;? <span class="built_in">super</span> Byte, ? extends CharSequence&gt; lVar)</span> &#123;</span><br><span class="line">    kotlin.jvm.internal.x.q(joinTo, <span class="string">&quot;$this$joinTo&quot;</span>);</span><br><span class="line">    kotlin.jvm.internal.x.q(buffer, <span class="string">&quot;buffer&quot;</span>);</span><br><span class="line">    kotlin.jvm.internal.x.q(separator, <span class="string">&quot;separator&quot;</span>);</span><br><span class="line">    kotlin.jvm.internal.x.q(prefix, <span class="string">&quot;prefix&quot;</span>);</span><br><span class="line">    kotlin.jvm.internal.x.q(postfix, <span class="string">&quot;postfix&quot;</span>);</span><br><span class="line">    kotlin.jvm.internal.x.q(truncated, <span class="string">&quot;truncated&quot;</span>);</span><br><span class="line">    buffer.append(prefix);</span><br><span class="line">    <span class="type">int</span> <span class="variable">i3</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">byte</span> b2 : joinTo) &#123;</span><br><span class="line">        i3++;</span><br><span class="line">        <span class="keyword">if</span> (i3 &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            buffer.append(separator);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (i2 &gt;= <span class="number">0</span> &amp;&amp; i3 &gt; i2) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (lVar != <span class="literal">null</span>) &#123;</span><br><span class="line">            buffer.append(lVar.invoke(Byte.valueOf(b2)));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            buffer.append(String.valueOf((<span class="type">int</span>) b2));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (i2 &gt;= <span class="number">0</span> &amp;&amp; i3 &gt; i2) &#123;</span><br><span class="line">        buffer.append(truncated);</span><br><span class="line">    &#125;</span><br><span class="line">    buffer.append(postfix);</span><br><span class="line">    <span class="keyword">return</span> buffer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来先对<code>ne()</code>方法里涉及到的参数查找，往前推找到</p>
<ul>
<li><p><code>joinTo</code>为前面的MD5哈希字节数组</p>
</li>
<li><p><code>prefix</code>的值为<code>&quot;&quot;</code></p>
</li>
<li><p><code>separator</code>为<code>:</code></p>
</li>
<li><p><code>postfix</code>为<code>&quot;&quot;</code></p>
</li>
<li><p><code>i2</code>为-1</p>
</li>
<li><p><code>truncated</code>为<code>...</code></p>
</li>
<li><p><code>lVar</code>为匿名内部类，其<code>invoke</code>方法是对字节型参数进行十六进制格式化，返回其十六进制字符串。</p>
</li>
</ul>
<p>用Python复现</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">MiscHelperKt_a</span>(<span class="params">joinTo</span>):</span><br><span class="line">    buffer = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="comment"># separator = &quot;:&quot;</span></span><br><span class="line">    postfix = <span class="string">&quot;&quot;</span></span><br><span class="line">    i2 = -<span class="number">1</span></span><br><span class="line">    truncated = <span class="string">&quot;...&quot;</span></span><br><span class="line">    i3 = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> joinTo:</span><br><span class="line">        i3 +=<span class="number">1</span></span><br><span class="line">        <span class="comment"># if(i3&gt;1):</span></span><br><span class="line">            <span class="comment"># buffer+=separator</span></span><br><span class="line">        <span class="keyword">if</span>(i2&gt;=<span class="number">0</span> <span class="keyword">and</span> i3&gt;i2):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        buffer+= <span class="string">f&quot;<span class="subst">&#123;(i &amp; <span class="number">0xff</span>):02x&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">if</span> (i2&gt;=<span class="number">0</span> <span class="keyword">and</span> i3&gt;i2):</span><br><span class="line">        buffer+=truncated</span><br><span class="line">    buffer+=postfix</span><br><span class="line">    <span class="keyword">return</span> buffer</span><br></pre></td></tr></table></figure>

<h3 id="h-1"><a href="#h-1" class="headerlink" title="h()"></a>h()</h3><p>接下来分析<code>h()</code>方法</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/64.jpg" alt="1"></p>
<p>返回一个表示当前时间和日期的 <code>Date</code> 对象，精确到毫秒，转为字符串类型。</p>
<p><code>format</code>是一个表示当前时间和日期的 <code>Date</code> 对象的格式化字符串。</p>
<p>可以通过hook h()查看效果</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">call_h</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> a = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.bilibili.lib.biliid.internal.fingerprint.a.a&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> result = a.<span class="title function_">h</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(result); <span class="comment">// 20250203232823</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="g-1"><a href="#g-1" class="headerlink" title="g()"></a>g()</h3><p>接下来分析<code>g()</code>方法</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/65.jpg" alt="1"></p>
<p>它返回的是字段<code>a2</code>，<code>a2</code>通过<code>com.bilibili.commons.e.a(8)</code>方法获得</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/66.jpg" alt="1"></p>
<p>new了一个8字节的数组，然后随机生成8字节的值，然后返回</p>
<p><strong>Python实现</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_g</span>():</span><br><span class="line">    <span class="keyword">return</span> random.randbytes(<span class="number">8</span>)</span><br></pre></td></tr></table></figure>

<p><code>g()</code>生成的结果也是作为参数传入了<code>MiscHelperKt.a()</code></p>
<p>前面这些得到的结果拼接成字符串得到字段<code>str</code></p>
<h3 id="b-1"><a href="#b-1" class="headerlink" title="b()"></a>b()</h3><p><code>str</code>作为参数传递给了<code>b()</code>方法</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/67.jpg" alt="1"></p>
<p>这里面先通过<code>q.n1(0, Math.min(fpEntity.length() - 1, 62))</code>方法得到<code>n1</code>，然后调用<code>q.S0(n1, 2)</code>方法得到<code>S0</code>，通过<code>S0</code>获取<code>g</code>、<code>h</code>、<code>i2</code>的值，这里面可以发现，传入<code>n1</code>方法的参数<code>fpEntity.length()</code>是定值，那么后面的<code>g</code>、<code>h</code>、<code>i2</code>的值也是定值</p>
<p>可以通过<code>hook b</code>方法，然后主动调用<code>b</code>方法打印出<code>g</code>、<code>h</code>、<code>i2</code>的值来查看</p>
<p><strong>hook b</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_b</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> a = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.bilibili.lib.biliid.internal.fingerprint.a.a&quot;</span>);</span><br><span class="line">        a[<span class="string">&quot;b&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">fpEntity</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`a.b is called: fpEntity=<span class="subst">$&#123;fpEntity&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;b&quot;</span>](fpEntity);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`a.b result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">            <span class="comment">// 2e941853742b47fa1e688cd567d1a4032025020418163278d25eb4002944e6  return:2d</span></span><br><span class="line">            <span class="comment">// 2e941853742b47fa1e688cd567d1a403202502041817339cfda327f7a0e755  return:b6</span></span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">hook_b</span>()</span><br></pre></td></tr></table></figure>

<p><strong>hook_g_h_i</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_g_h_i</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> i = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;kotlin.g0.i&quot;</span>);</span><br><span class="line">        i[<span class="string">&quot;g&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`i.g is called`</span>);</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;g&quot;</span>]();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`i.g result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line">        i[<span class="string">&quot;h&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`i.h is called`</span>);</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;h&quot;</span>]();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`i.h result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line">        i[<span class="string">&quot;i&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`i.i is called`</span>);</span><br><span class="line">            <span class="title function_">showStacks</span>()</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;i&quot;</span>]();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`i.i result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>call b</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">call_b</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> a = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.bilibili.lib.biliid.internal.fingerprint.a.a&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> tt = a.<span class="title function_">b</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.String&quot;</span>).$new(<span class="string">&quot;2e941853742b47fa1e688cd567d1a403202502041817339cfda327f7a0e755&quot;</span>));</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(tt);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>hook 结果</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">i.g is called</span><br><span class="line">i.g result=0</span><br><span class="line">i.h is called</span><br><span class="line">i.h result=60</span><br><span class="line">i.i is called</span><br><span class="line">i.i result=2</span><br></pre></td></tr></table></figure>

<p>得出<code>g,h,i2</code>的值分别为<code>0,60,2</code></p>
<p><strong>使用Python还原</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">g_b</span>(<span class="params">fpEntity</span>):</span><br><span class="line">    g = <span class="number">0</span></span><br><span class="line">    h = <span class="number">60</span></span><br><span class="line">    i2 = <span class="number">2</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">True</span>):</span><br><span class="line">        substring = fpEntity[g:g+<span class="number">2</span>]</span><br><span class="line">        a2 = <span class="number">16</span></span><br><span class="line">        i += <span class="built_in">int</span>(substring,a2)</span><br><span class="line">        <span class="keyword">if</span> (g == h):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        g+=i2</span><br><span class="line">    strformat = <span class="string">f&quot;<span class="subst">&#123;i%<span class="number">256</span>:02x&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">return</span> strformat</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(g_b(<span class="string">&quot;2e941853742b47fa1e688cd567d1a403202502041817339cfda327f7a0e755&quot;</span>))</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">b6</span><br></pre></td></tr></table></figure>

<h3 id="Python还原fp-local参数"><a href="#Python还原fp-local参数" class="headerlink" title="Python还原fp_local参数"></a>Python还原fp_local参数</h3><p>结合上面分析的参数生成过程，整合生成fp_local参数</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">MiscHelperKt_a</span>(<span class="params">byte_data</span>):</span><br><span class="line">    buffer = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="comment"># separator = &quot;:&quot;</span></span><br><span class="line">    postfix = <span class="string">&quot;&quot;</span></span><br><span class="line">    i2 = -<span class="number">1</span></span><br><span class="line">    truncated = <span class="string">&quot;...&quot;</span></span><br><span class="line">    i3 = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> byte_data:</span><br><span class="line">        i3 +=<span class="number">1</span></span><br><span class="line">        <span class="comment"># if(i3&gt;1):</span></span><br><span class="line">        <span class="comment">#     buffer+=separator</span></span><br><span class="line">        <span class="keyword">if</span>(i2&gt;=<span class="number">0</span> <span class="keyword">and</span> i3&gt;i2):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        buffer+= <span class="string">f&quot;<span class="subst">&#123;(i &amp; <span class="number">0xff</span>):02x&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">if</span> (i2&gt;=<span class="number">0</span> <span class="keyword">and</span> i3&gt;i2):</span><br><span class="line">        buffer+=truncated</span><br><span class="line">    buffer+=postfix</span><br><span class="line">    <span class="keyword">return</span> buffer</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_buvid</span>():</span><br><span class="line">    uuid_data = <span class="built_in">str</span>(uuid.uuid4()).replace(<span class="string">&quot;-&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">    t2_12_22 = uuid_data[<span class="number">2</span>]+uuid_data[<span class="number">12</span>]+uuid_data[<span class="number">22</span>]</span><br><span class="line">    buvid = (<span class="string">&quot;XW&quot;</span>+t2_12_22+uuid_data).upper()</span><br><span class="line">    <span class="built_in">print</span>(buvid)</span><br><span class="line">    <span class="keyword">return</span> buvid</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5_call</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="comment"># 创建md5对象</span></span><br><span class="line">    md5 = hashlib.md5()</span><br><span class="line">    <span class="comment"># 更新要加密的数据，参数要是字节类型</span></span><br><span class="line">    md5.update(data.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">	<span class="comment"># 获取加密后的数据，以字节码表示</span></span><br><span class="line">    md5_byte = md5.digest()</span><br><span class="line">    <span class="keyword">return</span> md5_byte</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">e</span>(<span class="params">buvid</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(buvid))</span><br><span class="line">    model = <span class="string">&quot;Pixel 3&quot;</span></span><br><span class="line">    band = <span class="string">&quot;g845-00023-180815-B-4956430&quot;</span></span><br><span class="line">    data = buvid+model+band</span><br><span class="line">    <span class="keyword">return</span> md5_call(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">h</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(<span class="number">20250203232823</span>+random.randint(<span class="number">1</span>,<span class="number">100</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g</span>():</span><br><span class="line">    <span class="keyword">return</span> random.randbytes(<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">b</span>(<span class="params"><span class="built_in">str</span></span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>)</span><br><span class="line">    g = <span class="number">0</span></span><br><span class="line">    h = <span class="number">60</span></span><br><span class="line">    i2 = <span class="number">2</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">True</span>):</span><br><span class="line">        substring = <span class="built_in">str</span>[g:g+<span class="number">2</span>]</span><br><span class="line">        a2 = <span class="number">16</span></span><br><span class="line">        i += <span class="built_in">int</span>(substring,a2)</span><br><span class="line">        <span class="keyword">if</span> (g == h):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        g+=i2</span><br><span class="line">    strformat = <span class="string">f&quot;<span class="subst">&#123;i%<span class="number">256</span>:02x&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">return</span> strformat</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_d2</span>():</span><br><span class="line">    <span class="built_in">str</span> = MiscHelperKt_a(e(g_buvid()))+h()+MiscHelperKt_a(g())</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>+b(<span class="built_in">str</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(g_d2())</span><br></pre></td></tr></table></figure>

<h2 id="fp-remote参数还原"><a href="#fp-remote参数还原" class="headerlink" title="fp_remote参数还原"></a>fp_remote参数还原</h2><p>hook生成<code>fp_local</code>和<code>fp_remote</code>的两个方法，发现他们的值相似</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_fp</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> a = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.bilibili.api.a&quot;</span>);</span><br><span class="line">        a[<span class="string">&quot;j&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`a.j is called`</span>);</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;j&quot;</span>]();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`a.j result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        a[<span class="string">&quot;k&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`a.k is called`</span>);</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;k&quot;</span>]();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`a.k result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">hook_fp</span>()</span><br></pre></td></tr></table></figure>

<p><strong>hook 结果</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a.j is called</span><br><span class="line">a.j result=2e941853742b47fa1e688cd567d1a40320250204210435027583fd9976406624</span><br><span class="line">a.k is called</span><br><span class="line">a.k result=2e941853742b47fa1e688cd567d1a4032024123013422042cd4fe24a164fc683</span><br></pre></td></tr></table></figure>

<p>暂时使用生成fp_local的方法来生成fp_remote</p>
<h2 id="整合代码"><a href="#整合代码" class="headerlink" title="整合代码"></a>整合代码</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> unpad</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_buvid</span>():</span><br><span class="line">    uuid_data = <span class="built_in">str</span>(uuid.uuid4()).replace(<span class="string">&quot;-&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">    t2_12_22 = uuid_data[<span class="number">2</span>]+uuid_data[<span class="number">12</span>]+uuid_data[<span class="number">22</span>]</span><br><span class="line">    buvid = (<span class="string">&quot;XW&quot;</span>+t2_12_22+uuid_data).upper()</span><br><span class="line">    <span class="built_in">print</span>(buvid)</span><br><span class="line">    <span class="keyword">return</span> buvid</span><br><span class="line"></span><br><span class="line">buvid = g_buvid()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_session_id</span>():</span><br><span class="line">    <span class="comment"># return random.randbytes(4).hex()</span></span><br><span class="line">    <span class="keyword">return</span> random.randbytes(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">session_id = g_session_id()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">MiscHelperKt_a</span>(<span class="params">byte_data</span>):</span><br><span class="line">    buffer = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="comment"># separator = &quot;:&quot;</span></span><br><span class="line">    postfix = <span class="string">&quot;&quot;</span></span><br><span class="line">    i2 = -<span class="number">1</span></span><br><span class="line">    truncated = <span class="string">&quot;...&quot;</span></span><br><span class="line">    i3 = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> byte_data:</span><br><span class="line">        i3 +=<span class="number">1</span></span><br><span class="line">        <span class="comment"># if(i3&gt;1):</span></span><br><span class="line">        <span class="comment">#     buffer+=separator</span></span><br><span class="line">        <span class="keyword">if</span>(i2&gt;=<span class="number">0</span> <span class="keyword">and</span> i3&gt;i2):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        buffer+= <span class="string">f&quot;<span class="subst">&#123;(i &amp; <span class="number">0xff</span>):02x&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">if</span> (i2&gt;=<span class="number">0</span> <span class="keyword">and</span> i3&gt;i2):</span><br><span class="line">        buffer+=truncated</span><br><span class="line">    buffer+=postfix</span><br><span class="line">    <span class="keyword">return</span> buffer</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5_call</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="comment"># 创建md5对象</span></span><br><span class="line">    md5 = hashlib.md5()</span><br><span class="line">    <span class="comment"># 更新要加密的数据，参数要是字节类型</span></span><br><span class="line">    md5.update(data.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">	<span class="comment"># 获取加密后的数据，以字节码表示</span></span><br><span class="line">    md5_byte = md5.digest()</span><br><span class="line">    <span class="keyword">return</span> md5_byte</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">e</span>(<span class="params">buvid</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(buvid))</span><br><span class="line">    model = <span class="string">&quot;Pixel 3&quot;</span></span><br><span class="line">    band = <span class="string">&quot;g845-00023-180815-B-4956430&quot;</span></span><br><span class="line">    data = buvid+model+band</span><br><span class="line">    <span class="keyword">return</span> md5_call(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">h</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(<span class="number">20250203232823</span>+random.randint(<span class="number">1</span>,<span class="number">100</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g</span>():</span><br><span class="line">    <span class="keyword">return</span> random.randbytes(<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">b</span>(<span class="params"><span class="built_in">str</span></span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>)</span><br><span class="line">    g = <span class="number">0</span></span><br><span class="line">    h = <span class="number">60</span></span><br><span class="line">    i2 = <span class="number">2</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">True</span>):</span><br><span class="line">        substring = <span class="built_in">str</span>[g:g+<span class="number">2</span>]</span><br><span class="line">        a2 = <span class="number">16</span></span><br><span class="line">        i += <span class="built_in">int</span>(substring,a2)</span><br><span class="line">        <span class="keyword">if</span> (g == h):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        g+=i2</span><br><span class="line">    strformat = <span class="string">f&quot;<span class="subst">&#123;i%<span class="number">256</span>:02x&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">return</span> strformat</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_d2</span>(<span class="params">buvid</span>):</span><br><span class="line">    <span class="built_in">str</span> = MiscHelperKt_a(e(buvid))+h()+MiscHelperKt_a(g())</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>+b(<span class="built_in">str</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_fp_local</span>(<span class="params">buvid</span>):</span><br><span class="line">    <span class="keyword">return</span> g_d2(buvid)</span><br><span class="line"></span><br><span class="line">fp_local = g_fp_local(buvid)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(fp_local)</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://api.bilibili.com/x/report/click/android2&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line"><span class="comment">#   &quot;:authority&quot;: &quot;api.bilibili.com&quot;,</span></span><br><span class="line"><span class="comment">#   &quot;:method&quot;: &quot;POST&quot;,</span></span><br><span class="line"><span class="comment">#   &quot;:path&quot;: &quot;/x/report/click/android2&quot;,</span></span><br><span class="line"><span class="comment">#   &quot;:scheme&quot;: &quot;https&quot;,</span></span><br><span class="line">  <span class="string">&quot;content-length&quot;</span>: <span class="string">&quot;320&quot;</span>,</span><br><span class="line">  <span class="string">&quot;buvid&quot;</span>: <span class="string">&quot;XY17684138CCA764C73112F1B0464F485C112&quot;</span>,<span class="comment"># buvid,</span></span><br><span class="line">  <span class="string">&quot;device-id&quot;</span>: <span class="string">&quot;PF9tVWMHYgNiUTQGegZ6&quot;</span>,</span><br><span class="line">  <span class="string">&quot;fp_local&quot;</span>:  <span class="string">&quot;2e941853742b47fa1e688cd567d1a40320250204210435027583fd9976406624&quot;</span>, <span class="comment">#fp_local,</span></span><br><span class="line">  <span class="string">&quot;fp_remote&quot;</span>: <span class="string">&quot;2e941853742b47fa1e688cd567d1a4032024123013422042cd4fe24a164fc683&quot;</span>,</span><br><span class="line">  <span class="string">&quot;session_id&quot;</span>:  <span class="string">&quot;49efcb1f&quot;</span>, <span class="comment"># session_id, #</span></span><br><span class="line">  <span class="string">&quot;env&quot;</span>: <span class="string">&quot;prod&quot;</span>,</span><br><span class="line">  <span class="string">&quot;app-key&quot;</span>: <span class="string">&quot;android&quot;</span>,</span><br><span class="line">  <span class="string">&quot;user-agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 BiliDroid/6.24.0 (bbcallen@gmail.com) os/android model/Pixel 3 mobi_app/android build/6240300 channel/alifenfa innerVer/6240300 osVer/9 network/2&quot;</span>,</span><br><span class="line">  <span class="string">&quot;bili-bridge-engine&quot;</span>: <span class="string">&quot;cronet&quot;</span>,</span><br><span class="line">  <span class="string">&quot;content-type&quot;</span>: <span class="string">&quot;application/octet-stream&quot;</span>,</span><br><span class="line">  <span class="string">&quot;accept-encoding&quot;</span>: <span class="string">&quot;gzip, deflate, br&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">body_hex = <span class="string">&quot;DDB2205C8585FFD98B6681BD50CDDE7374C61B9C7EC72C8A7CCFF1BA613AA29731C109318B776408E264545723171BF9E8C857152EB6B26785B1FF0E839632D16ED7749C73C69AC0E8B4223F3DA7235A0C8B8E0737F44BF11487940E98A79494679F494D72E8DD8D75E0843E82EB966473AC272133CCBEDACCB5D0F7EA37152E915E678CCE2DB802A61BAB2032AE155691262E32B7C5AABC65CDF5072A0C0874E59D08DDCEB3C0056198873652763C77B9EBE3756A9360A8B183FE20E608D26FD02661A25C67DDB71068E250B52C1794B26B99A95BD88360842E7E1D20CA716897E681931BD7EAF9BC77B3745ED0F521108D2D11A185140523062BDF7B7256462D44EBF2501945A7091FE66F8F1A7E95FD1008ACCC94649442EA232273F15B063647F993D7C40EFDCB2450683BC508A4AAA390283300874C5ADE14B338D1EEAB&quot;</span></span><br><span class="line"><span class="comment"># print(list(bytes.fromhex(body)))</span></span><br><span class="line">body = <span class="built_in">bytes</span>.fromhex(body_hex)</span><br><span class="line"><span class="built_in">print</span>(body)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_decrypt</span>(<span class="params">ciphertext_hex, key, iv</span>):</span><br><span class="line">    <span class="comment"># 将hex编码的密文转换为bytes</span></span><br><span class="line">    ciphertext = <span class="built_in">bytes</span>.fromhex(ciphertext_hex)</span><br><span class="line">    <span class="comment"># 创建AES解密对象</span></span><br><span class="line">    cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    <span class="comment"># 解密并移除填充</span></span><br><span class="line">    plaintext = unpad(cipher.decrypt(ciphertext), AES.block_size)</span><br><span class="line">    <span class="keyword">return</span> plaintext.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例数据</span></span><br><span class="line">key = <span class="string">b&#x27;fd6b639dbcff0c2a1b03b389ec763c4b&#x27;</span>  <span class="comment"># 16字节密钥</span></span><br><span class="line">iv = <span class="string">b&#x27;77b07a672d57d64c&#x27;</span>   <span class="comment"># 16字节IV</span></span><br><span class="line">ciphertext_hex = body_hex</span><br><span class="line"><span class="comment"># &#x27;b2eadf0bc65f99660f2ffbe874d802918231b6f0445bbf1c005253f1b42c251a61835063707effd59fc5800b4377d4241b252ec063dd6ca55f66a738ce7d5de3d5ef17d04714e17e0d3b592e18109e4e4d8d534666159c204dd8c31ec68c92355f57ce3798454155d57b360d9855dc4d8b131dcb9befebe638635b103d40b0f66d33c283c6dd28b49d38e724f7f7abcb7ba16a7a150941bd301275e326c56e89e97210c18b36437fa4d6fde0f7911cbb7b2e80e56051a9f9f7e238ca20da5dbd6481362a85afceb73e55816d6ff8d7f740a5d8c8e3a0c6779ba406f400cb34936c6e1d3534bf0ed2eee6ce743fcf0ce8fd8ac478980f3dc6f1aac8de96e2be031e1e5f7a32bf06ec73840f4632728a576c9d2f4fa6fc76141e961920885e1d57b3a5e4f77a88d285f6eea2398d97a949e9577bba57665c84a5f85a102e07921e&#x27;</span></span><br><span class="line"><span class="comment"># 解密</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    plaintext = aes_decrypt(ciphertext_hex, key, iv)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;解密后的明文:&quot;</span>, plaintext)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;解密失败:&quot;</span>, e)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">response = requests.post(url,headers=headers,data=body)</span><br><span class="line"><span class="built_in">print</span>(response.status_code)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br><span class="line"><span class="built_in">print</span>(response.content)</span><br></pre></td></tr></table></figure>

<h1 id="播放量接口抓包分析"><a href="#播放量接口抓包分析" class="headerlink" title="播放量接口抓包分析"></a>播放量接口抓包分析</h1><p>在app里播放量请求要发送两次，一次是在视频开始的时候发送，一次是在视频结束的时候发送</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">url:https://api.bilibili.com/x/report/heartbeat/mobile</span><br><span class="line">请求方式：POST</span><br><span class="line">请求头：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;:authority&quot;: &quot;api.bilibili.com&quot;,</span><br><span class="line">  &quot;:method&quot;: &quot;POST&quot;,</span><br><span class="line">  &quot;:path&quot;: &quot;/x/report/heartbeat/mobile&quot;,</span><br><span class="line">  &quot;:scheme&quot;: &quot;https&quot;,</span><br><span class="line">  &quot;content-length&quot;: &quot;752&quot;,</span><br><span class="line">  &quot;buvid&quot;: &quot;XY17684138CCA764C73112F1B0464F485C112&quot;,</span><br><span class="line">  &quot;device-id&quot;: &quot;PF9tVWMHYgNiUTQGegZ6&quot;,</span><br><span class="line">  &quot;fp_local&quot;: &quot;2e941853742b47fa1e688cd567d1a40320250204210435027583fd9976406624&quot;,</span><br><span class="line">  &quot;fp_remote&quot;: &quot;2e941853742b47fa1e688cd567d1a4032024123013422042cd4fe24a164fc683&quot;,</span><br><span class="line">  &quot;session_id&quot;: &quot;a858237d&quot;,</span><br><span class="line">  &quot;env&quot;: &quot;prod&quot;,</span><br><span class="line">  &quot;app-key&quot;: &quot;android&quot;,</span><br><span class="line">  &quot;user-agent&quot;: &quot;Mozilla/5.0 BiliDroid/6.24.0 (bbcallen@gmail.com) os/android model/Pixel 3 mobi_app/android build/6240300 channel/alifenfa innerVer/6240300 osVer/9 network/2&quot;,</span><br><span class="line">  &quot;bili-bridge-engine&quot;: &quot;cronet&quot;,</span><br><span class="line">  &quot;content-type&quot;: &quot;application/x-www-form-urlencoded; charset=utf-8&quot;,</span><br><span class="line">  &quot;accept-encoding&quot;: &quot;gzip, deflate, br&quot;</span><br><span class="line">&#125;</span><br><span class="line">请求体：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;actual_played_time&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;aid&quot;: &quot;113870689534703&quot;,</span><br><span class="line">  &quot;appkey&quot;: &quot;1d8b6e7d45233436&quot;, # 设备ID，可自己生成</span><br><span class="line">  &quot;auto_play&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;build&quot;: &quot;6240300&quot;,</span><br><span class="line">  &quot;c_locale&quot;: &quot;zh-Hans_CN&quot;,</span><br><span class="line">  &quot;channel&quot;: &quot;alifenfa&quot;,</span><br><span class="line">  &quot;cid&quot;: &quot;28010612956&quot;,</span><br><span class="line">  &quot;epid&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;epid_status&quot;: &quot;&quot;,</span><br><span class="line">  &quot;from&quot;: &quot;7&quot;,</span><br><span class="line">  &quot;from_spmid&quot;: &quot;tm.recommend.0.0&quot;,</span><br><span class="line">  &quot;last_play_progress_time&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;list_play_time&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;max_play_progress_time&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;mid&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;miniplayer_play_time&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;mobi_app&quot;: &quot;android&quot;,</span><br><span class="line">  &quot;network_type&quot;: &quot;1&quot;,</span><br><span class="line">  &quot;paused_time&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;platform&quot;: &quot;android&quot;,</span><br><span class="line">  &quot;play_status&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;play_type&quot;: &quot;1&quot;,</span><br><span class="line">  &quot;played_time&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;quality&quot;: &quot;32&quot;,</span><br><span class="line">  &quot;s_locale&quot;: &quot;zh-Hans_CN&quot;,</span><br><span class="line">  &quot;session&quot;: &quot;6935c68dd72b2363eea3e661be4f85c119a40538&quot;,</span><br><span class="line">  &quot;sid&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;spmid&quot;: &quot;main.ugc-video-detail.0.0&quot;,</span><br><span class="line">  &quot;start_ts&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;statistics&quot;: &quot;&#123;\&quot;appId\&quot;:1,\&quot;platform\&quot;:3,\&quot;version\&quot;:\&quot;6.24.0\&quot;,\&quot;abtest\&quot;:\&quot;\&quot;&#125;&quot;,</span><br><span class="line">  &quot;sub_type&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;total_time&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;ts&quot;: &quot;1738736854&quot;,</span><br><span class="line">  &quot;type&quot;: &quot;3&quot;,</span><br><span class="line">  &quot;user_status&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;video_duration&quot;: &quot;120&quot;,</span><br><span class="line">  &quot;sign&quot;: &quot;e5834de364c3f2863314293077d0c540&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>请求头参数已经分析过了</p>
<p>下面只需要看请求体参数</p>
<p>需要分析的参数有<code>session</code>、<code>sign</code></p>
<h2 id="session参数分析还原"><a href="#session参数分析还原" class="headerlink" title="session参数分析还原"></a>session参数分析还原</h2><p>jadx反编译apk搜索<code>report/heartbeat/mobile</code>，双击跳转到接口</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/68.jpg" alt="1"></p>
<p>找到<code>reportV2</code>查找用例，找到如下两个进行分析</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/69.jpg" alt="1"></p>
<p><code>reportV2()</code>方法转入了一个参数N7，然后去找N7是如何生成的</p>
<h3 id="N7"><a href="#N7" class="headerlink" title="N7()"></a>N7()</h3><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/70.jpg" alt="1"></p>
<p>N7参数通过调用<code>N7()</code>方法返回，如下是<code>N7()</code>源码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> HeartbeatParams <span class="title function_">N7</span><span class="params">(h hVar, <span class="type">boolean</span> z)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HeartbeatParams</span>(hVar.p1(), hVar.r1(), hVar.a1(), hVar.H0(), hVar.J0(), hVar.s1(), hVar.M0(), hVar.C1(), hVar.w1(), hVar.o1(), z ? <span class="number">0L</span> : hVar.B1(), z ? <span class="number">0L</span> : hVar.e1(), z ? <span class="number">0L</span> : hVar.k1(), hVar.E1(), hVar.i1(), hVar.c1(), z ? <span class="number">0L</span> : hVar.V0(), z ? <span class="number">0L</span> : hVar.Y0(), hVar.S0(), hVar.N0(), hVar.t1(), hVar.L0(), hVar.f1(), hVar.D1(), z ? <span class="number">0L</span> : hVar.G0(), hVar.I0(), z ? <span class="number">0L</span> : hVar.W0(), z ? <span class="number">0L</span> : hVar.b1());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>它返回的是<code>new HeartbeatParams()</code>，然后去看<code>HeartbeatParams</code>的构造方法，它里面的参数就是请求体参数</p>
<h3 id="HeartbeatParams"><a href="#HeartbeatParams" class="headerlink" title="HeartbeatParams()"></a>HeartbeatParams()</h3><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/71.jpg" alt="1"></p>
<p>传给session的参数是str，接下来去找str是如何初始化的</p>
<p>回到N7方法找它的第二个参数</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/72.jpg" alt="1"></p>
<p>第二个参数是通过<code>hVar.r1()</code>方法返回的</p>
<h3 id="r1"><a href="#r1" class="headerlink" title="r1()"></a>r1()</h3><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/73.jpg" alt="1"></p>
<p><code>r1()</code>方法返回的是<code>this.d</code>，找谁给<code>this.d</code>赋值，如下，通过<code>t2()</code>方法传进去的参数<code>str</code>给<code>this.d</code>赋值</p>
<h3 id="t2"><a href="#t2" class="headerlink" title="t2()"></a>t2()</h3><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/74.jpg" alt="1"></p>
<p>对<code>t2()</code>查找用例，找到一个<code>b()</code>方法，它里面的参数是<code>g.a.a()</code>的返回值</p>
<h3 id="b-2"><a href="#b-2" class="headerlink" title="b()"></a>b()</h3><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/75.jpg" alt="1"></p>
<p>查看<code>g.a.a()</code>，如下</p>
<h3 id="a-3"><a href="#a-3" class="headerlink" title="a()"></a>a()</h3><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/76.jpg" alt="1"></p>
<p>这里面new了一个<code>StringBuilder</code>，然后拼接<code>E.t()</code>、系统时间戳和一个1000000内的随机整数，然后对拼接的字符串进行<code>SHA1</code>哈希算法</p>
<p>首先看<code>E.t()</code>，它获取的是<code>buvid</code></p>
<h3 id="t"><a href="#t" class="headerlink" title="t()"></a>t()</h3><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/77.jpg" alt="1"></p>
<p><strong>python生成sb2</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_buvid</span>():</span><br><span class="line">    uuid_data = <span class="built_in">str</span>(uuid.uuid4()).replace(<span class="string">&quot;-&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">    t2_12_22 = uuid_data[<span class="number">2</span>]+uuid_data[<span class="number">12</span>]+uuid_data[<span class="number">22</span>]</span><br><span class="line">    buvid = (<span class="string">&quot;XW&quot;</span>+t2_12_22+uuid_data).upper()</span><br><span class="line">    <span class="keyword">return</span> buvid</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_time_mills</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(<span class="built_in">int</span>(time.time()*<span class="number">1000</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_randint</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(random.randint(<span class="number">0</span>,<span class="number">1000000</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_sb2</span>():</span><br><span class="line">    <span class="keyword">return</span> g_buvid()+g_time_mills()+g_randint()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(g_sb2())</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="comment"># 示例输出：XWB4602B50BA2B05246E08EFC046FC23DB8791738743742069992167</span></span><br></pre></td></tr></table></figure>

<p>生成的参数<code>sb2</code>方法传递给了<code>com.bilibili.commons.m.a.i(sb2)</code></p>
<p>查看<code>i()</code>方法</p>
<h3 id="i-1"><a href="#i-1" class="headerlink" title="i()"></a>i()</h3><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/78.jpg" alt="1"></p>
<p>在<code>i()</code>方法里调用了<code>j()</code>方法</p>
<p>查看<code>j()</code>方法</p>
<h3 id="j-1"><a href="#j-1" class="headerlink" title="j()"></a>j()</h3><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/79.jpg" alt="1"></p>
<p>在<code>j()</code>方法里把参数和<code>SHA1</code>对象传递给了<code>h()</code>方法</p>
<p>查看<code>h()</code>方法</p>
<h3 id="h-2"><a href="#h-2" class="headerlink" title="h()"></a>h()</h3><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/80.jpg" alt="1"></p>
<p>这里面对传入的参数进行了<code>SHA1</code>哈希算法</p>
<p>接下来通过hook i()方法来验证这里<code>h()</code>里面是不是标准的<code>SHA1()</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_i</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> m_a = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.bilibili.commons.m.a&quot;</span>);</span><br><span class="line">        m_a[<span class="string">&quot;i&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">str</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`a.i is called: str=<span class="subst">$&#123;str&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;i&quot;</span>](str);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`a.i result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">hook_i</span>()</span><br></pre></td></tr></table></figure>

<p><strong>hook 结果</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a.i is called: str=1738746513112310995</span><br><span class="line">a.i result=ea3ce10248acdfe7ec65d4f6a2791df6465d0261</span><br></pre></td></tr></table></figure>

<p>如下证明<code>h()</code>方法是标准版的<code>SHA1</code>算法</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/81.jpg" alt="1"></p>
<h3 id="Python还原session参数"><a href="#Python还原session参数" class="headerlink" title="Python还原session参数"></a>Python还原session参数</h3><p>整合上面的代码</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_buvid</span>():</span><br><span class="line">    uuid_data = <span class="built_in">str</span>(uuid.uuid4()).replace(<span class="string">&quot;-&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">    t2_12_22 = uuid_data[<span class="number">2</span>]+uuid_data[<span class="number">12</span>]+uuid_data[<span class="number">22</span>]</span><br><span class="line">    buvid = (<span class="string">&quot;XW&quot;</span>+t2_12_22+uuid_data).upper()</span><br><span class="line">    <span class="keyword">return</span> buvid</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_time_mills</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(<span class="built_in">int</span>(time.time()*<span class="number">1000</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_randint</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(random.randint(<span class="number">0</span>,<span class="number">1000000</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_sb2</span>():</span><br><span class="line">    <span class="keyword">return</span> g_buvid()+g_time_mills()+g_randint()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SHA1_call</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="comment"># 创建sha1对象</span></span><br><span class="line">    sha1 = hashlib.sha1()</span><br><span class="line">    sha1.update(data.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">    <span class="comment"># 获取加密后的数据，以16进制表示</span></span><br><span class="line">    sha1_hex = sha1.hexdigest()</span><br><span class="line">    <span class="keyword">return</span> sha1_hex</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取加密后的数据，以字节码表示</span></span><br><span class="line">    <span class="comment"># sha1_bytes = sha1.digest()</span></span><br><span class="line">    <span class="comment"># return sha1_bytes</span></span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(SHA1_call(g_sb2()))</span><br></pre></td></tr></table></figure>

<h2 id="sign参数分析还原"><a href="#sign参数分析还原" class="headerlink" title="sign参数分析还原"></a>sign参数分析还原</h2><p>首先像找<code>session</code>参数一样在源码中找是没有找到的，可能是根据已有的参数进行加密后拼接到原来的参数后面的。</p>
<p>分析<code>sign</code>的值，其长度是16字节，猜测其是MD5加密生成的，把请求体中除了<code>sign</code>值的其他参数拼接起来进行MD5哈希算法，发现结果不一致，可能有加盐。换思路分析。</p>
<p>猜测：可能在拦截器中进行的加密，也可能在so文件中进行的加密。同时在拼接<code>sign</code>参数的时候有很大可能会出现<code>&amp;sign=</code>字样。</p>
<h3 id="在jadx里搜索查找-sign"><a href="#在jadx里搜索查找-sign" class="headerlink" title="在jadx里搜索查找&amp;sign="></a>在jadx里搜索查找<code>&amp;sign=</code></h3><p>经过测试验证得到生成sign值的类为如下类</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/82.jpg" alt="1"></p>
<p>双击进去到了<code>toString()</code>方法里</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/83.jpg" alt="1"></p>
<p><strong>hook toString()</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_toString</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="title class_">SignedQuery</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.bilibili.nativelibrary.SignedQuery&quot;</span>);</span><br><span class="line">        <span class="title class_">SignedQuery</span>[<span class="string">&quot;toString&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`SignedQuery.toString is called`</span>);</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;toString&quot;</span>]();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`SignedQuery.toString result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">            <span class="title function_">showStacks</span>()</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">hook_toString</span>()</span><br></pre></td></tr></table></figure>

<p>hook 结果</p>
<p>根据参数找到对应的hook结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SignedQuery.toString is called</span><br><span class="line">SignedQuery.toString result=</span><br><span class="line">actual_played_time=0&amp;aid=113825760153422&amp;appkey=1d8b6e7d45233436&amp;auto_play=0&amp;build=6240300&amp;c_locale=zh-Hans_CN&amp;channel=alifenfa&amp;cid=27862828315&amp;epid=0&amp;epid_status=&amp;from=7&amp;from_spmid=tm.recommend.0.0&amp;last_play_progress_time=0&amp;list_play_time=0&amp;max_play_progress_time=0&amp;mid=0&amp;miniplayer_play_time=0&amp;mobi_app=android&amp;network_type=1&amp;paused_time=0&amp;platform=android&amp;play_status=0&amp;play_type=1&amp;played_time=0&amp;quality=32&amp;s_locale=zh-Hans_CN&amp;session=b027341a1332c43ad68e4072d38d59a2da7a1a88&amp;sid=0&amp;spmid=main.ugc-video-detail.0.0&amp;start_ts=0&amp;statistics=%7B%22appId%22%3A1%2C%22platform%22%3A3%2C%22version%22%3A%226.24.0%22%2C%22abtest%22%3A%22%22%7D&amp;sub_type=0&amp;total_time=0&amp;ts=1738756372&amp;type=3&amp;user_status=0&amp;video_duration=79&amp;sign=cdc782cf0541724bd87ab0c15950fc0d</span><br><span class="line"></span><br><span class="line">java.lang.Throwable</span><br><span class="line">        at com.bilibili.nativelibrary.SignedQuery.toString(Native Method)</span><br><span class="line">        at com.bilibili.okretro.f.a.c(BL:16)</span><br><span class="line">        at com.bilibili.okretro.f.a.a(BL:6)</span><br><span class="line">        at com.bilibili.okretro.d.a.execute(BL:24)</span><br><span class="line">        at com.bilibili.okretro.d.a$a.run(BL:2)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:641)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:764)</span><br></pre></td></tr></table></figure>

<p>通过调用堆栈找到上一层函数<code>com.bilibili.okretro.f.a.c</code></p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/84.jpg" alt="1"></p>
<p>这里看到在<code>h(hashMap)</code>里传入了一个参数<code>hashMap</code>，通过hook打印<code>hashMap</code>的值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">printMap</span>(<span class="params">map</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> key = map.<span class="title function_">keySet</span>();</span><br><span class="line">    <span class="keyword">let</span> it = key.<span class="title function_">iterator</span>();</span><br><span class="line">    <span class="keyword">while</span>(it.<span class="title function_">hasNext</span>())&#123;</span><br><span class="line">        <span class="keyword">let</span> keystr = it.<span class="title function_">next</span>();</span><br><span class="line">        <span class="keyword">let</span> valuestr = map.<span class="title function_">get</span>(keystr);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;key:&quot;</span>,keystr,<span class="string">&quot;| value:&quot;</span>,valuestr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hook_h</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> a = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.bilibili.okretro.f.a&quot;</span>);</span><br><span class="line">        a[<span class="string">&quot;h&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">map</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`a.h is called: map=<span class="subst">$&#123;map&#125;</span>`</span>);</span><br><span class="line">            <span class="title function_">printMap</span>(map)</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;h&quot;</span>](map);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`a.h result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">hook_h</span>()</span><br></pre></td></tr></table></figure>

<p>hook 结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">key: platform | value: android</span><br><span class="line">key: sid | value: 0</span><br><span class="line">key: sub_type | value: 0</span><br><span class="line">key: from | value: 7</span><br><span class="line">key: total_time | value: 24</span><br><span class="line">key: max_play_progress_time | value: 23</span><br><span class="line">key: user_status | value: 0</span><br><span class="line">key: played_time | value: 23</span><br><span class="line">key: mobi_app | value: android</span><br><span class="line">key: epid | value: 0</span><br><span class="line">key: epid_status | value:</span><br><span class="line">key: c_locale | value: zh-Hans_CN</span><br><span class="line">key: actual_played_time | value: 23</span><br><span class="line">key: quality | value: 32</span><br><span class="line">key: last_play_progress_time | value: 23</span><br><span class="line">key: play_type | value: 1</span><br><span class="line">key: miniplayer_play_time | value: 0</span><br><span class="line">key: build | value: 6240300</span><br><span class="line">key: appkey | value: 1d8b6e7d45233436</span><br><span class="line">key: network_type | value: 1</span><br><span class="line">key: aid | value: 113838208844297</span><br><span class="line">key: from_spmid | value: tm.recommend.0.0</span><br><span class="line">key: play_status | value: 0</span><br><span class="line">key: cid | value: 27904771672</span><br><span class="line">key: statistics | value: &#123;&quot;appId&quot;:1,&quot;platform&quot;:3,&quot;version&quot;:&quot;6.24.0&quot;,&quot;abtest&quot;:&quot;&quot;&#125;</span><br><span class="line">a.h result=actual_played_time=23&amp;aid=113838208844297&amp;appkey=1d8b6e7d45233436&amp;auto_play=0&amp;build=6240300&amp;c_locale=zh-Hans_CN&amp;channel=alifenfa&amp;cid=27904771672&amp;epid=0&amp;epid_status=&amp;from=7&amp;from_spmid=tm.recommend.0.0&amp;last_play_progress_time=23&amp;list_play_time=0&amp;max_play_progress_time=23&amp;mid=0&amp;miniplayer_play_time=0&amp;mobi_app=android&amp;network_type=1&amp;paused_time=1&amp;platform=android&amp;play_status=0&amp;play_type=1&amp;played_time=23&amp;quality=32&amp;s_locale=zh-Hans_CN&amp;session=2a130cffe590492932d849d889e360e7246dc256&amp;sid=0&amp;spmid=main.ugc-video-detail.0.0&amp;start_ts=0&amp;statistics=%7B%22appId%22%3A1%2C%22platform%22%3A3%2C%22version%22%3A%226.24.0%22%2C%22abtest%22%3A%22%22%7D&amp;sub_type=0&amp;total_time=24&amp;ts=1738759385&amp;type=3&amp;user_status=0&amp;video_duration=249&amp;sign=5c3cfa0aa7c7d171e1821669a6b55e7e</span><br></pre></td></tr></table></figure>

<p>加密过程应该就在<code>h()</code>方法里</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/85.jpg" alt="1"></p>
<p>在<code>h()</code>方法里调用了<code>g()</code>方法</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/86.jpg" alt="1"></p>
<p>在<code>g()</code>方法里调用了<code>s()</code>方法</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/87.jpg" alt="1"></p>
<p><code>s()</code>方法是一个<code>native方法</code></p>
<h4 id="hook-s"><a href="#hook-s" class="headerlink" title="hook s"></a>hook s</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_s</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="title class_">LibBili</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.bilibili.nativelibrary.LibBili&quot;</span>);</span><br><span class="line">        <span class="title class_">LibBili</span>[<span class="string">&quot;s&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">sortedMap</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`LibBili.s is called: sortedMap=<span class="subst">$&#123;sortedMap&#125;</span>`</span>);</span><br><span class="line">            <span class="title function_">printMap</span>(sortedMap)</span><br><span class="line">            <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;s&quot;</span>](sortedMap);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`LibBili.s result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">hook_s</span>()</span><br></pre></td></tr></table></figure>

<p><strong>hook 结果</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LibBili.s is called: sortedMap=[object Object]</span><br><span class="line">map: &#123;actual_played_time=1, aid=113945784358610, appkey=1d8b6e7d45233436, auto_play=0, build=6240300, c_locale=zh-Hans_CN, channel=alifenfa, cid=28214757335, epid=0, epid_status=, from=7, from_spmid=tm.recommend.0.0, last_play_progress_time=1, list_play_time=0, max_play_progress_time=1, mid=0, miniplayer_play_time=0, mobi_app=android, network_type=1, paused_time=2, platform=android, play_status=0, play_type=1, played_time=1, quality=32, s_locale=zh-Hans_CN, session=22b3446fdb1b406d22b87ba3d09bbeb0bb170e21, sid=0, spmid=main.ugc-video-detail.0.0, start_ts=1738823412, statistics=&#123;&quot;appId&quot;:1,&quot;platform&quot;:3,&quot;version&quot;:&quot;6.24.0&quot;,&quot;abtest&quot;:&quot;&quot;&#125;, sub_type=0, total_time=3, type=3, user_status=0, video_duration=284&#125;</span><br><span class="line">LibBili.s result=</span><br><span class="line">actual_played_time=1&amp;aid=113945784358610&amp;appkey=1d8b6e7d45233436&amp;auto_play=0&amp;build=6240300&amp;c_locale=zh-Hans_CN&amp;channel=alifenfa&amp;cid=28214757335&amp;epid=0&amp;epid_status=&amp;from=7&amp;from_spmid=tm.recommend.0.0&amp;last_play_progress_time=1&amp;list_play_time=0&amp;max_play_progress_time=1&amp;mid=0&amp;miniplayer_play_time=0&amp;mobi_app=android&amp;network_type=1&amp;paused_time=2&amp;platform=android&amp;play_status=0&amp;play_type=1&amp;played_time=1&amp;quality=32&amp;s_locale=zh-Hans_CN&amp;session=22b3446fdb1b406d22b87ba3d09bbeb0bb170e21&amp;sid=0&amp;spmid=main.ugc-video-detail.0.0&amp;start_ts=1738823412&amp;statistics=%7B%22appId%22%3A1%2C%22platform%22%3A3%2C%22version%22%3A%226.24.0%22%2C%22abtest%22%3A%22%22%7D&amp;sub_type=0&amp;total_time=3&amp;ts=1738823572&amp;type=3&amp;user_status=0&amp;video_duration=284&amp;sign=8c0eaba9d3108d2049b4d46777662214</span><br></pre></td></tr></table></figure>

<p>so的名字是</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/88.jpg" alt="1"></p>
<h3 id="通过hook-NewStringUTF定位"><a href="#通过hook-NewStringUTF定位" class="headerlink" title="通过hook_NewStringUTF定位"></a>通过hook_NewStringUTF定位</h3><p>如果<code>sign</code>是在so中加密的，那么在返回字符串的时候一定会调用<code>newStringUTF</code>方法返回字符串</p>
<p>可以通过hook_NewStringUTF来打印相关信息</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_NewStringUTF</span>(<span class="params"></span>)&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> symbols = <span class="title class_">Module</span>.<span class="title function_">enumerateSymbolsSync</span>(<span class="string">&quot;libart.so&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> addrNewStringUTF = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;symbols.<span class="property">length</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">let</span> symbol = symbols[i];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(symbol.<span class="property">name</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;NewStringUTF&quot;</span>)!=-<span class="number">1</span> &amp;&amp; symbol.<span class="property">name</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;CheckJNI&quot;</span>)==-<span class="number">1</span>)&#123;</span><br><span class="line"></span><br><span class="line">            addrNewStringUTF = symbol.<span class="property">address</span>;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;NewStringUTF&#x27;s addr:&quot;</span>,symbol.<span class="property">address</span>,<span class="string">&quot; name:&quot;</span>,symbol.<span class="property">name</span>);</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(addrNewStringUTF != <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(addrNewStringUTF,&#123;</span><br><span class="line">            <span class="attr">onEnter</span>:<span class="keyword">function</span>(<span class="params">args</span>)&#123;</span><br><span class="line">                <span class="keyword">var</span> c_string = args[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">var</span> dataString = c_string.<span class="title function_">readCString</span>();</span><br><span class="line">                <span class="keyword">if</span>(dataString)&#123;</span><br><span class="line">                    <span class="comment">// console.log(dataString)</span></span><br><span class="line">                    <span class="keyword">if</span>(dataString.<span class="property">length</span>===<span class="number">32</span>)&#123;</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;dataString:&quot;</span>,dataString);</span><br><span class="line">                        </span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Thread</span>.<span class="title function_">backtrace</span>(<span class="variable language_">this</span>.<span class="property">context</span>,<span class="title class_">Backtracer</span>.<span class="property">ACCURATE</span>).<span class="title function_">map</span>(<span class="title class_">DebugSymbol</span>.<span class="property">fromAddress</span>).<span class="title function_">join</span>(<span class="string">&#x27;\n&#x27;</span>)+<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.util.Log&quot;</span>).<span class="title function_">getStackTraceString</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.Throwable&quot;</span>).$new()));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onLeave</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在hook结果中找到相关信息，如下，根据抓包中得到的sign在hook结果中搜索</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">dataString: d7472d2094ecc6fb5796cedaa92a82a7</span><br><span class="line">dataString: d644c98adea1d82b959db7174774f5cd</span><br><span class="line">0xbe7691a5 libbili.so!0x31a5</span><br><span class="line">0xc84bd08b base.odex!0x43008b</span><br><span class="line"></span><br><span class="line">java.lang.Throwable</span><br><span class="line">        at com.bilibili.nativelibrary.LibBili.s(Native Method)</span><br><span class="line">        at com.bilibili.nativelibrary.LibBili.g(BL:1)</span><br><span class="line">        at com.bilibili.okretro.f.a.h(BL:1)</span><br><span class="line">        at com.bilibili.okretro.f.a.c(BL:14)</span><br><span class="line">        at com.bilibili.okretro.f.a.a(BL:6)</span><br><span class="line">        at com.bilibili.okretro.d.a.execute(BL:24)</span><br><span class="line">        at com.bilibili.okretro.d.a$a.run(BL:2)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:641)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:764)</span><br></pre></td></tr></table></figure>

<p>hook结果中显示了入参，so名字和函数地址</p>
<h2 id="so分析"><a href="#so分析" class="headerlink" title="so分析"></a>so分析</h2><p>用IDA打开so，在静态注册函数中没有找到<code>s()</code>函数</p>
<p>动态注册查找</p>
<h3 id="hook-registernatives"><a href="#hook-registernatives" class="headerlink" title="hook registernatives"></a>hook registernatives</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_RegisterNatives</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">RegisterNatives</span>_addr = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">var</span> symbols = <span class="title class_">Process</span>.<span class="title function_">findModuleByName</span>(<span class="string">&quot;libart.so&quot;</span>).<span class="title function_">enumerateSymbols</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; symbols.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> symbol = symbols[i].<span class="property">name</span>;</span><br><span class="line">        <span class="keyword">if</span> ((symbol.<span class="title function_">indexOf</span>(<span class="string">&quot;CheckJNI&quot;</span>) == -<span class="number">1</span>) &amp;&amp; (symbol.<span class="title function_">indexOf</span>(<span class="string">&quot;JNI&quot;</span>) &gt;= <span class="number">0</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (symbol.<span class="title function_">indexOf</span>(<span class="string">&quot;RegisterNatives&quot;</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="title class_">RegisterNatives</span>_addr = symbols[i].<span class="property">address</span>;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;RegisterNatives_addr: &quot;</span>, <span class="title class_">RegisterNatives</span>_addr);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(<span class="title class_">RegisterNatives</span>_addr, &#123;</span><br><span class="line">        <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> env = args[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">var</span> jclass = args[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">var</span> class_name = <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">tryGetEnv</span>().<span class="title function_">getClassName</span>(jclass);</span><br><span class="line">            <span class="keyword">var</span> methods_ptr = <span class="title function_">ptr</span>(args[<span class="number">2</span>]);</span><br><span class="line">            <span class="keyword">var</span> method_count = args[<span class="number">3</span>].<span class="title function_">toInt32</span>();</span><br><span class="line">            <span class="comment">// console.log(&quot;RegisterNatives method counts: &quot;, method_count);</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; method_count; i++) &#123;</span><br><span class="line">                <span class="keyword">var</span> name = methods_ptr.<span class="title function_">add</span>(i * <span class="title class_">Process</span>.<span class="property">pointerSize</span> * <span class="number">3</span>).<span class="title function_">readPointer</span>().<span class="title function_">readCString</span>();</span><br><span class="line">                <span class="keyword">var</span> sig = methods_ptr.<span class="title function_">add</span>(i * <span class="title class_">Process</span>.<span class="property">pointerSize</span> * <span class="number">3</span> + <span class="title class_">Process</span>.<span class="property">pointerSize</span>).<span class="title function_">readPointer</span>().<span class="title function_">readCString</span>();</span><br><span class="line">                <span class="keyword">var</span> fnPtr_ptr = methods_ptr.<span class="title function_">add</span>(i * <span class="title class_">Process</span>.<span class="property">pointerSize</span> * <span class="number">3</span> + <span class="title class_">Process</span>.<span class="property">pointerSize</span> * <span class="number">2</span>).<span class="title function_">readPointer</span>();</span><br><span class="line">                <span class="keyword">var</span> find_module = <span class="title class_">Process</span>.<span class="title function_">findModuleByAddress</span>(fnPtr_ptr);</span><br><span class="line">                <span class="keyword">if</span>(class_name.<span class="title function_">indexOf</span>(<span class="string">&quot;com.bilibili.nativelibrary.LibBili&quot;</span>)!=-<span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ClasssName: &quot;</span>, class_name, <span class="string">&quot;MethodName: &quot;</span>, name, <span class="string">&quot;Sig: &quot;</span>, sig, <span class="string">&quot;Function_addr: &quot;</span>, fnPtr_ptr, <span class="string">&quot;ModuleName: &quot;</span>, find_module.<span class="property">name</span>, <span class="string">&quot;Fun_Offset: &quot;</span>, <span class="title function_">ptr</span>(fnPtr_ptr).<span class="title function_">sub</span>(find_module.<span class="property">base</span>));</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">hook_RegisterNatives</span>()</span><br></pre></td></tr></table></figure>

<p>hook 结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ClasssName:  com.bilibili.nativelibrary.LibBili MethodName:  a Sig:  (Ljava/lang/String;)Ljava/lang/String; Function_addr:  0xbc4b3c7d ModuleName:  libbili.so Fun_Offset:  0x1c7d       </span><br><span class="line">ClasssName:  com.bilibili.nativelibrary.LibBili MethodName:  ao Sig:  (Ljava/lang/String;II)Ljava/lang/String; Function_addr:  0xbc4b3c83 ModuleName:  libbili.so Fun_Offset:  0x1c83    </span><br><span class="line">ClasssName:  com.bilibili.nativelibrary.LibBili MethodName:  b Sig:  (Ljava/lang/String;)Ljavax/crypto/spec/IvParameterSpec; Function_addr:  0xbc4b3c91 ModuleName:  libbili.so Fun_Offset:  0x1c91</span><br><span class="line">ClasssName:  com.bilibili.nativelibrary.LibBili MethodName:  s Sig:  (Ljava/util/SortedMap;)Lcom/bilibili/nativelibrary/SignedQuery; Function_addr:  0xbc4b3c97 ModuleName:  libbili.so Fun_Offset:  0x1c97</span><br><span class="line">ClasssName:  com.bilibili.nativelibrary.LibBili MethodName:  so Sig:  (Ljava/util/SortedMap;II)Lcom/bilibili/nativelibrary/SignedQuery; Function_addr:  0xbc4b3c9d ModuleName:  libbili.so Fun_Offset:  0x1c9d</span><br><span class="line">ClasssName:  com.bilibili.nativelibrary.LibBili MethodName:  so Sig:  (Ljava/util/SortedMap;[B)Lcom/bilibili/nativelibrary/SignedQuery; Function_addr:  0xbc4b3cab ModuleName:  libbili.so Fun_Offset:  0x1cab</span><br><span class="line">ClasssName:  com.bilibili.nativelibrary.LibBili MethodName:  getCpuCount Sig:  ()I Function_addr:  0xbc4b3cb3 ModuleName:  libbili.so Fun_Offset:  0x1cb3</span><br><span class="line">ClasssName:  com.bilibili.nativelibrary.LibBili MethodName:  getCpuId Sig:  ()I Function_addr:  0xbc4b3cb7 ModuleName:  libbili.so Fun_Offset:  0x1cb7</span><br></pre></td></tr></table></figure>

<p><code>s()</code>函数在偏移为<code>0x1c97</code>处</p>
<p>使用IDA跳转至该地址处进行分析</p>
<p>首先看<code>s()</code>方法的返回值，它返回的是一个对象，里面有两个参数是<code>v13</code>和<code>v14</code></p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/89.jpg" alt="1"></p>
<p>我们回过头去看jadx里的<code>s()</code>方法，它传入一个<code>sortedMap</code>参数，返回一个<code>SignedQuery</code>对象，返回<code>SignedQuery</code>对象需要调用<code>SignedQuery</code>类的构造方法</p>
<p>我们再去看<code>SignedQuery</code>类的构造方法</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/90.jpg" alt="1"></p>
<p>这里面传入了两个参数，从<code>toString()</code>方法里可以看到其中<code>this.b</code>就是<code>sign</code>值，也就是IDA里看到的返回值中的参数<code>v14</code></p>
<p>接下来找<code>v14</code>怎么生成的</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/91.jpg" alt="1"></p>
<p>这里的反编译代码不好读，剩下只能靠猜了</p>
<p>查看<code>sub_227C()</code>函数，这个函数进行的数据初始化，看到这四个值很熟悉，是MD5的初始化数据</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/92.jpg" alt="1"></p>
<p>在分析Java层的时候已经猜出来了它并不是标准的MD5，可能加盐了</p>
<p>那么<code>sub_22B0()</code>函数可能就是加盐的函数</p>
<p>尝试对它进行hook</p>
<h3 id="hook-22B0"><a href="#hook-22B0" class="headerlink" title="hook_22B0()"></a>hook_22B0()</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_22B0</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> function_addr = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&quot;libbili.so&quot;</span>).<span class="title function_">add</span>(<span class="number">0x22B0</span>+<span class="number">1</span>);</span><br><span class="line">    <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(function_addr,&#123;</span><br><span class="line">        <span class="attr">onEnter</span>:<span class="keyword">function</span>(<span class="params">args</span>)&#123;</span><br><span class="line">            <span class="comment">// console.log(&quot;arg0:&quot;,args[0].readCString())</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;arg1:&quot;</span>,args[<span class="number">1</span>].<span class="title function_">readCString</span>())</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;arg2:&quot;</span>,args[<span class="number">2</span>])</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onLeave</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;----over----&quot;</span>)</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">hook_22B0</span>()</span><br></pre></td></tr></table></figure>

<p>hook 结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">arg1: actual_played_time=1&amp;aid=113945784358610&amp;appkey=1d8b6e7d45233436&amp;auto_play=0&amp;build=6240300&amp;c_locale=zh-Hans_CN&amp;channel=alifenfa&amp;cid=28214757335&amp;epid=0&amp;epid_status=&amp;from=7&amp;from_spmid=tm.recommend.0.0&amp;last_play_progress_time=1&amp;list_play_time=0&amp;max_play_progress_time=1&amp;mid=0&amp;miniplayer_play_time=0&amp;mobi_app=android&amp;network_type=1&amp;paused_time=2&amp;platform=android&amp;play_status=0&amp;play_type=1&amp;played_time=1&amp;quality=32&amp;s_locale=zh-Hans_CN&amp;session=22b3446fdb1b406d22b87ba3d09bbeb0bb170e21&amp;sid=0&amp;spmid=main.ugc-video-detail.0.0&amp;start_ts=1738823412&amp;statistics=%7B%22appId%22%3A1%2C%22platform%22%3A3%2C%22version%22%3A%226.24.0%22%2C%22abtest%22%3A%22%22%7D&amp;sub_type=0&amp;total_time=3&amp;ts=1738823572&amp;type=3&amp;user_status=0&amp;video_duration=284</span><br><span class="line">arg2: 0x242</span><br><span class="line">----over----</span><br><span class="line">arg1: 560c52cc</span><br><span class="line">arg2: 0x8</span><br><span class="line">----over----</span><br><span class="line">arg1: d288fed0</span><br><span class="line">arg2: 0x8</span><br><span class="line">----over----</span><br><span class="line">arg1: 45859ed1</span><br><span class="line">arg2: 0x8</span><br><span class="line">----over----</span><br><span class="line">arg1: 8bffd973</span><br><span class="line">arg2: 0x8</span><br><span class="line">----over----</span><br><span class="line">arg1: �</span><br><span class="line">arg2: 0xa</span><br><span class="line">----over----</span><br><span class="line">arg1: p</span><br><span class="line">arg2: 0x8</span><br><span class="line">----over----</span><br></pre></td></tr></table></figure>

<h3 id="主动调用s-方法，并对so方法进行hook"><a href="#主动调用s-方法，并对so方法进行hook" class="headerlink" title="主动调用s()方法，并对so方法进行hook"></a>主动调用<code>s()</code>方法，并对so方法进行hook</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">call_s</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="title class_">LibBili</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.bilibili.nativelibrary.LibBili&quot;</span>).$new();</span><br><span class="line">        <span class="keyword">let</span> hashmap = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.util.HashMap&quot;</span>).$new();</span><br><span class="line">        hashmap.<span class="title function_">put</span>(<span class="string">&quot;actual_played_time&quot;</span>,<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        hashmap.<span class="title function_">put</span>(<span class="string">&quot;aid&quot;</span>,<span class="string">&quot;113945784358610&quot;</span>);</span><br><span class="line">        hashmap.<span class="title function_">put</span>(<span class="string">&quot;appkey&quot;</span>,<span class="string">&quot;1d8b6e7d45233436&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> treemap = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.util.TreeMap&quot;</span>).$new(hashmap);</span><br><span class="line">        <span class="keyword">let</span> signedquery = <span class="title class_">LibBili</span>.<span class="title function_">s</span>(treemap);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;signedquery:&quot;</span>,signedquery);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hook_22B0</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> function_addr = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&quot;libbili.so&quot;</span>).<span class="title function_">add</span>(<span class="number">0x22B0</span>+<span class="number">1</span>);</span><br><span class="line">    <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(function_addr,&#123;</span><br><span class="line">        <span class="attr">onEnter</span>:<span class="keyword">function</span>(<span class="params">args</span>)&#123;</span><br><span class="line">            <span class="comment">// console.log(&quot;arg0:&quot;,args[0].readCString())</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;arg1:&quot;</span>,args[<span class="number">1</span>].<span class="title function_">readCString</span>())</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;arg2:&quot;</span>,args[<span class="number">2</span>])</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onLeave</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;----over----&quot;</span>)</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">hook_22B0</span>()</span><br></pre></td></tr></table></figure>

<p>hook结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">call_s()</span><br><span class="line">LibBili.s is called: sortedMap=[object Object]</span><br><span class="line">map: &#123;actual_played_time=1, aid=113945784358610, appkey=1d8b6e7d45233436&#125;</span><br><span class="line">arg1: actual_played_time=1&amp;aid=113945784358610&amp;appkey=1d8b6e7d45233436&amp;ts=1738825391</span><br><span class="line">arg2: 0x4e</span><br><span class="line">----over----</span><br><span class="line">arg1: 560c52cc</span><br><span class="line">arg2: 0x8</span><br><span class="line">----over----</span><br><span class="line">arg1: d288fed0</span><br><span class="line">arg2: 0x8</span><br><span class="line">----over----</span><br><span class="line">arg1: 45859ed1</span><br><span class="line">arg2: 0x8</span><br><span class="line">----over----</span><br><span class="line">arg1: 8bffd973</span><br><span class="line">arg2: 0x8</span><br><span class="line">----over----</span><br><span class="line">arg1: �</span><br><span class="line">arg2: 0xa</span><br><span class="line">----over----</span><br><span class="line">arg1: p</span><br><span class="line">arg2: 0x8</span><br><span class="line">----over----</span><br><span class="line">LibBili.s result=actual_played_time=1&amp;aid=113945784358610&amp;appkey=1d8b6e7d45233436&amp;ts=1738825391&amp;sign=cd3eb3e0e90c07304828f1a2c9581d06</span><br><span class="line">signedquery: actual_played_time=1&amp;aid=113945784358610&amp;appkey=1d8b6e7d45233436&amp;ts=1738825391&amp;sign=cd3eb3e0e90c07304828f1a2c9581d06</span><br></pre></td></tr></table></figure>

<p><strong>分析</strong></p>
<p>在主动调用的时候，在so里面会拼接一个<code>ts</code>参数，当前时间戳，而且如果map长度太短不会生成sign</p>
<p>经过测试MD5加了四次盐，加的盐是<code>560c52cc</code>、<code>d288fed0</code>、<code>45859ed1</code>、<code>8bffd973</code></p>
<p>在<code>s()</code>方法里做的事情就是给map拼接<code>ts</code>参数，然后加盐，进行MD5哈希算法，如下</p>
<p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/93.jpg" alt="1"></p>
<h2 id="Python实现"><a href="#Python实现" class="headerlink" title="Python实现"></a>Python实现</h2><p>代码整合</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_buvid</span>():</span><br><span class="line">    uuid_data = <span class="built_in">str</span>(uuid.uuid4()).replace(<span class="string">&quot;-&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">    t2_12_22 = uuid_data[<span class="number">2</span>]+uuid_data[<span class="number">12</span>]+uuid_data[<span class="number">22</span>]</span><br><span class="line">    buvid = (<span class="string">&quot;XW&quot;</span>+t2_12_22+uuid_data).upper()</span><br><span class="line">    <span class="keyword">return</span> buvid</span><br><span class="line"></span><br><span class="line">buvid = g_buvid()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_time_mills</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(<span class="built_in">int</span>(time.time()*<span class="number">1000</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_randint</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(random.randint(<span class="number">0</span>,<span class="number">1000000</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_sb2</span>(<span class="params">buvid</span>):</span><br><span class="line">    <span class="keyword">return</span> buvid+g_time_mills()+g_randint()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SHA1_call</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="comment"># 创建sha1对象</span></span><br><span class="line">    sha1 = hashlib.sha1()</span><br><span class="line">    sha1.update(data.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">    <span class="comment"># 获取加密后的数据，以16进制表示</span></span><br><span class="line">    sha1_hex = sha1.hexdigest()</span><br><span class="line">    <span class="keyword">return</span> sha1_hex</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_session</span>(<span class="params">buvid</span>):</span><br><span class="line">    <span class="keyword">return</span> SHA1_call(g_sb2(buvid))</span><br><span class="line"></span><br><span class="line">session = g_session(buvid)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5_call</span>(<span class="params">data</span>):</span><br><span class="line">    data+=<span class="string">&quot;560c52ccd288fed045859ed18bffd973&quot;</span></span><br><span class="line">    <span class="comment"># 创建md5对象</span></span><br><span class="line">    md5 = hashlib.md5()</span><br><span class="line">    <span class="comment"># 更新要加密的数据，参数要是字节类型</span></span><br><span class="line">    md5.update(data.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">    <span class="comment"># 获取加密后的数据，以16进制表示</span></span><br><span class="line">    md5_hex = md5.hexdigest()</span><br><span class="line">    <span class="keyword">return</span> md5_hex</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g_sign</span>(<span class="params">body</span>):</span><br><span class="line">    <span class="comment"># body[&quot;statistics&quot;] = urllib.parse.quote(&quot;&#123;\&quot;appId\&quot;:1,\&quot;platform\&quot;:3,\&quot;version\&quot;:\&quot;6.24.0\&quot;,\&quot;abtest\&quot;:\&quot;\&quot;&#125;&quot;)</span></span><br><span class="line">    body[<span class="string">&quot;statistics&quot;</span>] = urllib.parse.quote(body[<span class="string">&quot;statistics&quot;</span>])</span><br><span class="line">    body_str = <span class="string">&quot;&amp;&quot;</span>.join([key+<span class="string">&quot;=&quot;</span>+value <span class="keyword">for</span> key,value <span class="keyword">in</span> body.items()])</span><br><span class="line">    <span class="comment"># print(body_str)</span></span><br><span class="line">    sign = md5_call(body_str)</span><br><span class="line">    body[<span class="string">&quot;statistics&quot;</span>] = urllib.parse.unquote(body[<span class="string">&quot;statistics&quot;</span>])</span><br><span class="line">    <span class="built_in">print</span>(md5_call(body_str))</span><br><span class="line">    <span class="keyword">return</span> sign</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://api.bilibili.com/x/report/heartbeat/mobile&quot;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">  <span class="string">&quot;content-length&quot;</span>: <span class="string">&quot;751&quot;</span>,</span><br><span class="line">  <span class="string">&quot;buvid&quot;</span>: buvid, <span class="comment"># &quot;XY17684138CCA764C73112F1B0464F485C112&quot;,</span></span><br><span class="line">  <span class="string">&quot;device-id&quot;</span>: <span class="string">&quot;PF9tVWMHYgNiUTQGegZ6&quot;</span>,</span><br><span class="line">  <span class="string">&quot;fp_local&quot;</span>: <span class="string">&quot;2e941853742b47fa1e688cd567d1a40320250204210435027583fd9976406624&quot;</span>,</span><br><span class="line">  <span class="string">&quot;fp_remote&quot;</span>: <span class="string">&quot;2e941853742b47fa1e688cd567d1a4032024123013422042cd4fe24a164fc683&quot;</span>,</span><br><span class="line">  <span class="string">&quot;session_id&quot;</span>: <span class="string">&quot;e5274c78&quot;</span>,</span><br><span class="line">  <span class="string">&quot;env&quot;</span>: <span class="string">&quot;prod&quot;</span>,</span><br><span class="line">  <span class="string">&quot;app-key&quot;</span>: <span class="string">&quot;android&quot;</span>,</span><br><span class="line">  <span class="string">&quot;user-agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 BiliDroid/6.24.0 (bbcallen@gmail.com) os/android model/Pixel 3 mobi_app/android build/6240300 channel/alifenfa innerVer/6240300 osVer/9 network/2&quot;</span>,</span><br><span class="line">  <span class="string">&quot;bili-bridge-engine&quot;</span>: <span class="string">&quot;cronet&quot;</span>,</span><br><span class="line">  <span class="string">&quot;content-type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded; charset=utf-8&quot;</span>,</span><br><span class="line">  <span class="string">&quot;accept-encoding&quot;</span>: <span class="string">&quot;gzip, deflate, br&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">  <span class="string">&quot;actual_played_time&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;aid&quot;</span>: <span class="string">&quot;113954760167085&quot;</span>,</span><br><span class="line">  <span class="string">&quot;appkey&quot;</span>: <span class="string">&quot;1d8b6e7d45233436&quot;</span>,</span><br><span class="line">  <span class="string">&quot;auto_play&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;build&quot;</span>: <span class="string">&quot;6240300&quot;</span>,</span><br><span class="line">  <span class="string">&quot;c_locale&quot;</span>: <span class="string">&quot;zh-Hans_CN&quot;</span>,</span><br><span class="line">  <span class="string">&quot;channel&quot;</span>: <span class="string">&quot;alifenfa&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cid&quot;</span>: <span class="string">&quot;28237826361&quot;</span>,</span><br><span class="line">  <span class="string">&quot;epid&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;epid_status&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;from&quot;</span>: <span class="string">&quot;7&quot;</span>,</span><br><span class="line">  <span class="string">&quot;from_spmid&quot;</span>: <span class="string">&quot;tm.recommend.0.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;last_play_progress_time&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;list_play_time&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;max_play_progress_time&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;mid&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;miniplayer_play_time&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;mobi_app&quot;</span>: <span class="string">&quot;android&quot;</span>,</span><br><span class="line">  <span class="string">&quot;network_type&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;paused_time&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;platform&quot;</span>: <span class="string">&quot;android&quot;</span>,</span><br><span class="line">  <span class="string">&quot;play_status&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;play_type&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;played_time&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;quality&quot;</span>: <span class="string">&quot;32&quot;</span>,</span><br><span class="line">  <span class="string">&quot;s_locale&quot;</span>: <span class="string">&quot;zh-Hans_CN&quot;</span>,</span><br><span class="line">  <span class="string">&quot;session&quot;</span>:  session, <span class="comment">#&quot;307d1c27886c3c46ae604c3a95e41bc4aaa1f71e&quot;, #session,#</span></span><br><span class="line">  <span class="string">&quot;sid&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;spmid&quot;</span>: <span class="string">&quot;main.ugc-video-detail.0.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;start_ts&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;statistics&quot;</span>: <span class="string">&quot;&#123;\&quot;appId\&quot;:1,\&quot;platform\&quot;:3,\&quot;version\&quot;:\&quot;6.24.0\&quot;,\&quot;abtest\&quot;:\&quot;\&quot;&#125;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;sub_type&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;total_time&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;ts&quot;</span>: <span class="built_in">str</span>(<span class="built_in">int</span>(time.time())),<span class="comment"># &quot;1738829640&quot;, #str(int(time.time())),#</span></span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">  <span class="string">&quot;user_status&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;video_duration&quot;</span>: <span class="string">&quot;36&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data[<span class="string">&quot;sign&quot;</span>] = g_sign(data) <span class="comment"># &quot;e0d490be7bc919094d266999c6c9d8be&quot;</span></span><br><span class="line"><span class="comment"># print(data)</span></span><br><span class="line"><span class="comment"># print(data[&quot;sign&quot;])</span></span><br><span class="line"><span class="comment"># print(&quot;&amp;&quot;.join([key+&quot;=&quot;+value for key,value in data.items()]))</span></span><br><span class="line"></span><br><span class="line">response = requests.post(url=url,headers=headers,data=data)</span><br><span class="line"><span class="built_in">print</span>(response.status_code)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>

<h1 id="抓包数据"><a href="#抓包数据" class="headerlink" title="抓包数据"></a>抓包数据</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">url:&quot;https://api.bilibili.com/x/report/click/android2&quot;</span><br><span class="line"></span><br><span class="line">headers:&#123;</span><br><span class="line">  &quot;:authority&quot;: &quot;api.bilibili.com&quot;,</span><br><span class="line">  &quot;:method&quot;: &quot;POST&quot;,</span><br><span class="line">  &quot;:path&quot;: &quot;/x/report/click/android2&quot;,</span><br><span class="line">  &quot;:scheme&quot;: &quot;https&quot;,</span><br><span class="line">  &quot;content-length&quot;: &quot;320&quot;,</span><br><span class="line">  &quot;buvid&quot;: &quot;XY17684138CCA764C73112F1B0464F485C112&quot;,</span><br><span class="line">  &quot;device-id&quot;: &quot;PF9tVWMHYgNiUTQGegZ6&quot;,</span><br><span class="line">  &quot;fp_local&quot;: &quot;2e941853742b47fa1e688cd567d1a40320250204210435027583fd9976406624&quot;,</span><br><span class="line">  &quot;fp_remote&quot;: &quot;2e941853742b47fa1e688cd567d1a4032024123013422042cd4fe24a164fc683&quot;,</span><br><span class="line">  &quot;session_id&quot;: &quot;e5274c78&quot;,</span><br><span class="line">  &quot;env&quot;: &quot;prod&quot;,</span><br><span class="line">  &quot;app-key&quot;: &quot;android&quot;,</span><br><span class="line">  &quot;user-agent&quot;: &quot;Mozilla/5.0 BiliDroid/6.24.0 (bbcallen@gmail.com) os/android model/Pixel 3 mobi_app/android build/6240300 channel/alifenfa innerVer/6240300 osVer/9 network/2&quot;,</span><br><span class="line">  &quot;bili-bridge-engine&quot;: &quot;cronet&quot;,</span><br><span class="line">  &quot;content-type&quot;: &quot;application/octet-stream&quot;,</span><br><span class="line">  &quot;accept-encoding&quot;: &quot;gzip, deflate, br&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data:</span><br><span class="line">96 1B 90 1A 66 5C 24 11 A2 97 15 58 D9 50 5C 18 B6 E0 ED 42 82 0D 00 5E D3 F8 63 32 7E BD 37 36 EB DC C5 30 74 52 78 1A 06 7D 24 59 01 3E E4 3D 10 95 70 D3 F9 6D D8 E3 9F 1B B4 B5 0B F5 87 2A 6F 65 FE 5D C1 D9 A6 0A 50 44 AE 20 53 26 D5 AC D3 5C F8 D7 EB 2E B3 D3 07 E6 02 E7 B9 27 3D EC C9 DD C4 F8 C7 FE E9 E6 13 DC 51 99 28 8D E5 19 A7 E9 78 52 C5 8B F6 8B FC 7C 7D DD B7 4E 91 59 D1 A3 93 7A 3F E0 A4 AA 0F A3 84 7A 8B 9F F4 24 FE 96 D0 62 BA D2 26 D5 2C FC 7B 39 9E 1A 4D C8 40 4D A7 62 75 6F 03 F6 62 55 B5 81 7D 27 BA 3F B7 8C FA 0C 33 A6 4C 2F 2B 51 D5 1B 0B 73 0D E5 CA AD 78 26 85 32 16 C5 FB B5 75 11 0A CE 48 E3 9A 3E D5 03 63 03 30 44 38 87 1C 64 A9 AF 64 B0 6D 39 BC 37 DA 48 0E DB E7 65 E9 36 CD C8 27 77 D2 68 83 FB 99 18 ED 7A CD B2 4B AD B6 05 81 60 1C 47 4B A4 0D 57 0C 28 BD A0 57 35 1A D6 56 81 ED 6B C3 58 AF 74 3E 02 BB 72 EC 56 7B A0 F7 56 D3 59 FA E7 42 05 61 6A DD 57 C0 D1 32 05 C0 67 77 35 A9 58 65 31 36 A6 A7 AC 85 CE 1C 78 AB 4D</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">url:&quot;https://api.bilibili.com/x/report/heartbeat/mobile&quot;</span><br><span class="line"></span><br><span class="line">headers:&#123;</span><br><span class="line">  &quot;:authority&quot;: &quot;api.bilibili.com&quot;,</span><br><span class="line">  &quot;:method&quot;: &quot;POST&quot;,</span><br><span class="line">  &quot;:path&quot;: &quot;/x/report/heartbeat/mobile&quot;,</span><br><span class="line">  &quot;:scheme&quot;: &quot;https&quot;,</span><br><span class="line">  &quot;content-length&quot;: &quot;751&quot;,</span><br><span class="line">  &quot;buvid&quot;: &quot;XY17684138CCA764C73112F1B0464F485C112&quot;,</span><br><span class="line">  &quot;device-id&quot;: &quot;PF9tVWMHYgNiUTQGegZ6&quot;,</span><br><span class="line">  &quot;fp_local&quot;: &quot;2e941853742b47fa1e688cd567d1a40320250204210435027583fd9976406624&quot;,</span><br><span class="line">  &quot;fp_remote&quot;: &quot;2e941853742b47fa1e688cd567d1a4032024123013422042cd4fe24a164fc683&quot;,</span><br><span class="line">  &quot;session_id&quot;: &quot;e5274c78&quot;,</span><br><span class="line">  &quot;env&quot;: &quot;prod&quot;,</span><br><span class="line">  &quot;app-key&quot;: &quot;android&quot;,</span><br><span class="line">  &quot;user-agent&quot;: &quot;Mozilla/5.0 BiliDroid/6.24.0 (bbcallen@gmail.com) os/android model/Pixel 3 mobi_app/android build/6240300 channel/alifenfa innerVer/6240300 osVer/9 network/2&quot;,</span><br><span class="line">  &quot;bili-bridge-engine&quot;: &quot;cronet&quot;,</span><br><span class="line">  &quot;content-type&quot;: &quot;application/x-www-form-urlencoded; charset=utf-8&quot;,</span><br><span class="line">  &quot;accept-encoding&quot;: &quot;gzip, deflate, br&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data:&#123;</span><br><span class="line">  &quot;actual_played_time&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;aid&quot;: &quot;113954760167085&quot;,</span><br><span class="line">  &quot;appkey&quot;: &quot;1d8b6e7d45233436&quot;,</span><br><span class="line">  &quot;auto_play&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;build&quot;: &quot;6240300&quot;,</span><br><span class="line">  &quot;c_locale&quot;: &quot;zh-Hans_CN&quot;,</span><br><span class="line">  &quot;channel&quot;: &quot;alifenfa&quot;,</span><br><span class="line">  &quot;cid&quot;: &quot;28237826361&quot;,</span><br><span class="line">  &quot;epid&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;epid_status&quot;: &quot;&quot;,</span><br><span class="line">  &quot;from&quot;: &quot;7&quot;,</span><br><span class="line">  &quot;from_spmid&quot;: &quot;tm.recommend.0.0&quot;,</span><br><span class="line">  &quot;last_play_progress_time&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;list_play_time&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;max_play_progress_time&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;mid&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;miniplayer_play_time&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;mobi_app&quot;: &quot;android&quot;,</span><br><span class="line">  &quot;network_type&quot;: &quot;1&quot;,</span><br><span class="line">  &quot;paused_time&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;platform&quot;: &quot;android&quot;,</span><br><span class="line">  &quot;play_status&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;play_type&quot;: &quot;1&quot;,</span><br><span class="line">  &quot;played_time&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;quality&quot;: &quot;32&quot;,</span><br><span class="line">  &quot;s_locale&quot;: &quot;zh-Hans_CN&quot;,</span><br><span class="line">  &quot;session&quot;: &quot;307d1c27886c3c46ae604c3a95e41bc4aaa1f71e&quot;,</span><br><span class="line">  &quot;sid&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;spmid&quot;: &quot;main.ugc-video-detail.0.0&quot;,</span><br><span class="line">  &quot;start_ts&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;statistics&quot;: &quot;&#123;\&quot;appId\&quot;:1,\&quot;platform\&quot;:3,\&quot;version\&quot;:\&quot;6.24.0\&quot;,\&quot;abtest\&quot;:\&quot;\&quot;&#125;&quot;,</span><br><span class="line">  &quot;sub_type&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;total_time&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;ts&quot;: &quot;1738829640&quot;,</span><br><span class="line">  &quot;type&quot;: &quot;3&quot;,</span><br><span class="line">  &quot;user_status&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;video_duration&quot;: &quot;36&quot;,</span><br><span class="line">  &quot;sign&quot;: &quot;e0d490be7bc919094d266999c6c9d8be&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">url:&quot;https://api.bilibili.com/x/report/heartbeat/mobile&quot;</span><br><span class="line"></span><br><span class="line">headers:&#123;</span><br><span class="line">  &quot;:authority&quot;: &quot;api.bilibili.com&quot;,</span><br><span class="line">  &quot;:method&quot;: &quot;POST&quot;,</span><br><span class="line">  &quot;:path&quot;: &quot;/x/report/heartbeat/mobile&quot;,</span><br><span class="line">  &quot;:scheme&quot;: &quot;https&quot;,</span><br><span class="line">  &quot;content-length&quot;: &quot;765&quot;,</span><br><span class="line">  &quot;buvid&quot;: &quot;XY17684138CCA764C73112F1B0464F485C112&quot;,</span><br><span class="line">  &quot;device-id&quot;: &quot;PF9tVWMHYgNiUTQGegZ6&quot;,</span><br><span class="line">  &quot;fp_local&quot;: &quot;2e941853742b47fa1e688cd567d1a40320250204210435027583fd9976406624&quot;,</span><br><span class="line">  &quot;fp_remote&quot;: &quot;2e941853742b47fa1e688cd567d1a4032024123013422042cd4fe24a164fc683&quot;,</span><br><span class="line">  &quot;session_id&quot;: &quot;e5274c78&quot;,</span><br><span class="line">  &quot;env&quot;: &quot;prod&quot;,</span><br><span class="line">  &quot;app-key&quot;: &quot;android&quot;,</span><br><span class="line">  &quot;user-agent&quot;: &quot;Mozilla/5.0 BiliDroid/6.24.0 (bbcallen@gmail.com) os/android model/Pixel 3 mobi_app/android build/6240300 channel/alifenfa innerVer/6240300 osVer/9 network/2&quot;,</span><br><span class="line">  &quot;bili-bridge-engine&quot;: &quot;cronet&quot;,</span><br><span class="line">  &quot;content-type&quot;: &quot;application/x-www-form-urlencoded; charset=utf-8&quot;,</span><br><span class="line">  &quot;accept-encoding&quot;: &quot;gzip, deflate, br&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data:&#123;</span><br><span class="line">  &quot;actual_played_time&quot;: &quot;10&quot;,</span><br><span class="line">  &quot;aid&quot;: &quot;113954760167085&quot;,</span><br><span class="line">  &quot;appkey&quot;: &quot;1d8b6e7d45233436&quot;,</span><br><span class="line">  &quot;auto_play&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;build&quot;: &quot;6240300&quot;,</span><br><span class="line">  &quot;c_locale&quot;: &quot;zh-Hans_CN&quot;,</span><br><span class="line">  &quot;channel&quot;: &quot;alifenfa&quot;,</span><br><span class="line">  &quot;cid&quot;: &quot;28237826361&quot;,</span><br><span class="line">  &quot;epid&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;epid_status&quot;: &quot;&quot;,</span><br><span class="line">  &quot;from&quot;: &quot;7&quot;,</span><br><span class="line">  &quot;from_spmid&quot;: &quot;tm.recommend.0.0&quot;,</span><br><span class="line">  &quot;last_play_progress_time&quot;: &quot;36&quot;,</span><br><span class="line">  &quot;list_play_time&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;max_play_progress_time&quot;: &quot;36&quot;,</span><br><span class="line">  &quot;mid&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;miniplayer_play_time&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;mobi_app&quot;: &quot;android&quot;,</span><br><span class="line">  &quot;network_type&quot;: &quot;1&quot;,</span><br><span class="line">  &quot;paused_time&quot;: &quot;1&quot;,</span><br><span class="line">  &quot;platform&quot;: &quot;android&quot;,</span><br><span class="line">  &quot;play_status&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;play_type&quot;: &quot;1&quot;,</span><br><span class="line">  &quot;played_time&quot;: &quot;10&quot;,</span><br><span class="line">  &quot;quality&quot;: &quot;32&quot;,</span><br><span class="line">  &quot;s_locale&quot;: &quot;zh-Hans_CN&quot;,</span><br><span class="line">  &quot;session&quot;: &quot;307d1c27886c3c46ae604c3a95e41bc4aaa1f71e&quot;,</span><br><span class="line">  &quot;sid&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;spmid&quot;: &quot;main.ugc-video-detail.0.0&quot;,</span><br><span class="line">  &quot;start_ts&quot;: &quot;1738829483&quot;,</span><br><span class="line">  &quot;statistics&quot;: &quot;&#123;\&quot;appId\&quot;:1,\&quot;platform\&quot;:3,\&quot;version\&quot;:\&quot;6.24.0\&quot;,\&quot;abtest\&quot;:\&quot;\&quot;&#125;&quot;,</span><br><span class="line">  &quot;sub_type&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;total_time&quot;: &quot;11&quot;,</span><br><span class="line">  &quot;ts&quot;: &quot;1738829651&quot;,</span><br><span class="line">  &quot;type&quot;: &quot;3&quot;,</span><br><span class="line">  &quot;user_status&quot;: &quot;0&quot;,</span><br><span class="line">  &quot;video_duration&quot;: &quot;36&quot;,</span><br><span class="line">  &quot;sign&quot;: &quot;e1e9b0a874cf0575cc7fffd50df09ae8&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="unidbg"><a href="#unidbg" class="headerlink" title="unidbg"></a>unidbg</h1><h2 id="模拟执行s方法"><a href="#模拟执行s方法" class="headerlink" title="模拟执行s方法"></a>模拟执行s方法</h2><p><img src="/2025/02/06/B%E7%AB%99%E6%92%AD%E6%94%BE%E9%87%8F%E5%8F%8A%E5%AE%8C%E6%92%AD%E7%8E%87%E6%8E%A5%E5%8F%A3%E9%80%86%E5%90%91/94.jpg" alt="1"></p>
<p>so位置<code>libbili.so</code></p>
<h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>s方法的调用位置，如下，被<code>g()</code>方法调用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public static SignedQuery g(Map&lt;String, String&gt; map) &#123;</span><br><span class="line">    return s(map == null ? new TreeMap() : new TreeMap(map));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>返回一个<code>SignedQuery</code>对象</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public SignedQuery(String str, String str2) &#123;</span><br><span class="line">    this.a = str;</span><br><span class="line">    this.b = str2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们的目标是得到<code>SignedQuery</code>里的<code>this.b</code>字段</p>
<p>在补环境的过程中，我们一定会补<code>SignedQuery</code>，在补它的时候传入这两个参数，而我们可以在这里直接拿到这两个参数，就不需要继续补环境了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LibBili</span> <span class="keyword">extends</span> <span class="title class_">AbstractJni</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AndroidEmulator emulator;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">process</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Memory memory;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> VM vm;</span><br><span class="line">    <span class="keyword">private</span> DalvikModule dm;</span><br><span class="line">    <span class="keyword">private</span> Module <span class="keyword">module</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LibBili</span><span class="params">()</span> &#123;</span><br><span class="line">        emulator = AndroidEmulatorBuilder</span><br><span class="line">                .for32Bit() <span class="comment">// for32Bit()</span></span><br><span class="line">                .setProcessName(process)</span><br><span class="line">                .setRootDir(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;target/rootfs&quot;</span>))</span><br><span class="line">                .build();</span><br><span class="line">        <span class="comment">// 设置执行多少条指令切换一次线程</span></span><br><span class="line">        <span class="comment">// emulator.getBackend().registerEmuCountHook(10000);</span></span><br><span class="line">        <span class="comment">// 开启线程调度器</span></span><br><span class="line">        <span class="comment">// emulator.getSyscallHandler().setEnableThreadDispatcher(true);</span></span><br><span class="line">        memory = emulator.getMemory();</span><br><span class="line">        memory.setLibraryResolver(<span class="keyword">new</span> <span class="title class_">AndroidResolver</span>(<span class="number">23</span>));</span><br><span class="line">        vm = emulator.createDalvikVM(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;unidbg-android/src/test/java/com/tv/danmaku/bili/bili_6.24.0.apk&quot;</span>));</span><br><span class="line">        vm.setJni(<span class="built_in">this</span>);</span><br><span class="line">        vm.setVerbose(<span class="literal">true</span>);</span><br><span class="line">        dm = vm.loadLibrary(<span class="string">&quot;bili&quot;</span>,<span class="literal">true</span>);</span><br><span class="line">        dm.callJNI_OnLoad(emulator);</span><br><span class="line">        <span class="keyword">module</span> = dm.getModule();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sign</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">DvmClass</span> <span class="variable">LibBiliClass</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com.bilibili.nativelibrary.LibBili&quot;</span>);</span><br><span class="line">        <span class="type">SortedMap</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeMap</span>();</span><br><span class="line">        map.put(<span class="string">&quot;actual_played_time&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;aid&quot;</span>, <span class="string">&quot;113945784358610&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;appkey&quot;</span>, <span class="string">&quot;1d8b6e7d45233436&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;ts&quot;</span>, <span class="string">&quot;1738825391&quot;</span>);</span><br><span class="line"><span class="comment">//        map.put(&quot;actual_played_time&quot;, &quot;1&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;aid&quot;, &quot;113945784358610&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;appkey&quot;, &quot;1d8b6e7d45233436&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;auto_play&quot;, &quot;0&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;build&quot;, &quot;6240300&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;c_locale&quot;, &quot;zh-Hans_CN&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;channel&quot;, &quot;alifenfa&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;cid&quot;, &quot;28214757335&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;epid&quot;, &quot;0&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;epid_status&quot;, &quot;&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;from&quot;, &quot;7&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;from_spmid&quot;, &quot;tm.recommend.0.0&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;last_play_progress_time&quot;, &quot;1&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;list_play_time&quot;, &quot;0&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;max_play_progress_time&quot;, &quot;1&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;mid&quot;, &quot;0&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;miniplayer_play_time&quot;, &quot;0&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;mobi_app&quot;, &quot;android&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;network_type&quot;, &quot;1&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;paused_time&quot;, &quot;2&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;platform&quot;, &quot;android&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;play_status&quot;, &quot;0&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;play_type&quot;, &quot;1&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;played_time&quot;, &quot;1&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;quality&quot;, &quot;32&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;s_locale&quot;, &quot;zh-Hans_CN&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;session&quot;, &quot;22b3446fdb1b406d22b87ba3d09bbeb0bb170e21&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;sid&quot;, &quot;0&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;spmid&quot;, &quot;main.ugc-video-detail.0.0&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;start_ts&quot;, &quot;1738823412&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;statistics&quot;, &quot;&#123;appId:1, platform:3, version:\&quot;6.24.0\&quot;, abtest:\&quot;\&quot;&#125;&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;sub_type&quot;, &quot;0&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;total_time&quot;, &quot;3&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;ts&quot;,&quot;1738823572&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;type&quot;, &quot;3&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;user_status&quot;, &quot;0&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;video_duration&quot;, &quot;284&quot;);</span></span><br><span class="line">        <span class="type">ProxyDvmObject</span> <span class="variable">map_proxyobj</span> <span class="operator">=</span> (ProxyDvmObject) ProxyDvmObject.createObject(vm,map);</span><br><span class="line">        LibBiliClass.callStaticJniMethodObject(emulator,<span class="string">&quot;s(Ljava/util/SortedMap;)Lcom/bilibili/nativelibrary/SignedQuery;&quot;</span>,map_proxyobj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">LibBili</span> <span class="variable">bili</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LibBili</span>();</span><br><span class="line">        bili.sign();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="补环境"><a href="#补环境" class="headerlink" title="补环境"></a>补环境</h3><h4 id="补isEmpty"><a href="#补isEmpty" class="headerlink" title="补isEmpty()"></a>补isEmpty()</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java.lang.UnsupportedOperationException: java/util/Map-&gt;isEmpty()Z</span><br><span class="line">	at com.github.unidbg.linux.android.dvm.AbstractJni.callBooleanMethod(AbstractJni.java:598)</span><br></pre></td></tr></table></figure>

<p>补</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">case &quot;java/util/Map-&gt;isEmpty()Z&quot;:&#123;</span><br><span class="line">    Map map = (Map) dvmObject.getValue();</span><br><span class="line">    return map.isEmpty();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行，继续补环境</p>
<h4 id="补get-Ljava-lang-Object"><a href="#补get-Ljava-lang-Object" class="headerlink" title="补get(Ljava&#x2F;lang&#x2F;Object;)"></a>补get(Ljava&#x2F;lang&#x2F;Object;)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java.lang.UnsupportedOperationException: java/util/Map-&gt;get(Ljava/lang/Object;)Ljava/lang/Object;</span><br><span class="line">	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethod(AbstractJni.java:933)</span><br></pre></td></tr></table></figure>

<p>补</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">&quot;java/util/Map-&gt;get(Ljava/lang/Object;)Ljava/lang/Object;&quot;</span>:&#123;</span><br><span class="line">    <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> (Map) dvmObject.getValue();</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String) varArg.getObjectArg(<span class="number">0</span>).getValue();</span><br><span class="line">    System.out.println(key);</span><br><span class="line">    <span class="type">String</span> <span class="variable">get</span> <span class="operator">=</span> (String) map.get(key);</span><br><span class="line">    <span class="keyword">return</span> ProxyDvmObject.createObject(vm,get);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里打印出来的key</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">appkey</span><br><span class="line">ts</span><br></pre></td></tr></table></figure>

<p>运行，继续补环境</p>
<h4 id="补put-Ljava-lang-Object-Ljava-lang-Object"><a href="#补put-Ljava-lang-Object-Ljava-lang-Object" class="headerlink" title="补put(Ljava&#x2F;lang&#x2F;Object;Ljava&#x2F;lang&#x2F;Object;)"></a>补put(Ljava&#x2F;lang&#x2F;Object;Ljava&#x2F;lang&#x2F;Object;)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java.lang.UnsupportedOperationException: java/util/Map-&gt;put(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;</span><br><span class="line">	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethod(AbstractJni.java:933)</span><br></pre></td></tr></table></figure>

<p>补</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">&quot;java/util/Map-&gt;put(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;&quot;</span>:&#123;</span><br><span class="line">    <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> (Map) dvmObject.getValue();</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String) varArg.getObjectArg(<span class="number">0</span>).getValue();</span><br><span class="line">    System.out.println(key);</span><br><span class="line">    <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> (String) varArg.getObjectArg(<span class="number">1</span>).getValue();</span><br><span class="line">    System.out.println(value);</span><br><span class="line">    map.put(key, value);</span><br><span class="line">    <span class="keyword">return</span> ProxyDvmObject.createObject(vm,value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行，继续补环境</p>
<h4 id="补r-Ljava-util-Map"><a href="#补r-Ljava-util-Map" class="headerlink" title="补r(Ljava&#x2F;util&#x2F;Map;)"></a>补r(Ljava&#x2F;util&#x2F;Map;)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java.lang.UnsupportedOperationException: com/bilibili/nativelibrary/SignedQuery-&gt;r(Ljava/util/Map;)Ljava/lang/String;</span><br><span class="line">	at com.github.unidbg.linux.android.dvm.AbstractJni.callStaticObjectMethod(AbstractJni.java:433)</span><br></pre></td></tr></table></figure>

<p>这里补的是SignedQuery类的r方法，但是Unidbg里没有SignedQuery类，这个类需要自己实现，到jadx里copy过来</p>
<p>然后进行更正，更正完再补</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">case &quot;com/bilibili/nativelibrary/SignedQuery-&gt;r(Ljava/util/Map;)Ljava/lang/String;&quot;:&#123;</span><br><span class="line">    Map map = (Map) varArg.getObjectArg(0).getValue();</span><br><span class="line">    System.out.println(map);</span><br><span class="line">    String ret = SignedQuery.r(map);</span><br><span class="line">    System.out.println(ret);</span><br><span class="line">    return ProxyDvmObject.createObject(vm,ret);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="补"><a href="#补" class="headerlink" title="补&lt;init&gt;"></a>补<code>&lt;init&gt;</code></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java.lang.UnsupportedOperationException: com/bilibili/nativelibrary/SignedQuery-&gt;&lt;init&gt;(Ljava/lang/String;Ljava/lang/String;)V</span><br><span class="line">	at com.github.unidbg.linux.android.dvm.AbstractJni.newObject(AbstractJni.java:753)</span><br></pre></td></tr></table></figure>

<p>补</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">case &quot;com/bilibili/nativelibrary/SignedQuery-&gt;&lt;init&gt;(Ljava/lang/String;Ljava/lang/String;)V&quot;:&#123;</span><br><span class="line">    String sign = (String) varArg.getObjectArg(1).getValue();</span><br><span class="line">    System.out.println(sign);</span><br><span class="line">    return vm.resolveClass(&quot;com/bilibili/nativelibrary/SignedQuery&quot;).newObject(null);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="over"><a href="#over" class="headerlink" title="over"></a>over</h4><p>运行就出结果了。</p>
<h2 id="打包Python调用"><a href="#打包Python调用" class="headerlink" title="打包Python调用"></a>打包Python调用</h2><p>修改，可传入参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tv.danmaku.bili;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.AndroidEmulator;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.Module;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidEmulatorBuilder;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidResolver;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.*;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.jni.ProxyDvmObject;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.memory.Memory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.SortedMap;</span><br><span class="line"><span class="keyword">import</span> java.util.TreeMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LibBili</span> <span class="keyword">extends</span> <span class="title class_">AbstractJni</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AndroidEmulator emulator;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">process</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Memory memory;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> VM vm;</span><br><span class="line">    <span class="keyword">private</span> DalvikModule dm;</span><br><span class="line">    <span class="keyword">private</span> Module <span class="keyword">module</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LibBili</span><span class="params">()</span> &#123;</span><br><span class="line">        emulator = AndroidEmulatorBuilder</span><br><span class="line">                .for32Bit() <span class="comment">// for32Bit()</span></span><br><span class="line">                .setProcessName(process)</span><br><span class="line">                .setRootDir(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;target/rootfs&quot;</span>))</span><br><span class="line">                .build();</span><br><span class="line">        <span class="comment">// 设置执行多少条指令切换一次线程</span></span><br><span class="line">        <span class="comment">// emulator.getBackend().registerEmuCountHook(10000);</span></span><br><span class="line">        <span class="comment">// 开启线程调度器</span></span><br><span class="line">        <span class="comment">// emulator.getSyscallHandler().setEnableThreadDispatcher(true);</span></span><br><span class="line">        memory = emulator.getMemory();</span><br><span class="line">        memory.setLibraryResolver(<span class="keyword">new</span> <span class="title class_">AndroidResolver</span>(<span class="number">23</span>));</span><br><span class="line">        vm = emulator.createDalvikVM(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;apks/bili_6.24.0.apk&quot;</span>));</span><br><span class="line">        vm.setJni(<span class="built_in">this</span>);</span><br><span class="line"><span class="comment">//        vm.setVerbose(true);</span></span><br><span class="line">        dm = vm.loadLibrary(<span class="string">&quot;bili&quot;</span>,<span class="literal">true</span>);</span><br><span class="line">        dm.callJNI_OnLoad(emulator);</span><br><span class="line">        <span class="keyword">module</span> = dm.getModule();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sign</span><span class="params">(String ts)</span>&#123;</span><br><span class="line">        <span class="type">DvmClass</span> <span class="variable">LibBiliClass</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com.bilibili.nativelibrary.LibBili&quot;</span>);</span><br><span class="line">        <span class="type">SortedMap</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeMap</span>();</span><br><span class="line">        map.put(<span class="string">&quot;actual_played_time&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;aid&quot;</span>, <span class="string">&quot;113945784358610&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;appkey&quot;</span>, <span class="string">&quot;1d8b6e7d45233436&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;ts&quot;</span>, ts);</span><br><span class="line"><span class="comment">//        map.put(&quot;actual_played_time&quot;, &quot;1&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;aid&quot;, &quot;113945784358610&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;appkey&quot;, &quot;1d8b6e7d45233436&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;auto_play&quot;, &quot;0&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;build&quot;, &quot;6240300&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;c_locale&quot;, &quot;zh-Hans_CN&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;channel&quot;, &quot;alifenfa&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;cid&quot;, &quot;28214757335&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;epid&quot;, &quot;0&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;epid_status&quot;, &quot;&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;from&quot;, &quot;7&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;from_spmid&quot;, &quot;tm.recommend.0.0&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;last_play_progress_time&quot;, &quot;1&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;list_play_time&quot;, &quot;0&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;max_play_progress_time&quot;, &quot;1&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;mid&quot;, &quot;0&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;miniplayer_play_time&quot;, &quot;0&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;mobi_app&quot;, &quot;android&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;network_type&quot;, &quot;1&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;paused_time&quot;, &quot;2&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;platform&quot;, &quot;android&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;play_status&quot;, &quot;0&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;play_type&quot;, &quot;1&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;played_time&quot;, &quot;1&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;quality&quot;, &quot;32&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;s_locale&quot;, &quot;zh-Hans_CN&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;session&quot;, &quot;22b3446fdb1b406d22b87ba3d09bbeb0bb170e21&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;sid&quot;, &quot;0&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;spmid&quot;, &quot;main.ugc-video-detail.0.0&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;start_ts&quot;, &quot;1738823412&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;statistics&quot;, &quot;&#123;appId:1, platform:3, version:\&quot;6.24.0\&quot;, abtest:\&quot;\&quot;&#125;&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;sub_type&quot;, &quot;0&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;total_time&quot;, &quot;3&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;ts&quot;,&quot;1738823572&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;type&quot;, &quot;3&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;user_status&quot;, &quot;0&quot;);</span></span><br><span class="line"><span class="comment">//        map.put(&quot;video_duration&quot;, &quot;284&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="type">ProxyDvmObject</span> <span class="variable">map_proxyobj</span> <span class="operator">=</span> (ProxyDvmObject) ProxyDvmObject.createObject(vm,map);</span><br><span class="line">        LibBiliClass.callStaticJniMethodObject(emulator,<span class="string">&quot;s(Ljava/util/SortedMap;)Lcom/bilibili/nativelibrary/SignedQuery;&quot;</span>,map_proxyobj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">callBooleanMethod</span><span class="params">(BaseVM vm, DvmObject&lt;?&gt; dvmObject, String signature, VarArg varArg)</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (signature)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;java/util/Map-&gt;isEmpty()Z&quot;</span>:&#123;</span><br><span class="line">                <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> (Map) dvmObject.getValue();</span><br><span class="line">                <span class="keyword">return</span> map.isEmpty();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.callBooleanMethod(vm, dvmObject, signature, varArg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> DvmObject&lt;?&gt; callObjectMethod(BaseVM vm, DvmObject&lt;?&gt; dvmObject, String signature, VarArg varArg) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (signature)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;java/util/Map-&gt;get(Ljava/lang/Object;)Ljava/lang/Object;&quot;</span>:&#123;</span><br><span class="line">                <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> (Map) dvmObject.getValue();</span><br><span class="line">                <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String) varArg.getObjectArg(<span class="number">0</span>).getValue();</span><br><span class="line"><span class="comment">//                System.out.println(key);</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">get</span> <span class="operator">=</span> (String) map.get(key);</span><br><span class="line">                <span class="keyword">return</span> ProxyDvmObject.createObject(vm,get);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;java/util/Map-&gt;put(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;&quot;</span>:&#123;</span><br><span class="line">                <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> (Map) dvmObject.getValue();</span><br><span class="line">                <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String) varArg.getObjectArg(<span class="number">0</span>).getValue();</span><br><span class="line"><span class="comment">//                System.out.println(key);</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> (String) varArg.getObjectArg(<span class="number">1</span>).getValue();</span><br><span class="line"><span class="comment">//                System.out.println(value);</span></span><br><span class="line">                map.put(key, value);</span><br><span class="line">                <span class="keyword">return</span> ProxyDvmObject.createObject(vm,value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.callObjectMethod(vm, dvmObject, signature, varArg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> DvmObject&lt;?&gt; callStaticObjectMethod(BaseVM vm, DvmClass dvmClass, String signature, VarArg varArg) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (signature)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;com/bilibili/nativelibrary/SignedQuery-&gt;r(Ljava/util/Map;)Ljava/lang/String;&quot;</span>:&#123;</span><br><span class="line">                <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> (Map) varArg.getObjectArg(<span class="number">0</span>).getValue();</span><br><span class="line"><span class="comment">//                System.out.println(map);</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">ret</span> <span class="operator">=</span> SignedQuery.r(map);</span><br><span class="line"><span class="comment">//                System.out.println(ret);</span></span><br><span class="line">                <span class="keyword">return</span> ProxyDvmObject.createObject(vm,ret);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.callStaticObjectMethod(vm, dvmClass, signature, varArg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> DvmObject&lt;?&gt; newObject(BaseVM vm, DvmClass dvmClass, String signature, VarArg varArg) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (signature)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;com/bilibili/nativelibrary/SignedQuery-&gt;&lt;init&gt;(Ljava/lang/String;Ljava/lang/String;)V&quot;</span>:&#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">sign</span> <span class="operator">=</span> (String) varArg.getObjectArg(<span class="number">1</span>).getValue();</span><br><span class="line">                System.out.println(sign);</span><br><span class="line">                <span class="keyword">return</span> vm.resolveClass(<span class="string">&quot;com/bilibili/nativelibrary/SignedQuery&quot;</span>).newObject(<span class="literal">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.newObject(vm, dvmClass, signature, varArg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">ts</span> <span class="operator">=</span> args[<span class="number">0</span>];</span><br><span class="line">        <span class="type">LibBili</span> <span class="variable">bili</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LibBili</span>();</span><br><span class="line">        bili.sign(ts);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line">arg = <span class="string">&quot;1738825391&quot;</span></span><br><span class="line"></span><br><span class="line">cmd = <span class="string">&quot;java -jar unidbg.jar &quot;</span>+arg</span><br><span class="line">signature = subprocess.check_output(cmd,shell=<span class="string">&quot;True&quot;</span>,cwd = <span class="string">&quot;unidbg_jar&quot;</span>).decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(signature)</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd3eb3e0e90c07304828f1a2c9581d06</span><br></pre></td></tr></table></figure>






    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/B%E7%AB%99/" rel="tag"><svg t="1732789072752" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4858" width="15" height="15"><path d="M229.443715 343.118259l565.172804 0 0 410.010794c0 37.525595-30.237317 67.762912-67.040108 67.762912l-46.319715 0 0 139.742183c0 35.116247-28.249605 63.365852-63.305618 63.365852-35.116247 0-63.546553-28.309839-63.546553-63.365852l0-139.742183-84.809049 0 0 139.742183c0 35.056013-28.430306 63.365852-63.546553 63.365852-34.393443 0-62.763515-28.309839-62.763515-63.365852l-0.542103-139.742183-45.596911 0c-37.465361 0-67.702678-30.177084-67.702678-67.762912l0-410.010794zM141.984383 331.432921c-35.056013 0-63.426086 28.370073-63.426086 62.763515l0 264.787344c0 35.116247 28.370073 63.365852 63.426086 63.365852s62.763515-28.309839 62.763515-63.365852l0-264.787344c0-34.393443-28.189371-62.763515-62.763515-62.763515zM796.42353 320.952257l-569.449397 0c0-97.879762 58.547156-182.869512 145.343917-227.141282l-43.7899-80.59269c-2.469582-4.336826-1.264908-9.878327 3.071919-12.347908 4.276593-1.867245 9.878327-0.662571 12.347908 3.734489l44.271769 81.255261c37.646062-16.684735 79.508484-25.900491 123.780253-25.900491s86.134191 9.215756 123.780253 25.840257l44.271769-81.255261c2.469582-4.336826 8.071316-5.5415 12.347908-3.734489 4.336826 2.469582 5.5415 8.011082 3.071919 12.347908l-43.7899 80.59269c86.254658 44.332003 144.74158 129.321753 144.74158 227.201515zM406.048922 194.160319c0-12.950245-10.42043-24.033246-23.912779-24.033246-13.010479 0-23.430909 11.083001-23.430909 24.033246 0 12.890012 10.42043 23.973012 23.430909 23.973012 13.492349 0.060234 23.912779-11.022767 23.912779-23.973012zM665.294766 194.160319c0-12.950245-10.42043-24.033246-23.430909-24.033246-13.552582 0-23.912779 11.083001-23.912779 24.033246 0 12.890012 10.42043 23.973012 23.912779 23.973012 13.010479 0.060234 23.430909-11.022767 23.430909-23.973012zM882.015617 331.432921c-34.51391 0-62.763515 27.707502-62.763515 62.763515l0 264.787344c0 35.116247 28.249605 63.365852 62.763515 63.365852 35.056013 0 63.426086-28.309839 63.426086-63.365852l0-264.787344c-0.060234-35.056013-28.370073-62.763515-63.426086-62.763515z" fill="#000000" p-id="4859"></path></svg> B站</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/01/29/%E6%A6%82%E7%8E%87%E8%AE%BA%E4%B8%8E%E6%95%B0%E7%90%86%E7%BB%9F%E8%AE%A1/" rel="prev" title="概率论与数理统计">
      <i class="fa fa-chevron-left"></i> 概率论与数理统计
    </a></div>
      <div class="post-nav-item">
    <a href="/2025/02/06/%E9%9A%8F%E8%AE%B0/" rel="next" title="随记">
      随记 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#APP%E4%BF%A1%E6%81%AF"><span class="nav-number">1.</span> <span class="nav-text">APP信息</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8A%93%E5%8C%85%E5%88%86%E6%9E%90%E6%95%B0%E6%8D%AE%E5%8C%85"><span class="nav-number">2.</span> <span class="nav-text">抓包分析数据包</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E6%9E%90%E8%AF%B7%E6%B1%82%E4%BD%93"><span class="nav-number">2.1.</span> <span class="nav-text">分析请求体</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%8D%E7%BC%96%E8%AF%91apk"><span class="nav-number">2.2.</span> <span class="nav-text">反编译apk</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#reportClick"><span class="nav-number">2.2.1.</span> <span class="nav-text">reportClick</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#d-this-H7"><span class="nav-number">2.2.2.</span> <span class="nav-text">d.this.H7()</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#hook-H7"><span class="nav-number">2.2.2.1.</span> <span class="nav-text">hook H7</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8H7"><span class="nav-number">2.2.2.2.</span> <span class="nav-text">主动调用H7</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#t3-a-i-a-a-a-b-e-b"><span class="nav-number">2.2.3.</span> <span class="nav-text">t3.a.i.a.a.a.b.e.b</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#hook-b"><span class="nav-number">2.2.3.1.</span> <span class="nav-text">hook b</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#com-bilibili-commons-m-a-g"><span class="nav-number">2.2.4.</span> <span class="nav-text">com.bilibili.commons.m.a.g</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#hook-g"><span class="nav-number">2.2.4.1.</span> <span class="nav-text">hook g</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#t3-a-i-a-a-a-b-e-a"><span class="nav-number">2.2.5.</span> <span class="nav-text">t3.a.i.a.a.a.b.e.a</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#hook-a"><span class="nav-number">2.2.5.1.</span> <span class="nav-text">hook a</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%AF%86%E8%AF%B7%E6%B1%82%E4%BD%93"><span class="nav-number">2.2.6.</span> <span class="nav-text">解密请求体</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Python%E5%AE%9E%E7%8E%B0%E8%AF%B7%E6%B1%82%E4%BD%93%E5%8A%A0%E5%AF%86"><span class="nav-number">3.</span> <span class="nav-text">Python实现请求体加密</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E4%BD%93%E5%8F%82%E6%95%B0%E8%BF%98%E5%8E%9F"><span class="nav-number">3.1.</span> <span class="nav-text">请求体参数还原</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#sign%E8%BF%98%E5%8E%9F"><span class="nav-number">3.1.1.</span> <span class="nav-text">sign还原</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#aid%E8%BF%98%E5%8E%9F"><span class="nav-number">3.1.2.</span> <span class="nav-text">aid还原</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#build%E8%BF%98%E5%8E%9F"><span class="nav-number">3.1.3.</span> <span class="nav-text">build还原</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cid%E8%BF%98%E5%8E%9F"><span class="nav-number">3.1.4.</span> <span class="nav-text">cid还原</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#did%E8%BF%98%E5%8E%9F"><span class="nav-number">3.1.5.</span> <span class="nav-text">did还原</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#c"><span class="nav-number">3.1.5.1.</span> <span class="nav-text">c</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#g"><span class="nav-number">3.1.5.2.</span> <span class="nav-text">g</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#f"><span class="nav-number">3.1.5.3.</span> <span class="nav-text">f</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#j"><span class="nav-number">3.1.5.4.</span> <span class="nav-text">j</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#c-1"><span class="nav-number">3.1.5.5.</span> <span class="nav-text">c</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#h"><span class="nav-number">3.1.5.6.</span> <span class="nav-text">h</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#i"><span class="nav-number">3.1.5.7.</span> <span class="nav-text">i</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">3.1.5.8.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b"><span class="nav-number">3.1.5.9.</span> <span class="nav-text">b</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E8%BF%98%E5%8E%9F"><span class="nav-number">3.1.5.10.</span> <span class="nav-text">参数还原</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#hook-f"><span class="nav-number">3.1.5.11.</span> <span class="nav-text">hook f</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Python%E7%94%9F%E6%88%90mac%E5%9C%B0%E5%9D%80"><span class="nav-number">3.1.5.12.</span> <span class="nav-text">Python生成mac地址</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Python%E5%AE%9E%E7%8E%B0b%E6%96%B9%E6%B3%95"><span class="nav-number">3.1.5.13.</span> <span class="nav-text">Python实现b方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Python%E5%AE%9E%E7%8E%B0%E8%AF%B7%E6%B1%82%E4%BD%93%E5%8A%A0%E5%AF%86-1"><span class="nav-number">3.1.6.</span> <span class="nav-text">Python实现请求体加密</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E5%A4%B4%E5%8F%82%E6%95%B0%E5%88%86%E6%9E%90"><span class="nav-number">4.</span> <span class="nav-text">请求头参数分析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#buvid%E5%8F%82%E6%95%B0%E8%BF%98%E5%8E%9F"><span class="nav-number">4.1.</span> <span class="nav-text">buvid参数还原</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#c-2"><span class="nav-number">4.1.1.</span> <span class="nav-text">c</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#e"><span class="nav-number">4.1.2.</span> <span class="nav-text">e</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#a"><span class="nav-number">4.1.3.</span> <span class="nav-text">a</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#e-1"><span class="nav-number">4.1.4.</span> <span class="nav-text">e</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#a-1"><span class="nav-number">4.1.5.</span> <span class="nav-text">a</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#d"><span class="nav-number">4.1.6.</span> <span class="nav-text">d</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#c2-f-b0-c-b-a-c-a"><span class="nav-number">4.1.7.</span> <span class="nav-text">c2.f.b0.c.b.a.c.a()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#com-bilibili-lib-biliid-utils-f-c-b"><span class="nav-number">4.1.8.</span> <span class="nav-text">com.bilibili.lib.biliid.utils.f.c.b</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#g-b"><span class="nav-number">4.1.9.</span> <span class="nav-text">g.b</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#com-bilibili-commons-m-a-d"><span class="nav-number">4.1.10.</span> <span class="nav-text">com.bilibili.commons.m.a.d</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#e-2"><span class="nav-number">4.1.11.</span> <span class="nav-text">e</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#com-bilibili-lib-biliid-utils-f-a-j"><span class="nav-number">4.1.12.</span> <span class="nav-text">com.bilibili.lib.biliid.utils.f.a.j</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#com-bilibili-lib-biliid-utils-f-c-a"><span class="nav-number">4.1.13.</span> <span class="nav-text">com.bilibili.lib.biliid.utils.f.c.a</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Python%E8%BF%98%E5%8E%9Fbuvid"><span class="nav-number">4.1.14.</span> <span class="nav-text">Python还原buvid</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#session-id%E5%8F%82%E6%95%B0%E8%BF%98%E5%8E%9F"><span class="nav-number">4.2.</span> <span class="nav-text">session_id参数还原</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#com-bilibili-api-a-m"><span class="nav-number">4.2.1.</span> <span class="nav-text">com.bilibili.api.a.m()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#tv-danmaku-bili-utils-p-a"><span class="nav-number">4.2.2.</span> <span class="nav-text">tv.danmaku.bili.utils.p.a</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#gerSessionId"><span class="nav-number">4.2.3.</span> <span class="nav-text">gerSessionId()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Python%E7%94%9F%E6%88%90session-id"><span class="nav-number">4.2.4.</span> <span class="nav-text">Python生成session_id</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fp-local%E5%8F%82%E6%95%B0%E8%BF%98%E5%8E%9F"><span class="nav-number">4.3.</span> <span class="nav-text">fp_local参数还原</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#com-bilibili-api-a-j"><span class="nav-number">4.3.1.</span> <span class="nav-text">com.bilibili.api.a.j()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#c2-f-b0-c-a-c-a"><span class="nav-number">4.3.2.</span> <span class="nav-text">c2.f.b0.c.a.c.a()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#buvidLegacy"><span class="nav-number">4.3.3.</span> <span class="nav-text">buvidLegacy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#aVar"><span class="nav-number">4.3.4.</span> <span class="nav-text">aVar</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#a-2"><span class="nav-number">4.3.5.</span> <span class="nav-text">a()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#f-1"><span class="nav-number">4.3.6.</span> <span class="nav-text">f()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#e-3"><span class="nav-number">4.3.7.</span> <span class="nav-text">e()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MiscHelperKt-a"><span class="nav-number">4.3.8.</span> <span class="nav-text">MiscHelperKt.a()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#h-1"><span class="nav-number">4.3.9.</span> <span class="nav-text">h()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#g-1"><span class="nav-number">4.3.10.</span> <span class="nav-text">g()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#b-1"><span class="nav-number">4.3.11.</span> <span class="nav-text">b()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Python%E8%BF%98%E5%8E%9Ffp-local%E5%8F%82%E6%95%B0"><span class="nav-number">4.3.12.</span> <span class="nav-text">Python还原fp_local参数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fp-remote%E5%8F%82%E6%95%B0%E8%BF%98%E5%8E%9F"><span class="nav-number">4.4.</span> <span class="nav-text">fp_remote参数还原</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B4%E5%90%88%E4%BB%A3%E7%A0%81"><span class="nav-number">4.5.</span> <span class="nav-text">整合代码</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%92%AD%E6%94%BE%E9%87%8F%E6%8E%A5%E5%8F%A3%E6%8A%93%E5%8C%85%E5%88%86%E6%9E%90"><span class="nav-number">5.</span> <span class="nav-text">播放量接口抓包分析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#session%E5%8F%82%E6%95%B0%E5%88%86%E6%9E%90%E8%BF%98%E5%8E%9F"><span class="nav-number">5.1.</span> <span class="nav-text">session参数分析还原</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#N7"><span class="nav-number">5.1.1.</span> <span class="nav-text">N7()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HeartbeatParams"><span class="nav-number">5.1.2.</span> <span class="nav-text">HeartbeatParams()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#r1"><span class="nav-number">5.1.3.</span> <span class="nav-text">r1()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#t2"><span class="nav-number">5.1.4.</span> <span class="nav-text">t2()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#b-2"><span class="nav-number">5.1.5.</span> <span class="nav-text">b()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#a-3"><span class="nav-number">5.1.6.</span> <span class="nav-text">a()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#t"><span class="nav-number">5.1.7.</span> <span class="nav-text">t()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#i-1"><span class="nav-number">5.1.8.</span> <span class="nav-text">i()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#j-1"><span class="nav-number">5.1.9.</span> <span class="nav-text">j()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#h-2"><span class="nav-number">5.1.10.</span> <span class="nav-text">h()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Python%E8%BF%98%E5%8E%9Fsession%E5%8F%82%E6%95%B0"><span class="nav-number">5.1.11.</span> <span class="nav-text">Python还原session参数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sign%E5%8F%82%E6%95%B0%E5%88%86%E6%9E%90%E8%BF%98%E5%8E%9F"><span class="nav-number">5.2.</span> <span class="nav-text">sign参数分析还原</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8jadx%E9%87%8C%E6%90%9C%E7%B4%A2%E6%9F%A5%E6%89%BE-sign"><span class="nav-number">5.2.1.</span> <span class="nav-text">在jadx里搜索查找&amp;sign&#x3D;</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#hook-s"><span class="nav-number">5.2.1.1.</span> <span class="nav-text">hook s</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9A%E8%BF%87hook-NewStringUTF%E5%AE%9A%E4%BD%8D"><span class="nav-number">5.2.2.</span> <span class="nav-text">通过hook_NewStringUTF定位</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#so%E5%88%86%E6%9E%90"><span class="nav-number">5.3.</span> <span class="nav-text">so分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#hook-registernatives"><span class="nav-number">5.3.1.</span> <span class="nav-text">hook registernatives</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#hook-22B0"><span class="nav-number">5.3.2.</span> <span class="nav-text">hook_22B0()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8s-%E6%96%B9%E6%B3%95%EF%BC%8C%E5%B9%B6%E5%AF%B9so%E6%96%B9%E6%B3%95%E8%BF%9B%E8%A1%8Chook"><span class="nav-number">5.3.3.</span> <span class="nav-text">主动调用s()方法，并对so方法进行hook</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Python%E5%AE%9E%E7%8E%B0"><span class="nav-number">5.4.</span> <span class="nav-text">Python实现</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8A%93%E5%8C%85%E6%95%B0%E6%8D%AE"><span class="nav-number">6.</span> <span class="nav-text">抓包数据</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#unidbg"><span class="nav-number">7.</span> <span class="nav-text">unidbg</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8Cs%E6%96%B9%E6%B3%95"><span class="nav-number">7.1.</span> <span class="nav-text">模拟执行s方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E6%9E%90"><span class="nav-number">7.1.1.</span> <span class="nav-text">分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A5%E7%8E%AF%E5%A2%83"><span class="nav-number">7.1.2.</span> <span class="nav-text">补环境</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A5isEmpty"><span class="nav-number">7.1.2.1.</span> <span class="nav-text">补isEmpty()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A5get-Ljava-lang-Object"><span class="nav-number">7.1.2.2.</span> <span class="nav-text">补get(Ljava&#x2F;lang&#x2F;Object;)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A5put-Ljava-lang-Object-Ljava-lang-Object"><span class="nav-number">7.1.2.3.</span> <span class="nav-text">补put(Ljava&#x2F;lang&#x2F;Object;Ljava&#x2F;lang&#x2F;Object;)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A5r-Ljava-util-Map"><span class="nav-number">7.1.2.4.</span> <span class="nav-text">补r(Ljava&#x2F;util&#x2F;Map;)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A5"><span class="nav-number">7.1.2.5.</span> <span class="nav-text">补&lt;init&gt;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#over"><span class="nav-number">7.1.2.6.</span> <span class="nav-text">over</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%93%E5%8C%85Python%E8%B0%83%E7%94%A8"><span class="nav-number">7.2.</span> <span class="nav-text">打包Python调用</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Bileton"
      src="/images/android.svg">
  <p class="site-author-name" itemprop="name">Bileton</p>
  <div class="site-description" itemprop="description">路漫漫其修远夕！</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">98</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">35</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">90</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Bileton</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">833k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">12:37</span>
</div>


<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("01/01/2024 00:00:00"); //修改为你的网站开始运行的时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒.";
    }
setInterval("createtime()",250);
</script>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
